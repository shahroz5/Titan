<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="Definitions_06x7pkp" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="3.7.2">
  <bpmn:process id="WORKFLOWSERVICEL2" name="WORKFLOWSERVICEL2" isExecutable="true">
    <bpmn:startEvent id="StartEvent_1">
      <bpmn:outgoing>Flow_1ic71yh</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_1ic71yh" sourceRef="StartEvent_1" targetRef="assignApprovers" />
    <bpmn:sequenceFlow id="Flow_1iy0bkl" sourceRef="assignApprovers" targetRef="requestApproverL1" />
    <bpmn:exclusiveGateway id="Gateway_0a96hk7">
      <bpmn:incoming>Flow_0exdua0</bpmn:incoming>
      <bpmn:outgoing>requestApprovedL1</bpmn:outgoing>
      <bpmn:outgoing>requestRejectedbyL1</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_0exdua0" sourceRef="requestApproverL1" targetRef="Gateway_0a96hk7" />
    <bpmn:endEvent id="confirmationEmailSent" name="Approval Confirmation Email Sent">
      <bpmn:incoming>Flow_0f85mep</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="requestApprovedL1" name="Request Approved by L1" sourceRef="Gateway_0a96hk7" targetRef="requestApproverL2">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approvedL1 == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:endEvent id="rejectionEmailSent" name="Rejection Email Sent">
      <bpmn:incoming>Flow_128qns7</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="requestRejectedbyL1" name="Request Rejected by L1" sourceRef="Gateway_0a96hk7" targetRef="sendRejectionEmailtoRequestorL1">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approvedL1 == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:businessRuleTask id="assignApprovers" name="Assign Approvers" camunda:asyncBefore="true" camunda:asyncAfter="true" camunda:resultVariable="dmnResult" camunda:decisionRef="WORKFLOWSERVICEL2DMN" camunda:mapDecisionResult="singleResult">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:outputParameter name="approverL1">${dmnResult.approverL1}</camunda:outputParameter>
          <camunda:outputParameter name="approverEmailL1">${dmnResult.approverEmailL1}</camunda:outputParameter>
          <camunda:outputParameter name="approverL2">${dmnResult.approverL2}</camunda:outputParameter>
          <camunda:outputParameter name="approverEmailL2">${dmnResult.approverEmailL2}</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1ic71yh</bpmn:incoming>
      <bpmn:outgoing>Flow_1iy0bkl</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:userTask id="requestApproverL1" name="REQUEST_APPROVER_L1" camunda:candidateGroups="${dmnResult.approverL1}">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="approvedL1" label="Approved L1?" type="boolean" />
          <camunda:formField id="approverCommentsL1" label="Approver Comments L1" type="string" />
        </camunda:formData>
        <camunda:inputOutput>
          <camunda:outputParameter name="level1">1</camunda:outputParameter>
        </camunda:inputOutput>
        <camunda:taskListener class="com.titan.poss.workflow.camundabpm.TaskAssignmentListenerL1" event="create" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1iy0bkl</bpmn:incoming>
      <bpmn:outgoing>Flow_0exdua0</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_0bswq1j" sourceRef="requestApproverL2" targetRef="Gateway_1ers6ln" />
    <bpmn:userTask id="requestApproverL2" name="REQUEST_APPROVER_L2" camunda:candidateGroups="${dmnResult.approverL2}">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="approvedL2" label="Approved L2?" type="boolean" />
          <camunda:formField id="approverCommentsL2" label="Approver Comments L2" type="string" />
        </camunda:formData>
        <camunda:inputOutput>
          <camunda:outputParameter name="level2">2</camunda:outputParameter>
        </camunda:inputOutput>
        <camunda:taskListener class="com.titan.poss.workflow.camundabpm.TaskAssignmentListenerL2" event="create" />
      </bpmn:extensionElements>
      <bpmn:incoming>requestApprovedL1</bpmn:incoming>
      <bpmn:outgoing>Flow_0bswq1j</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_1ers6ln">
      <bpmn:incoming>Flow_0bswq1j</bpmn:incoming>
      <bpmn:outgoing>requestApprovedL2</bpmn:outgoing>
      <bpmn:outgoing>requestRejectedbyL2</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="requestApprovedL2" name="Request Approved by L2" sourceRef="Gateway_1ers6ln" targetRef="sendConfirmationEmailtoRequestor">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approvedL2 == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:endEvent id="RejectionEmailSent" name="Rejection Email Sent">
      <bpmn:incoming>Flow_0mf0zo9</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="requestRejectedbyL2" name="Request Rejected by L2" sourceRef="Gateway_1ers6ln" targetRef="sendRejectionEmailtoRequestorL2">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approvedL2 ==false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_128qns7" sourceRef="sendRejectionEmailtoRequestorL1" targetRef="rejectionEmailSent" />
    <bpmn:sendTask id="sendRejectionEmailtoRequestorL1" name="Send Rejection Email to Requestor by L1">
      <bpmn:extensionElements>
        <camunda:connector>
          <camunda:inputOutput>
            <camunda:inputParameter name="to">${requestorEmail}</camunda:inputParameter>
            <camunda:inputParameter name="subject">${workflowType} Rejection Notification Email</camunda:inputParameter>
            <camunda:inputParameter name="html">
              <camunda:script scriptFormat="freemarker" resource="templates/RejectionNotificationRequestor.ftlh" />
            </camunda:inputParameter>
          </camunda:inputOutput>
          <camunda:connectorId>mail-send</camunda:connectorId>
        </camunda:connector>
      </bpmn:extensionElements>
      <bpmn:incoming>requestRejectedbyL1</bpmn:incoming>
      <bpmn:outgoing>Flow_128qns7</bpmn:outgoing>
    </bpmn:sendTask>
    <bpmn:sequenceFlow id="Flow_0mf0zo9" sourceRef="sendRejectionEmailtoRequestorL2" targetRef="RejectionEmailSent" />
    <bpmn:sendTask id="sendRejectionEmailtoRequestorL2" name="Send Rejection Email to Requestor by L2">
      <bpmn:extensionElements>
        <camunda:connector>
          <camunda:inputOutput>
            <camunda:inputParameter name="to">${requestorEmail}</camunda:inputParameter>
            <camunda:inputParameter name="subject">${workflowType} Rejection Notification Email</camunda:inputParameter>
            <camunda:inputParameter name="html">
              <camunda:script scriptFormat="freemarker" resource="templates/RejectionNotificationRequestor.ftlh" />
            </camunda:inputParameter>
          </camunda:inputOutput>
          <camunda:connectorId>mail-send</camunda:connectorId>
        </camunda:connector>
      </bpmn:extensionElements>
      <bpmn:incoming>requestRejectedbyL2</bpmn:incoming>
      <bpmn:outgoing>Flow_0mf0zo9</bpmn:outgoing>
    </bpmn:sendTask>
    <bpmn:sequenceFlow id="Flow_0f85mep" sourceRef="sendConfirmationEmailtoRequestor" targetRef="confirmationEmailSent" />
    <bpmn:sendTask id="sendConfirmationEmailtoRequestor" name="Send Approval Confirmation Email to Requestor">
      <bpmn:extensionElements>
        <camunda:connector>
          <camunda:inputOutput>
            <camunda:inputParameter name="to">${requestorEmail}</camunda:inputParameter>
            <camunda:inputParameter name="subject">${workflowType} Approval Confirmation Email</camunda:inputParameter>
            <camunda:inputParameter name="html">
              <camunda:script scriptFormat="freemarker" resource="templates/SuccessfulApprovalNotificationRequestor.ftlh" />
            </camunda:inputParameter>
          </camunda:inputOutput>
          <camunda:connectorId>mail-send</camunda:connectorId>
        </camunda:connector>
      </bpmn:extensionElements>
      <bpmn:incoming>requestApprovedL2</bpmn:incoming>
      <bpmn:outgoing>Flow_0f85mep</bpmn:outgoing>
    </bpmn:sendTask>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="WORKFLOWSERVICEL2">
      <bpmndi:BPMNEdge id="Flow_1duv5dg_di" bpmnElement="requestRejectedbyL2">
        <di:waypoint x="1160" y="142" />
        <di:waypoint x="1160" y="230" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1166" y="176" width="88" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0n69cy3_di" bpmnElement="requestApprovedL2">
        <di:waypoint x="1185" y="117" />
        <di:waypoint x="1390" y="117" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1241" y="86" width="77" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0bswq1j_di" bpmnElement="Flow_0bswq1j">
        <di:waypoint x="970" y="117" />
        <di:waypoint x="1135" y="117" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0a1hb44_di" bpmnElement="requestRejectedbyL1">
        <di:waypoint x="680" y="142" />
        <di:waypoint x="680" y="260" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="686" y="186" width="88" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1e85xxl_di" bpmnElement="requestApprovedL1">
        <di:waypoint x="705" y="117" />
        <di:waypoint x="870" y="117" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="739" y="86" width="77" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0exdua0_di" bpmnElement="Flow_0exdua0">
        <di:waypoint x="580" y="117" />
        <di:waypoint x="655" y="117" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1iy0bkl_di" bpmnElement="Flow_1iy0bkl">
        <di:waypoint x="360" y="117" />
        <di:waypoint x="480" y="117" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ic71yh_di" bpmnElement="Flow_1ic71yh">
        <di:waypoint x="188" y="117" />
        <di:waypoint x="260" y="117" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_128qns7_di" bpmnElement="Flow_128qns7">
        <di:waypoint x="680" y="340" />
        <di:waypoint x="680" y="402" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0mf0zo9_di" bpmnElement="Flow_0mf0zo9">
        <di:waypoint x="1160" y="310" />
        <di:waypoint x="1160" y="372" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0f85mep_di" bpmnElement="Flow_0f85mep">
        <di:waypoint x="1490" y="117" />
        <di:waypoint x="1582" y="117" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="152" y="99" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0a96hk7_di" bpmnElement="Gateway_0a96hk7" isMarkerVisible="true">
        <dc:Bounds x="655" y="92" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_175m7p3_di" bpmnElement="assignApprovers">
        <dc:Bounds x="260" y="77" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1lkh195_di" bpmnElement="requestApproverL1">
        <dc:Bounds x="480" y="77" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1ers6ln_di" bpmnElement="Gateway_1ers6ln" isMarkerVisible="true">
        <dc:Bounds x="1135" y="92" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1wp3xrt_di" bpmnElement="rejectionEmailSent">
        <dc:Bounds x="662" y="402" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="642" y="445" width="77" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1b5oqzj_di" bpmnElement="sendRejectionEmailtoRequestorL1">
        <dc:Bounds x="630" y="260" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0m7jagy_di" bpmnElement="RejectionEmailSent">
        <dc:Bounds x="1142" y="372" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1122" y="415" width="77" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_11foz3m_di" bpmnElement="sendRejectionEmailtoRequestorL2">
        <dc:Bounds x="1110" y="230" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0tbj20w_di" bpmnElement="requestApproverL2">
        <dc:Bounds x="870" y="77" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0dfcbhg_di" bpmnElement="confirmationEmailSent">
        <dc:Bounds x="1582" y="99" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1569" y="142" width="63" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1bt4cwy_di" bpmnElement="sendConfirmationEmailtoRequestor">
        <dc:Bounds x="1390" y="77" width="100" height="80" />
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
