<div class="pw-confirmation-box">
  <div
    class="row pw-confirmation-box__header"
    cdkDragBoundary=".cdk-overlay-container"
    cdkDragRootElement=".cdk-overlay-pane"
    cdkDrag
    cdkDragHandle
  >
    <div class="col-auto">
      {{ 'pw.paymentModeQCGC.qwikcilverLabel' | translate }}
    </div>
    <div class="col pw-text-right">
      <button
        class="pw-confirmation-box__icon-button"
        mat-icon-button
        (click)="close()"
      >
        <mat-icon>
          <span class="pw-i-24 pw-close-no-border-icon-24"></span>
        </mat-icon>
      </button>
    </div>
  </div>

  <div
    class="pw-confirmation-box__body pw-confirmation-box__padding-bottom-0 pw-padding-bottom-0"
  >
    <mat-tab-group
      dynamicHeight
      mat-stretch-tabs
      class="pw-mat-tab pw-confirmation-box__margin-top-0 pw-margin-bottom-0"
      (selectedTabChange)="onTabChange($event)"
      [(selectedIndex)]="activeTab"
    >
      <ng-container>
        <mat-tab
          class="pw-mat-tab__item"
          label="{{ 'pw.paymentModeQCGC.CardDeatils' | translate }}"
        >
          <form autocomplete="off" class="row">
            <poss-web-ui-gc-bar-code
              class="col-lg-5 col-5"
              *ngIf="isScan"
              [clearCardNumberField]="clearCardNumberField"
              [tabType]="'balanceInquiry'"
              (cardNumberEmit)="getScanCardNumber($event)"
              [paymentGrid]="true"
            ></poss-web-ui-gc-bar-code>
            <poss-web-ui-gc-number-manual-entry
              class="col-lg-5 col-5"
              *ngIf="!isScan"
              [clearCardNumberField]="clearCardNumberField"
              (gcNumberManualEmit)="getCardNumber($event)"
            >
            </poss-web-ui-gc-number-manual-entry>

            <div class="col-auto mt-4">
              <mat-checkbox
                class="col-auto pw-list-card__checkbox pw_gc_scan_checkbox"
                (change)="setScan($event.checked)"
              >
                {{ 'pw.giftCards.scan' | translate }}
              </mat-checkbox>
            </div>
          </form>
          <form autocomplete="off" class="row">
            <mat-form-field class="col-5">
              <mat-label>
                {{ 'pw.paymentModeQCGC.getPinLabel' | translate }}</mat-label
              >

              <input
                #focusPin
                matInput
                type="password"
                [formControl]="cardPin"
                name="giftCardPinField"
                possWebMaxLengthValidator
                autocomplete="off"
              />

              <mat-error *ngIf="cardPin.errors && cardPin.errors.errorArray">
                <poss-web-error-info-tooltip
                  [errorMessage]="cardPin.errors.errorArray"
                ></poss-web-error-info-tooltip>
              </mat-error>
            </mat-form-field>
            <div class="col-auto">
              <button
                (click)="onGetBalance()"
                [disabled]="cardNumber.length !== 16"
                mat-flat-button
                class="pw-btn pw-accent-btn"
              >
                {{ 'pw.paymentModeQCGC.detailsButtonLabel' | translate }}
              </button>
            </div>
          </form>

          <table class="pw-mat-table" aria-describedby="table">
            <thead>
              <tr class="pw-mat-table__header">
                <th scope="col" class="pw-mat-table__item">
                  <p>{{ 'pw.paymentModeQCGC.gcType' | translate }}</p>
                </th>
                <th scope="col" class="pw-mat-table__item">
                  <p>{{ 'pw.paymentModeQCGC.eligibleGroup' | translate }}</p>
                </th>

                <th scope="col" class="pw-mat-table__item">
                  <p>
                    {{ 'pw.paymentModeQCGC.availableAmount' | translate }} ({{
                      data.currencyCode | currencySymbol
                    }})
                  </p>
                </th>
                <th scope="col" class="pw-mat-table__item">
                  <p>
                    {{ 'pw.paymentModeQCGC.redeemAmount' | translate }} ({{
                      data.currencyCode | currencySymbol
                    }})
                  </p>
                </th>
                <th scope="col" class="pw-mat-table__item">
                  <p>{{ 'pw.paymentModeQCGC.cardName' | translate }}</p>
                </th>
              </tr>
            </thead>
            <tbody *ngIf="!cardDetails">
              <tr class="pw-mat-table__body-row">
                <td class="pw-mat-table__item"></td>
                <td class="pw-mat-table__item"></td>
                <td class="pw-mat-table__item"></td>
                <td class="pw-mat-table__item"></td>
                <td class="pw-mat-table__item"></td>
              </tr>
            </tbody>

            <tbody *ngIf="cardDetails">
              <tr class="pw-mat-table__body-row pw-text-center">
                <td class="pw-mat-table__item">
                  {{ cardDetails.cardType }}
                </td>
                <td
                  class="pw-mat-table__item"
                  (click)="onselected(cardDetails.productGroup)"
                >
                  <a class="pw-anchor-underline"
                    ><span *ngIf="cardDetails.productGroup">
                      {{ cardDetails.productGroup.length }}
                    </span></a
                  >
                </td>
                <td class="pw-mat-table__item">
                  {{
                    cardDetails.amount
                      | currencyFormatter: data.currencyCode:false
                  }}
                </td>
                <td class="pw-mat-table__item pw-fourth-color">
                  <mat-form-field class="col-auto col pw-panel-card__item">
                    <input
                      #focusAmount
                      matInput
                      [formControl]="amountFormControl"
                      possWebAmountInput
                      float-value
                    />
                    <mat-error
                      *ngIf="
                        amountFormControl &&
                        amountFormControl.errors &&
                        amountFormControl.errors.errorArray
                      "
                    >
                      <poss-web-error-info-tooltip
                        [errorMessage]="amountFormControl.errors.errorArray"
                      ></poss-web-error-info-tooltip>
                    </mat-error>
                  </mat-form-field>
                </td>
                <td class="pw-mat-table__item">
                  {{ cardDetails.cardName }}
                </td>
              </tr>
            </tbody>
          </table>

          <div class="pw-confirmation-box__footer mt-0">
            <div class="pw-confirmation-box__footer pw-text-right">
              <div class="row justify-content-end">
                <div class="col-auto" (click)="delete()">
                  <button mat-flat-button class="pw-btn pw-primary-btn">
                    {{ 'pw.paymentModeQCGC.resetButtonLabel' | translate }}
                  </button>
                </div>

                <div class="col-auto">
                  <button
                    mat-flat-button
                    [disabled]="addButtonEnabled()"
                    class="pw-btn pw-accent-btn"
                    (click)="addPayment()"
                  >
                    {{ 'pw.paymentModeQCGC.addButtonLabel' | translate }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>
      </ng-container>
      <ng-container>
        <mat-tab
          class="pw-mat-tab__item"
          label="{{ 'pw.paymentModeQCGC.eligibleGroup' | translate }}"
          [disabled]="true"
        >
          <div class="pw-confirmation-box__body-item-without-padding">
            <div class="pw-scrollable-table">
              <table
                class="pw-grid-table pw-grid-table__scrollable"
                aria-describedby="table"
              >
                <thead>
                  <tr class="pw-mat-table__header pw-text-center">
                    <th scope="col" class="pw-mat-table__item">
                      <p>
                        {{ 'pw.paymentModeGV.ProductCode' | translate }}
                      </p>
                    </th>
                    <th scope="col" class="pw-mat-table__item">
                      <p>
                        {{ 'pw.paymentModeGV.ProductName' | translate }}
                      </p>
                    </th>
                  </tr>
                </thead>
                <tbody *ngIf="!productList">
                  <tr class="pw-mat-table__body-row">
                    <td class="pw-mat-table__item"></td>
                    <td class="pw-mat-table__item"></td>
                  </tr>
                </tbody>

                <tbody *ngIf="productList">
                  <tr
                    *ngFor="let product of productList"
                    class="pw-mat-table__body-row pw-text-center"
                  >
                    <td class="pw-mat-table__item">
                      {{ product }}
                    </td>
                    <td class="pw-mat-table__item">
                      {{ this.data.productDesc[0][product] }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </mat-tab>
      </ng-container>
    </mat-tab-group>
  </div>
</div>
