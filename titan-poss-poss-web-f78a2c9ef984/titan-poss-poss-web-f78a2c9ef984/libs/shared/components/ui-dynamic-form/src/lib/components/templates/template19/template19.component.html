<div class="errorMessage" *ngFor="let error of form.errors | objIterator">
  <poss-web-error-message [formId]="formId" [error]="error">
  </poss-web-error-message>
</div>

<div class="pw-form-card">
  <div class="row">
    <div class="col-auto">
      <div class="pw-form-card__header">{{ formName | translate }}</div>
    </div>
  </div>
  <div *ngFor="let field of fields; let i = index">
    <!-- for subform -->
    <div *ngIf="field.controlType == 'subForm'">
      <div
        *ngIf="field.label !== ''"
        class="pw-form-card__margin-bottom pw-font-weight-bold pw-form-card__margin-top"
      >
        {{ field.label | translate }}
      </div>
      <div
        class="pw-form-card__flex-row {{ field.classNames.join(' ') }}"
        [ngClass]="{
          'pw-form-card__border-bottom-tertiary': i < fields.length - 1
        }"
      >
        <poss-web-dynamic-input
          *ngFor="let input of field.fields"
          [style]="style"
          [field]="input"
          [form]="form.get(field.name)"
          (selectChange)="selectChange.emit($event)"
          (selectRefreshClick)="selectRefreshClickEvent.emit($event)"
          (radioChange)="radioChange.emit($event)"
          (checkboxChange)="
            checkBoxChange.emit({
              name: $event.name,
              value: $event.value,
              option: $event.option,
              index: $event.index,
              subformName: field.name
            })
          "
        >
        </poss-web-dynamic-input>
      </div>
    </div>
    <div *ngIf="field.controlType != 'subForm'">
      <div class="pw-form-card__border-bottom-tertiary pw-form-card__flex-row">
        <poss-web-dynamic-input
          [style]="style"
          [field]="field"
          [form]="form"
          (selectChange)="selectChange.emit($event)"
          (selectRefreshClick)="selectRefreshClickEvent.emit($event)"
          (radioChange)="radioChange.emit($event)"
          (checkboxChange)="checkBoxChange.emit($event)"
        >
        </poss-web-dynamic-input>
      </div>
    </div>
  </div>
</div>

<div class="row mt-4 mb-4" *ngIf="!disabled && !disableSubmit">
  <div class="col-auto ml-auto">
    <div class="row justify-content-end">
      <ng-container *ngIf="buttonNames">
        <button
          type="button"
          class="pw-btn pw-primary-btn col-auto mr-3"
          (click)="onDeleteForm.emit(true)"
        >
          {{ buttonNames[0] | translate }}
        </button>
        <button
          type="submit"
          class="pw-btn pw-accent-btn col-auto mr-3"
          (click)="onAddForm.emit(true)"
        >
          {{ buttonNames[1] | translate }}
        </button>
      </ng-container>
      <ng-container *ngIf="commandButtons">
        <ng-container *ngFor="let btn of commandButtons; let i = index">
          <div *ngIf="btn.permission; else elseNoPermission">
            <button
              *possWebPermission="btn?.permission"
              #commandButtonPanel
              type="{{ btn.type }}"
              class="{{ btn.cssClassName }} col-auto mr-3 "
              (click)="emitButton.emit({ btn: btn, i: i })"
            >
              {{ btn.name | translate }}
            </button>
          </div>
          <ng-template #elseNoPermission>
            <button
              #commandButtonPanel
              type="{{ btn.type }}"
              class="{{ btn.cssClassName }} col-auto mr-3 "
              (click)="emitButton.emit({ btn: btn, i: i })"
              [disabled]="
                btn.type != ButtonType.BUTTON
                  ? !form.valid && !enableSubmitOnInvalid
                  : false
              "
            >
              {{ btn.name | translate }}
            </button>
          </ng-template>
        </ng-container>
      </ng-container>
    </div>
  </div>
</div>
