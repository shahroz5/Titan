<mat-expansion-panel expanded class="pw-expansion-panel">
  <mat-expansion-panel-header
    class="pw-expansion-panel__header"
    [collapsedHeight]="'40px'"
    [expandedHeight]="'40px'"
  >
    <mat-panel-title class="pw-expansion-panel__heading">
      {{ 'pw.cmRequestApproval.productDetailsLabel' | translate }}
    </mat-panel-title>
  </mat-expansion-panel-header>
  <div
    class="row pw-card pw-panel"
    *ngIf="productDetails?.length !== 0; else noDataTemplate"
  >
    <div
      *ngIf="showFOCButton && focData && focData.length"
      class="col-auto pw-card__item ml-auto"
    >
      <button class="pw-btn pw-primary-btn" (click)="ABFOCViewPopup(focData)">
        {{ 'pw.productGrid.viewFOCSchemesButtonLabel' | translate }}
      </button>
    </div>
    <table class="pw-mat-table" aria-describedby="table">
      <thead>
        <tr class="pw-mat-table__header pw-mat-table__primary-bg">
          <th class="pw-mat-table__item" scope="col">
            {{ 'pw.cmRequestApproval.variantCodeHeaderText' | translate }}
          </th>
          <th class="pw-mat-table__item" scope="col">
            {{ 'pw.cmRequestApproval.lotNumberHeaderText' | translate }}
          </th>
          <th class="pw-mat-table__item" scope="col">
            {{ 'pw.cmRequestApproval.unitWeightHeaderText' | translate }} ({{
              weightCode
            }})
          </th>
          <th class="pw-mat-table__item" scope="col">
            {{ 'pw.cmRequestApproval.actualWeightHeaderText' | translate }}
            ({{ weightCode }})
          </th>
          <th class="pw-mat-table__item" scope="col">
            {{ 'pw.cmRequestApproval.RSONameHeaderText' | translate }}
          </th>
          <th class="pw-mat-table__item" scope="col">
            {{ 'pw.cmRequestApproval.pricePerUnitHeaderText' | translate }}
            ({{ defaultCurrencyCode | currencySymbol }})
          </th>
          <th class="pw-mat-table__item" scope="col">
            {{ 'pw.cmRequestApproval.discountHeaderText' | translate }} ({{
              defaultCurrencyCode | currencySymbol
            }})
          </th>

          <th class="pw-mat-table__item" scope="col">
            {{ 'pw.cmRequestApproval.finalPriceHeaderText' | translate }} ({{
              defaultCurrencyCode | currencySymbol
            }})
          </th>
          <th class="pw-mat-table__item" scope="col">
            {{ 'pw.cmRequestApproval.isHallmarkingHeaderText' | translate }}
          </th>
          <th class="pw-mat-table__item" scope="col">
            {{ 'pw.cmRequestApproval.isHMQuantityHeaderText' | translate }}
          </th>
          <th class="pw-mat-table__item" scope="col">
            {{
              'pw.cmRequestApproval.isFOCforHallmarkingHeaderText' | translate
            }}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          class="pw-mat-table__body-row"
          *ngFor="let item of productDetails; let i = index"
        >
          <td class="pw-mat-table__item">
            <div>
              <a (click)="showPopup(item)" class="pw-anchor-underline">
                {{ item.itemCode }}
              </a>
            </div>
            <div class="pw-mat-table__item-content">
              {{ getProductGroupDesc(item?.productGroupCode) }}
            </div>
            <div class="pw-mat-table__item-content">
              {{ item.isManualFOC === true ? 'Manual FOC' : item.binCode }}
            </div>
          </td>
          <td *ngIf="item.binCode !== 'FOC'" class="pw-mat-table__item">
            {{
              item.productGroupCode === coinCode
                ? item.totalQuantity
                : item.lotNumber
            }}
          </td>

          <td *ngIf="item.binCode === 'FOC'" class="pw-mat-table__item">
            {{ item.lotNumber }}
            <div>
              Qty:<span>{{ item.totalQuantity }} </span>
            </div>
          </td>
          <td class="pw-mat-table__item">
            {{ item.unitWeight | weightFormatter }}
          </td>
          <td class="pw-mat-table__item">
            {{ item.totalWeight | weightFormatter }}
          </td>
          <td class="pw-mat-table__item">
            <span
              matTooltip="{{ item.employeeCode }}"
              matTooltipPosition="right"
              >{{ getRsoNameFromCode(item.employeeCode) }}</span
            >
          </td>
          <td class="pw-mat-table__item">
            {{
              item.binCode !== 'FOC'
                ? (item.unitValue
                  | currencyFormatter: currencyCode:false)
                : defaultValue
            }}
          </td>
          <td class="pw-mat-table__item">
            <a
              *ngIf="item.totalDiscount && !isGRN && !isLegacy"
              (click)="openDiscountDetails(item)"
              class="pw-anchor-underline"
            >
              <!-- <div>Studded Discount..</div>
                <div class="pw-mat-table__item-content pw-fourth-color">
                  0 Selected
                </div> -->
              <!-- <div class="pw-mat-table__item-content"> -->
              {{ item.totalDiscount | currencyFormatter: currencyCode:false }}
              <!-- </div> -->
            </a>
            <div *ngIf="item.totalDiscount && (isGRN || isLegacy)">
              {{ item.totalDiscount | currencyFormatter: currencyCode:false }}
          </div>
          <div *ngIf="!item.totalDiscount">
            <!-- <div>Studded Discount..</div>
              <div class="pw-mat-table__item-content pw-fourth-color">
                0 Selected
              </div> -->
             {{ defaultValue }}
          </div>
          </td>
          <td class="pw-mat-table__item">
            <div *ngIf="isLegacy || item?.finalValue === null; else other_content">
              {{
                item?.finalValue !== null
                  ? (item.finalValue | currencyFormatter: currencyCode:false)
                  : defaultValue
              }}
            </div>
            <ng-template #other_content>
              <a
                (click)="openItemDetails(item)"
                class="pw-anchor-underline"
              >
                {{
                  (item.finalValue | currencyFormatter: currencyCode:false)
                }}
              </a>
            </ng-template>
          </td>
          <td class="pw-mat-table__item pw-text-center">
            <mat-checkbox
              [checked]="item?.priceDetails?.itemHallmarkDetails?.isHallmarked"
              [disabled]="true"
            >
            </mat-checkbox>
          </td>
          <td class="pw-mat-table__item pw-text-center">
            {{
              item?.priceDetails?.itemHallmarkDetails?.hmQuantity
                ? item?.priceDetails?.itemHallmarkDetails?.hmQuantity
                : 0
            }}
          </td>
          <td class="pw-mat-table__item pw-text-center">
            <mat-checkbox
              [checked]="
                item?.priceDetails?.itemHallmarkDetails
                  ?.isFOCForHallmarkingCharges
              "
              [disabled]="true"
            >
            </mat-checkbox>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <ng-template #noDataTemplate>
    <p class="pw-text-center">
      {{ 'pw.cmRequestApproval.noRowsToShowMessage' | translate }}
    </p>
  </ng-template>
</mat-expansion-panel>
