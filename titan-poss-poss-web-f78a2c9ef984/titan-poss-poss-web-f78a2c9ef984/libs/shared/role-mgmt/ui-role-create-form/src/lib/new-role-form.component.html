<form [formGroup]="roleForm">
  <div class="pw-confirmation-box">
    <div
      class="row pw-confirmation-box__header pw-cursor-grab"
      cdkDragBoundary=".cdk-overlay-container"
      cdkDragRootElement=".cdk-overlay-pane"
      cdkDrag
      cdkDragHandle
    >
      <div class="col-auto">
        {{ 'pw.rolemanagementform.createnewroleTitle' | translate }}
      </div>
      <div class="col pw-text-right">
        <button
          mat-icon-button
          mat-dialog-close="close"
          class="pw-confirmation-box__icon-btn"
        >
          <mat-icon class="pw-sub-heading">
            <span class="pw-i-24 pw-close-no-border-icon-24"></span>
          </mat-icon>
        </button>
      </div>
    </div>

    <div mat-dialog-content class="pw-confirmation-box__body">
      <div>
        <div class="pw-fourth-color">
          {{ 'pw.rolemanagementform.roleforlabeltext' | translate }}
        </div>

        <mat-selection-list
          #selected
          (selectionChange)="updateRoleList($event, data.roleTypes)"
        >
          <ng-container *ngFor="let type of data.roleTypes; let i = index">
            <mat-list-option
              #listitem
              checkboxPosition="before"
              [value]="type.code"
              [selected]="listitem.selected"
              [disabled]="checkForDisable(listitem.selected, listitem.value)"
            >
              {{ type.value }}
            </mat-list-option>
          </ng-container>
        </mat-selection-list>
      </div>
      <div>
        <div>
          <mat-form-field>
            <mat-label>{{
              'pw.rolemanagementform.roleCodeLabel' | translate
            }}</mat-label>
            <input
              possWebInput
              matInput
              type="text"
              required
              maxlength="100"
              formControlName="roleCode"
            />

            <mat-error
              *ngIf="
                roleForm.get('roleCode').errors &&
                roleForm.get('roleCode').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="roleForm.get('roleCode').errors.errorArray"
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <div>
        <div>
          <mat-form-field>
            <mat-label>{{
              'pw.rolemanagementform.roleNameLabel' | translate
            }}</mat-label>
            <input
              possWebInput
              matInput
              type="text"
              required
              maxlength="100"
              formControlName="roleName"
            />

            <mat-error
              *ngIf="
                roleForm.get('roleName').errors &&
                roleForm.get('roleName').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="roleForm.get('roleName').errors.errorArray"
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <div class="pw-confirmation-box__body-item" *ngIf="showLocationFormat">
        <p class="pw-fourth-color">
          {{ 'pw.rolemanagementform.storeformatlabeltext' | translate }}
        </p>
        <div
          class="row align-items-center"
          *ngFor="let format of data.locationFormats | keyvalue"
        >
          <div class="col-6">{{ format.value }} :</div>
          <mat-form-field
            class="col-5 pw-single-bordered-input pw-form-field-padding-bottom-0 pw-form-field-border-top-0"
          >
            <input
              possWebInput
              matInput
              type="number"
              min="0"
              max="999"
              formControlName="{{ format.key }}"
              (keydown)="
                $event.keyCode === 8 ||
                $event.keyCode === 9 ||
                $event.keyCode === 46 ||
                $event.keyCode === 38 ||
                $event.keyCode === 40
                  ? true
                  : regExp.test($event.key)
              "
            />
          </mat-form-field>
        </div>
      </div>

      <div class="row">
        <mat-form-field class="col-12">
          <mat-label>{{
            'pw.rolemanagementform.descriptionLabel' | translate
          }}</mat-label>
          <textarea
            possWebTextarea
            matInput
            type="text"
            required
            maxlength="250"
            formControlName="description"
          ></textarea>
          <mat-error
            *ngIf="
              roleForm.get('description').errors &&
              roleForm.get('description').errors.errorArray
            "
          >
            <poss-web-error-info-tooltip
              [errorMessage]="roleForm.get('description').errors.errorArray"
            ></poss-web-error-info-tooltip>
          </mat-error>
        </mat-form-field>
      </div>

      <div *ngIf='regionalUser'>
        <div>
          <mat-checkbox formControlName="isLocationMapping"></mat-checkbox>
        {{ 'pw.rolemanagementform.locationMappingAllowedLabel' | translate }}
        </div>
        <div>
          <p>{{ 'pw.rolemanagementform.locationMappingFootNoteLabel' | translate }}</p>
        </div>
      </div>
    </div>

    <div class="pw-confirmation-box__footer row">
      <div class="col-auto">
        <button
          type="button"
          class="pw-btn pw-primary-btn"
          mat-raised-button
          (click)="createRoleForm()"
        >
          {{ 'pw.rolemanagementform.clearButtonText' | translate }}
        </button>
      </div>
      <div class="col-auto">
        <button
          class="pw-btn pw-accent-btn"
          mat-raised-button
          (click)="submitForm()"
        >
          {{ 'pw.rolemanagementform.saveButtonText' | translate }}
        </button>
      </div>
    </div>
  </div>
</form>
