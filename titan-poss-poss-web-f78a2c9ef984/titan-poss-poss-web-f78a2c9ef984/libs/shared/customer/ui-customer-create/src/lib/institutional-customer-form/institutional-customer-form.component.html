<form
  novalidate
  (ngSubmit)="validateForm()"
  [formGroup]="institutionalCustomerForm"
  #institutionalFormDirective="ngForm"
  autocomplete="off"
>
  <div class="pw-confirmation-box__body pw-confirmation-box__fixed-body">
    <div class="row">
      <div class="col-6">
        <h4 class="pw-confirmation-box__body-item">
          {{ 'pw.customerCreation.customerInfoHeading' | translate }}
        </h4>
        <div class="row">
          <div class="col-auto">
            <mat-checkbox formControlName="isIndividualCustomer">
              {{
                'pw.customerCreation.isIndividualCustomer' | translate
              }}</mat-checkbox
            >
          </div>
        </div>
        <div class="row">
          <poss-web-select-dropdown
            disableOptionCentering
            #titleInput
            class="col-4"
            [placeholder]="'pw.customerCreation.titleLabel' | translate"
            [control]="institutionalCustomerForm.get('title')"
            [options]="filtersalutation(data.salutations)"
            [required]="true"
          >
          </poss-web-select-dropdown>
          <mat-form-field class="col-8">
            <mat-label>{{
              'pw.customerCreation.intitutionNameLabel' | translate
            }}</mat-label>
            <input
              matInput
              type="text"
              class="pw-uppercase"
              autocomplete="off"
              required
              formControlName="customerName"
              possWebMaxLengthValidator
              name="customerNameField"
              autofocus
            />
            <mat-error
              *ngIf="
                institutionalCustomerForm.get('customerName').errors &&
                institutionalCustomerForm.get('customerName').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  institutionalCustomerForm.get('customerName').errors
                    .errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
        </div>
        <div class="row">
          <mat-form-field class="col-12">
            <mat-label>{{
              'pw.customerCreation.contactNameLabel' | translate
            }}</mat-label>
            <input
              matInput
              type="text"
              formControlName="contactNames"
              autocomplete="off"
              class="pw-uppercase"
              required="true"
              possWebMaxLengthValidator
              name="customerNameField"
            />
            <mat-error
              *ngIf="
                institutionalCustomerForm.get('contactNames').errors &&
                institutionalCustomerForm.get('contactNames').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  institutionalCustomerForm.get('contactNames').errors
                    .errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
        </div>

        <div class="row">
          <mat-form-field class="col-6">
            <mat-label>{{
              'pw.customerCreation.contactNumberPlaceholder' | translate
            }}</mat-label>

            <input
              matInput
              type="text"
              formControlName="contactNumbers"
              autocomplete="off"
              [required]="isMobileRequiredForInstitutional === 'true'"
              (blur)="checkMobileNumberValidation($event)"
              possWebMaxLengthValidator
              name="mobileField"
            />

            <mat-error
              *ngIf="
                institutionalCustomerForm.get('contactNumbers').errors &&
                institutionalCustomerForm.get('contactNumbers').errors
                  .errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  institutionalCustomerForm.get('contactNumbers').errors
                    .errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
          <mat-form-field class="col-6">
            <mat-label>{{
              'pw.customerCreation.landlineNumberPlaceholder' | translate
            }}</mat-label>
            <input
              matInput
              type="text"
              formControlName="landlineNumber"
              autocomplete="off"
              possWebMaxLengthValidator
              name="contactNoField"
            />
            <mat-error
              *ngIf="
                institutionalCustomerForm.get('landlineNumber').errors &&
                institutionalCustomerForm.get('landlineNumber').errors
                  .errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  institutionalCustomerForm.get('landlineNumber').errors
                    .errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
        </div>

        <h4 class="pw-confirmation-box__body-item">
          {{ 'pw.customerCreation.commercialInfoHeading' | translate }}
        </h4>
        <!-- <div class="pw-confirmation-box__item">
          <mat-checkbox formControlName="form60">
            {{ 'pw.customerCreation.form60Label1' | translate }}</mat-checkbox
          >
        </div> -->
        <div class="row">
          <div class="pw-confirmation-box__item col-auto">
            <mat-checkbox formControlName="isHardCopySubmitted">
              {{
                'pw.customerCreation.hardcopyLabel' | translate
              }}</mat-checkbox
            >
          </div>
          <div class="pw-confirmation-box__item col-auto">
            <mat-checkbox
              formControlName="withInstiTaxNo"
              (change)="onCheckboxChange($event)"
            >
              {{ 'pw.customerCreation.haveGstLabel' | translate }}</mat-checkbox
            >
            <p
              *ngIf="
                institutionalCustomerForm.get('withInstiTaxNo').value === false
              "
              class="pw-error-color"
            >
              Proceeding without GST number.
            </p>
          </div>
        </div>

        <div class="row">
          <mat-form-field class="col-12">
            <mat-label
              >{{ 'pw.customerCreation.gstNoLabel' | translate }}
              {{ 'pw.customerCreation.gstFormat' | translate }}</mat-label
            >
            <input
              matInput
              type="text"
              possWebMaxLengthValidator
              name="gstNumberField"
              autocomplete="off"
              formControlName="gstNo"
              (blur)="onGstcardValueChange($event)"
              (change)="onGstValue($event)"
              [required]="
                institutionalCustomerForm.get('withInstiTaxNo').value === true
              "
              [readonly]="
                institutionalCustomerForm.get('gstNo').valid &&
                gstVerificationStatus?.status === true
              "
            />
            <mat-icon matSuffix (click)="clearGstNumber()">
              <a
                *ngIf="
                  !data.customer &&
                  institutionalCustomerForm.get('gstNo').valid &&
                  gstVerificationStatus?.status === true
                "
                class="pw-i-10 pw-close-icon-16"
              ></a
            ></mat-icon>
            <span
              *ngIf="
                (institutionalCustomerForm.get('gstNo').valid &&
                  gstVerificationStatus?.status === true) ||
                (data.customer && data.customer.isInstiTaxNoVerified)
              "
              matSuffix
              class="pw-success-color"
            >
              Verified
            </span>
            <mat-hint
              *ngIf="gstVerificationStatus?.status === false"
              class="pw-error-color pw-font-14"
            >
              {{ gstVerificationStatus.errorMessage }}
            </mat-hint>
            <mat-error
              *ngIf="
                institutionalCustomerForm.get('gstNo').errors &&
                institutionalCustomerForm.get('gstNo').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  institutionalCustomerForm.get('gstNo').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
            <!-- <mat-error
              *ngIf="
                gstVerificationStatus?.status === false &&
                institutionalCustomerForm.get('gstNo').errors?.incorrect ===
                  true
              "
            >
              {{ gstVerificationStatus.errorMessage }}
            </mat-error> -->
          </mat-form-field>
        </div>

        <div class="row">
          <mat-form-field class="col-12">
            <mat-label
              >{{ 'pw.customerCreation.pancardNumberLabel' | translate }}
              {{ 'pw.customerCreation.pancardFormat' | translate }}
            </mat-label>
            <input
              class="pw-uppercase"
              matInput
              type="text"
              possWebMaxLengthValidator
              name="pancardField"
              autocomplete="off"
              formControlName="pancard"
              (blur)="onPancardValueChange($event)"
              [readonly]="
                institutionalCustomerForm.get('pancard').valid &&
                panVerificationStatus?.verificationStatus === true
              "
            />
            <mat-icon matSuffix (click)="clearPanNumber()">
              <a
                *ngIf="
                  !data.customer &&
                  institutionalCustomerForm.get('pancard').valid &&
                  panVerificationStatus?.verificationStatus === true
                "
                class="pw-i-10 pw-close-icon-16"
              ></a
            ></mat-icon>
            <span
              *ngIf="data.customer && data.customer?.isCustTaxMatched"
              matSuffix
              class="pw-success-color"
            >
              {{ 'pw.customerCreation.profileMatchedLabel' | translate }}
            </span>
            <span
              *ngIf="
                !(data.customer && data.customer?.isCustTaxMatched) &&
                ((institutionalCustomerForm.get('pancard').valid &&
                  panVerificationStatus?.verificationStatus === true) ||
                  (data.customer && data.customer.iscustTaxNoVerified))
              "
              matSuffix
              class="pw-success-color"
            >
              Verified
            </span>
            <mat-error
              *ngIf="
                institutionalCustomerForm.get('pancard').errors &&
                institutionalCustomerForm.get('pancard').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  institutionalCustomerForm.get('pancard').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
            <mat-hint
              *ngIf="panVerificationStatus?.verificationStatus === false"
              class="pw-error-color pw-font-14"
            >
              {{ panVerificationStatus.message }}
            </mat-hint>
            <mat-hint
              class="pw-font-14"
              *ngIf="
                institutionalCustomerForm.get('pancard').valid &&
                panVerificationStatus?.verificationStatus === true &&
                panVerificationStatus?.ownerName
              "
            >
              <span class="pw-fourth-color"> PAN Holder Name</span> :
              {{ panVerificationStatus.ownerName }}</mat-hint
            >
            <mat-hint
              class="pw-font-14"
              *ngIf="
                data.customer && data.customer.panHolderName
              "
            >
              <span class="pw-fourth-color"> PAN Holder Name</span> :
              {{data.customer.panHolderName}}
            </mat-hint>
          </mat-form-field>
        </div>
      </div>
      <div class="col-6">
        <h4 class="pw-confirmation-box__body-item">Address Info</h4>
        <poss-web-address-panel
          #addressFormRef
          [submitted$]="submitted$"
          [getStateData$]="getStateData$"
          [resetForm$]="resetForm$"
          (loadCountryId)="loadCountryId($event)"
          (loadStateId)="loadStateId($event)"
          (loadAddressForm)="loadAddressForm($event)"
          (loadStateData)="loadStateData($event)"
          (loadPincodes)="loadPincodes($event)"
          [pincodeSummary]="pincodeSummary"
          [countryCode]="data.countryCode"
          [countryList]="data.countries"
          [stateList]="data.states"
          [townList]="data.towns"
          [addressDetail]="
            data.customer ? data.customer.customerDetails.data : ''
          "
          [viewMode]="false"
        ></poss-web-address-panel>
        <div class="row">
          <mat-form-field class="col-6">
            <mat-label>{{
              'pw.customerCreation.catchmentAreaLabel' | translate
            }}</mat-label>
            <input
              type="text"
              matInput
              formControlName="catchmentArea"
              autocomplete="off"
              [matAutocomplete]="auto"
              required
            />
            <mat-autocomplete #auto="matAutocomplete">
              <mat-option
                *ngFor="let option of filteredCatchmentOptions$ | async"
                [value]="option"
                >{{ option }}</mat-option
              >
            </mat-autocomplete>
            <mat-error
              *ngIf="
                institutionalCustomerForm.get('catchmentArea').errors &&
                institutionalCustomerForm.get('catchmentArea').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  institutionalCustomerForm.get('catchmentArea').errors
                    .errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
          <poss-web-select-dropdown
            disableOptionCentering
            class="col-6"
            [placeholder]="'pw.customerCreation.zoneLabel' | translate"
            [control]="institutionalCustomerForm.get('zone')"
            [options]="data.zone"
            [required]="true"
          >
          </poss-web-select-dropdown>
        </div>
        <div class="row">
          <mat-form-field class="col-12">
            <mat-label>{{
              'pw.customerCreation.emailIdLabel' | translate
            }}</mat-label>
            <input
              matInput
              type="text"
              formControlName="emailIds"
              autocomplete="off"
              name="emailField"
              [required]="isEmailRequiredForInstitutional === 'true'"
              possWebMaxLengthValidator
              (blur)="onEmailValueChange($event)"
              [readonly]="
                institutionalCustomerForm.get('emailIds').valid &&
                emailValidationStatus?.validationstatus === true
              "
            />
            <mat-icon matSuffix (click)="clearEmailValue()">
              <a
                *ngIf="
                  !data.customer &&
                  institutionalCustomerForm.get('emailIds').valid &&
                  emailValidationStatus?.validationstatus === true
                "
                class="pw-i-10 pw-close-icon-16"
              ></a
            ></mat-icon>
            <span
              *ngIf="
                (institutionalCustomerForm.get('emailIds').valid &&
                  emailValidationStatus?.validationstatus === true) ||
                (data.customer && data.customer.isEmailIdValidated)
              "
              matSuffix
              class="pw-success-color"
            >
              Validated</span
            >
            <mat-error
              *ngIf="
                institutionalCustomerForm.get('emailIds').errors &&
                institutionalCustomerForm.get('emailIds').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  institutionalCustomerForm.get('emailIds').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
            <mat-hint
              class="pw-font-14"
              *ngIf="emailValidationStatus?.invalidationreason"
            >
              <span class="pw-error-color">
                {{ emailValidationStatus?.invalidationreason }}
              </span>
            </mat-hint>
            <!-- <mat-error
              *ngIf="
                emailValidationStatus?.validationstatus === false &&
                institutionalCustomerForm.get('emailIds').errors?.incorrect ===
                  true
              "
            >
              {{ emailValidationStatus.invalidationreason }}
            </mat-error> -->
          </mat-form-field>
        </div>
      </div>
    </div>
  </div>
  <div class="pw-text-right pw-confirmation-box__footer">
    <div class="row justify-content-end">
      <div class="col-auto">
        <button
          *ngIf="!data.customer"
          class="pw-btn pw-primary-btn"
          type="button"
          (click)="clearInstitutionalForm(institutionalFormDirective)"
        >
          {{ 'pw.customerCreation.clearButton' | translate }}
        </button>
      </div>
      <div class="col-auto">
        <button class="pw-btn pw-accent-btn">
          <span *ngIf="!data.customer">
            {{ 'pw.customerCreation.createButton' | translate }}</span
          >
          <span *ngIf="data.customer">{{
            'pw.customerCreation.save' | translate
          }}</span>
        </button>
      </div>
    </div>
  </div>
</form>
