<form
  novalidate
  (ngSubmit)="validateForm()"
  [formGroup]="regularCustomerForm"
  #regularFormDirective="ngForm"
  autocomplete="off"
>
  <div class="pw-confirmation-box__body pw-confirmation-box__fixed-body">
    <div class="row">
      <div class="col-lg-4 col-6">
        <h4 class="pw-confirmation-box__body-item">
          {{ 'pw.customerCreation.customerInfoHeading' | translate }}
        </h4>
        <div class="row">
          <poss-web-select-dropdown
            disableOptionCentering
            #titleInput
            class="col-4"
            [placeholder]="'pw.customerCreation.titleLabel' | translate"
            [control]="regularCustomerForm.get('title')"
            [options]="data.salutations"
            [required]="true"
          >
          </poss-web-select-dropdown>

          <mat-form-field class="col-8">
            <mat-label>{{
              'pw.customerCreation.customerNameLabel' | translate
            }}</mat-label>
            <input
              class="pw-uppercase"
              matInput
              type="text"
              required
              formControlName="customerName"
              possWebMaxLengthValidator
              name="customerNameField"
              autocomplete="off"
            />
            <mat-error
              *ngIf="
                regularCustomerForm.get('customerName').errors &&
                regularCustomerForm.get('customerName').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  regularCustomerForm.get('customerName').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
        </div>

        <div class="row align-items-center">
          <mat-form-field class="col-8">
            <mat-label>{{
              'pw.customerCreation.mobileNoLabel' | translate
            }}</mat-label>
            <input
              matInput
              type="text"
              autocomplete="off"
              required
              formControlName="mobile"
              possWebMaxLengthValidator
              name="mobileField"
              (blur)="
                regularCustomerForm.get('mobile').valid || validMobile === false
                  ? loadIsUniqueCustomer.emit({
                      searchType: 'MOBILE_NO',
                      value: $event.target.value
                    })
                  : ''
              "
            />
            <mat-error
              *ngIf="
                regularCustomerForm.get('mobile').errors &&
                regularCustomerForm.get('mobile').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  regularCustomerForm.get('mobile').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
          <div class="col-4">
            <button
              *ngIf="showAddNumber"
              [disabled]="data.customer"
              mat-button
              class="pw-fourth-color"
              (click)="addcontactNumbers()"
              type="button"
            >
              +
            </button>
          </div>
        </div>
        <div class="row" *ngIf="altNumber">
          <mat-form-field class="col-12">
            <mat-label>{{
              'pw.customerCreation.altNumberPlaceholder' | translate
            }}</mat-label>

            <input
              matInput
              type="text"
              formControlName="altContactNo"
              possWebMaxLengthValidator
              name="contactNoField"
              autocomplete="off"
            />

            <mat-error
              *ngIf="
                regularCustomerForm.get('altContactNo').errors &&
                regularCustomerForm.get('altContactNo').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  regularCustomerForm.get('altContactNo').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
        </div>
        <div class="row">
          <mat-form-field class="col-12">
            <mat-label>{{
              'pw.customerCreation.emailIdLabel' | translate
            }}</mat-label>
            <input
              matInput
              type="email"
              [required]="isEmailRequiredForEncircle === 'true'"
              possWebMaxLengthValidator
              name="emailField"
              formControlName="emailId"
              autocomplete="off"
              (blur)="onEmailValueChange($event)"
              [readonly]="
                regularCustomerForm.get('emailId').valid &&
                emailValidationStatus?.validationstatus === true
              "
            />
            <mat-icon matSuffix (click)="clearEmailValue()">
              <a
                *ngIf="
                  !data.customer &&
                  regularCustomerForm.get('emailId').valid &&
                  emailValidationStatus?.validationstatus === true
                "
                class="pw-i-10 pw-close-icon-16"
              ></a
            ></mat-icon>
            <span
              *ngIf="
                (regularCustomerForm.get('emailId').valid &&
                  emailValidationStatus?.validationstatus === true) ||
                (data.customer && data.customer.isEmailIdValidated)
              "
              matSuffix
              class="pw-success-color"
            >
              Validated</span
            >
            <mat-error
              *ngIf="
                regularCustomerForm.get('emailId').errors &&
                regularCustomerForm.get('emailId').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  regularCustomerForm.get('emailId').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
            <mat-hint
              class="pw-font-14"
              *ngIf="emailValidationStatus?.invalidationreason"
            >
              <span class="pw-error-color">
                {{ emailValidationStatus?.invalidationreason }}
              </span>
            </mat-hint>
            <!-- <mat-error
              *ngIf="
                emailValidationStatus?.validationstatus === false &&
                regularCustomerForm.get('emailId').errors?.incorrect === true
              "
            >
              {{ emailValidationStatus.invalidationreason }}
            </mat-error> -->
          </mat-form-field>
        </div>
        <h4 class="pw-confirmation-box__body-item">
          {{ 'pw.customerCreation.loyaltyInfoheading' | translate }}
        </h4>
        <div class="row">
          <mat-form-field class="pw-single-bordered-input col-12">
            <mat-label>{{
              'pw.customerCreation.birthDayLabel' | translate
            }}</mat-label>
            <input
              matInput
              [matDatepicker]="birthdayPicker"
              autocomplete="off"
              [max]="currentDate"
              formControlName="birthday"
              (click)="birthdayPicker.open()"
              (ngModelChange)="
                regularCustomerForm.get('anniversary').updateValueAndValidity()
              "
              readonly
            />
            <mat-datepicker-toggle matSuffix [for]="birthdayPicker">
              <mat-icon matDatepickerToggleIcon>
                <span class="pw-i-12 pw-calender-icon-12"></span>
              </mat-icon>
            </mat-datepicker-toggle>
            <mat-datepicker #birthdayPicker></mat-datepicker>
            <mat-error
              *ngIf="
                regularCustomerForm.get('birthday').errors &&
                regularCustomerForm.get('birthday').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  regularCustomerForm.get('birthday').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
        </div>
        <div class="row">
          <mat-form-field class="pw-single-bordered-input col-12">
            <mat-label>{{
              'pw.customerCreation.spousebirthDayLabel' | translate
            }}</mat-label>
            <input
              matInput
              [matDatepicker]="spouseBirthdayPicker"
              autocomplete="off"
              [max]="currentDate"
              formControlName="spouseBirthday"
              (click)="spouseBirthdayPicker.open()"
              (ngModelChange)="
                regularCustomerForm.get('anniversary').updateValueAndValidity()
              "
              readonly
            />
            <mat-datepicker-toggle matSuffix [for]="spouseBirthdayPicker">
              <mat-icon matDatepickerToggleIcon>
                <span class="pw-i-12 pw-calender-icon-12"></span>
              </mat-icon>
            </mat-datepicker-toggle>
            <mat-datepicker #spouseBirthdayPicker></mat-datepicker>
            <mat-error
              *ngIf="
                regularCustomerForm.get('spouseBirthday').errors &&
                regularCustomerForm.get('spouseBirthday').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  regularCustomerForm.get('spouseBirthday').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
        </div>
        <div class="row">
          <mat-form-field class="pw-single-bordered-input col-12">
            <mat-label>{{
              'pw.customerCreation.anniversaryLabel' | translate
            }}</mat-label>
            <input
              matInput
              [matDatepicker]="anniversaryPicker"
              autocomplete="off"
              [max]="currentDate"
              [min]="minDateValidation()"
              formControlName="anniversary"
              (click)="anniversaryPicker.open()"
              readonly
            />
            <mat-datepicker-toggle matSuffix [for]="anniversaryPicker">
              <mat-icon matDatepickerToggleIcon>
                <span class="pw-i-12 pw-calender-icon-12"></span>
              </mat-icon>
            </mat-datepicker-toggle>
            <mat-datepicker #anniversaryPicker></mat-datepicker>
            <mat-error
              *ngIf="
                regularCustomerForm.get('anniversary').errors &&
                regularCustomerForm.get('anniversary').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  regularCustomerForm.get('anniversary').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
            <mat-error *ngIf="regularCustomerForm.get('anniversary').invalid">
              {{ 'pw.customerCreation.invalidateErrorMsg' | translate }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="col-lg-4 col-6">
        <h4 class="pw-confirmation-box__body-item">Address Info</h4>
        <poss-web-encircle-address-panel
          #addressFormRef
          [submitted$]="submitted$"
          [getStateData$]="getStateData$"
          (loadStateData)="loadStateData($event)"
          (loadCountryId)="loadCountryId($event)"
          (loadStateId)="loadStateId($event)"
          (loadAddressForm)="loadAddressForm($event)"
          (loadPincodes)="loadPincodes($event)"
          [pincodeSummary]="pincodeSummary"
          [countryList]="data.countries"
          [stateList]="data.states"
          [townList]="data.towns"
          [countryCode]="data.countryCode"
          [addressDetail]="
            data.customer ? data.customer.customerDetails.data : ''
          "
          [isAdvancebookingType]="isAdvancebookingType"
          [viewMode]="false"
        ></poss-web-encircle-address-panel>
        <div class="row">
          <mat-form-field class="col-6">
            <mat-label>{{
              'pw.customerCreation.catchmentAreaLabel' | translate
            }}</mat-label>
            <input
              type="text"
              matInput
              formControlName="catchmentArea"
              [matAutocomplete]="auto"
              autocomplete="off"
              [required]="!this.data.customer"
            />
            <mat-autocomplete #auto="matAutocomplete">
              <mat-option
                *ngFor="let option of filteredCatchmentOptions$ | async"
                [value]="option"
                >{{ option }}</mat-option
              >
            </mat-autocomplete>
            <mat-error
              *ngIf="
                regularCustomerForm.get('catchmentArea').errors &&
                regularCustomerForm.get('catchmentArea').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  regularCustomerForm.get('catchmentArea').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
          <poss-web-select-dropdown
            disableOptionCentering
            class="col-6"
            [placeholder]="'pw.customerCreation.zoneLabel' | translate"
            [control]="regularCustomerForm.get('zone')"
            [options]="data.zone"
            [required]="true"
          >
          </poss-web-select-dropdown>
        </div>
      </div>

      <div class="col-lg-4 col-6">
        <h4 class="pw-confirmation-box__body-item">
          {{ 'pw.customerCreation.commercialInfoHeading' | translate }}
        </h4>
        <div class="pw-confirmation-box__item">
          <mat-checkbox formControlName="isHardCopySubmitted">
            {{ 'pw.customerCreation.hardcopyLabel' | translate }}</mat-checkbox
          >
        </div>
        <!-- <div class="pw-confirmation-box__item">
          <mat-checkbox
            formControlName="withInstiTaxNo"
            (change)="onCheckboxChange($event)"
          >
            {{ 'pw.customerCreation.haveGstLabel' | translate }}</mat-checkbox
          >
        </div>
        <div class="row">
          <mat-form-field
            class="col-12"
            *ngIf="regularCustomerForm.get('withInstiTaxNo').value === true"
          >
            <mat-label
              >{{ 'pw.customerCreation.gstNoLabel' | translate }}
              {{ 'pw.customerCreation.gstFormat' | translate }}</mat-label
            >
            <input
              matInput
              type="text"
              possWebMaxLengthValidator
              name="gstNumberField"
              autocomplete="off"
              formControlName="gstNo"
              (blur)="onGstcardValueChange($event)"
              (change)="onGstValue($event)"
              [required]="
                regularCustomerForm.get('withInstiTaxNo').value === true
              "
              [readonly]="
                regularCustomerForm.get('gstNo').valid &&
                gstVerificationStatus?.status === true
              "
            />

            <span
              *ngIf="
                (regularCustomerForm.get('gstNo').valid &&
                  gstVerificationStatus?.status === true) ||
                (data.customer && data.customer.isInstiTaxNoVerified)
              "
              matSuffix
              class="pw-success-color"
            >
              Verified</span
            >
            <mat-error
              *ngIf="
                regularCustomerForm.get('gstNo').errors &&
                regularCustomerForm.get('gstNo').errors.errorArray
              "
            >
              <span
                *ngFor="
                  let errorMesage of regularCustomerForm.get('gstNo').errors
                    .errorArray;
                  let i = index
                "
              >
                <span *ngIf="i === 0"> {{ errorMesage }}</span>
                <poss-web-error-info-tooltip
                  *ngIf="i > 0"
                  [errorMessage]="errorMesage"
                ></poss-web-error-info-tooltip>
              </span>
            </mat-error>
            <mat-error
              *ngIf="
                gstVerificationStatus?.status === false &&
                regularCustomerForm.get('gstNo').errors?.incorrect === true
              "
            >
              {{ gstVerificationStatus.errorMessage }}
            </mat-error>
          </mat-form-field>
        </div> -->
        <div class="row">
          <mat-form-field class="col-12">
            <mat-label
              >{{ 'pw.customerCreation.pancardNumberLabel' | translate }}
              {{ 'pw.customerCreation.pancardFormat' | translate }}
            </mat-label>
            <input
              class="pw-uppercase"
              matInput
              type="text"
              possWebMaxLengthValidator
              name="pancardField"
              autocomplete="off"
              formControlName="pancard"
              [required]="
                regularCustomerForm.get('withInstiTaxNo').value &&
                regularCustomerForm.get('gstNo').value !== ''
              "
              (blur)="onPancardValueChange($event)"
              [readonly]="
                regularCustomerForm.get('pancard').valid &&
                panVerificationStatus?.verificationStatus === true
              "
            />
            <mat-icon matSuffix (click)="clearPanNumber()">
              <a
                *ngIf="
                  !data.customer &&
                  regularCustomerForm.get('pancard').valid &&
                  panVerificationStatus?.verificationStatus === true
                "
                class="pw-i-10 pw-close-icon-16"
              ></a
            ></mat-icon>
            <span
              *ngIf="data.customer && data.customer?.isCustTaxMatched"
              matSuffix
              class="pw-success-color pw-margin-left-negative-5"
            >
              {{ 'pw.customerCreation.profileMatchedLabel' | translate }}
            </span>
            <span
              *ngIf="
                (regularCustomerForm.get('pancard').valid &&
                  panVerificationStatus?.verificationStatus === true) ||
                (data.customer && data.customer.iscustTaxNoVerified)
              "
              matSuffix
              class="pw-success-color"
            >
              {{ 'pw.customerCreation.verifiedLabel' | translate }}
            </span>
            <mat-error
              *ngIf="
                regularCustomerForm.get('pancard').errors &&
                regularCustomerForm.get('pancard').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  regularCustomerForm.get('pancard').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
            <mat-hint
              *ngIf="panVerificationStatus?.verificationStatus === false"
              class="pw-error-color pw-font-14"
            >
              {{ panVerificationStatus.message }}
            </mat-hint>
            <mat-hint
              class="pw-font-14"
              *ngIf="
                regularCustomerForm.get('pancard').valid &&
                panVerificationStatus?.verificationStatus === true &&
                panVerificationStatus?.ownerName
              "
            >
              <span class="pw-fourth-color"> PAN Holder Name</span> :
              {{ panVerificationStatus.ownerName }}
            </mat-hint>
            <mat-hint
              class="pw-font-14"
              *ngIf="data.customer && data.customer.panHolderName"
            >
              <span class="pw-fourth-color"> PAN Holder Name</span> :
              {{ data.customer.panHolderName }}
            </mat-hint>
          </mat-form-field>
        </div>
        <!-- <div class="pw-confirmation-box__item">
          <mat-checkbox formControlName="form60">
            {{ 'pw.customerCreation.form60Label1' | translate }}</mat-checkbox
          >
        </div> -->
        <div class="pw-confirmation-box__item">
          <mat-checkbox
            formControlName="isform60IdProof"
            (change)="onform60IdProofChange($event)"
            [disabled]="
              data.customer && regularCustomerForm.get('pancard').value !== ''
            "
          >
            {{ 'pw.customerCreation.form60Label' | translate }}</mat-checkbox
          >
        </div>
        <div
          class="row"
          *ngIf="regularCustomerForm.get('isform60IdProof').value === true"
        >
          <poss-web-select-dropdown
            disableOptionCentering
            class="col-12"
            [placeholder]="'pw.customerCreation.typeOfProofLabel' | translate"
            [control]="regularCustomerForm.get('form60AndIdProofSubmitted')"
            [options]="data.idProofs"
            [required]="
              regularCustomerForm.get('isform60IdProof').value === true
            "
            [disabled]="regularCustomerForm.get('pancard').value"
          >
          </poss-web-select-dropdown>
        </div>
        <div
          class="row"
          *ngIf="regularCustomerForm.get('isform60IdProof').value === true"
        >
          <mat-form-field class="col-12">
            <mat-label>{{
              'pw.customerCreation.idNumberLabel' | translate
            }}</mat-label>

            <input
              matInput
              type="text"
              autocomplete="off"
              formControlName="idNumber"
              [required]="
                regularCustomerForm.get('isform60IdProof').value === true
              "
            />
            <!-- <span
              *ngIf='data.customer && data.customer?.isForm60Matched'
              matSuffix
              class="pw-success-color"
            >
            {{ 'pw.customerCreation.profileMatchedLabel' | translate }}
              </span> -->
            <mat-error
              *ngIf="
                regularCustomerForm.get('idNumber').errors &&
                regularCustomerForm.get('idNumber').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  regularCustomerForm.get('idNumber').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
        </div>

        <br />
        <h4>{{ 'pw.customerCreation.otherInfoHeading' | translate }}</h4>
        <br />
        <div class="row">
          <div class="col-6">
            <mat-checkbox formControlName="canSendSMS">{{
              'pw.customerCreation.sendSMSLabel' | translate
            }}</mat-checkbox>
          </div>
          <div class="col-6">
            <mat-checkbox formControlName="isActive">{{
              'pw.customerCreation.isActiveLabel' | translate
            }}</mat-checkbox>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="pw-text-right pw-confirmation-box__footer">
    <div class="row justify-content-end">
      <div class="col-auto">
        <button
          *ngIf="!data.customer"
          class="pw-btn pw-primary-btn"
          type="button"
          (click)="clearRegularForm(regularFormDirective)"
        >
          {{ 'pw.customerCreation.clearButton' | translate }}
        </button>
      </div>
      <div class="col-auto">
        <button class="pw-btn pw-accent-btn">
          <span *ngIf="!data.customer">
            {{ 'pw.customerCreation.createButton' | translate }}</span
          >
          <span *ngIf="data.customer">{{
            'pw.customerCreation.save' | translate
          }}</span>
        </button>
      </div>
    </div>
  </div>
</form>
