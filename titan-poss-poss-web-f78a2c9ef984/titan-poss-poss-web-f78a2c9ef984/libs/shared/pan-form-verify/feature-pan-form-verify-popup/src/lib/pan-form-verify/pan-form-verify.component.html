<div class="pw-pan-verify__container">
  <div
    class="row pw-pan-verify__header pw-cursor-grab"
    cdkDragBoundary=".cdk-overlay-container"
    cdkDragRootElement=".cdk-overlay-pane"
    cdkDrag
    cdkDragHandle
  >
    <h3 class="pw-message col-auto">
      {{ 'pw.panFormVerifyPopup.panDetailsForm60DetailsLabel' | translate }}
    </h3>

    <div class="col pw-text-right">
      <button
        class="pw-pan-verify__icon-btn"
        mat-icon-button
        (click)="close()"
      >
        <mat-icon>
          <span class="pw-i-24 pw-close-no-border-icon-24"></span>
        </mat-icon>
      </button>
    </div>
  </div>
  <div class="pw-confirmation-box__body">
    <mat-divider></mat-divider>
    <form [formGroup]="formGroup">
      <mat-tab-group mat-stretch-tabs (selectedTabChange)="setValidators($event)" [selectedIndex]='data?.customerType === customerTypeEnumRef.INTERNATIONAL ? 1: 0'>
        <mat-tab label="{{ 'pw.panFormVerifyPopup.panCardTabLabel' | translate }}" [disabled]='data?.customerType === customerTypeEnumRef.INTERNATIONAL'>
          <div class="pw-confirmation-box__item pw-overflow-hidden">
            <div class="row pw-confirmation-box__item">
              <mat-form-field class="col-7">
                <mat-label>{{ 'pw.panFormVerifyPopup.panCardLabel' | translate }}
                </mat-label>
                <input class="pw-uppercase" formControlName='panCard' matInput />
                <mat-error
                  *ngIf="
                    formGroup.get('panCard').errors &&
                    formGroup.get('panCard').errors.errorArray
                  "
                >
                  <poss-web-error-info-tooltip
                    [errorMessage]="formGroup.get('panCard').errors.errorArray"
                  ></poss-web-error-info-tooltip>
                </mat-error>
                <mat-error
                  *ngIf="
                  formGroup.get('panCard').hasError('retype') &&
                    !formGroup.get('panCard').hasError('required')
                  "
                  >{{
                    'pw.panFormVerifyPopup.confirmpanCardRetypeErrorMessage' | translate
                  }}
                </mat-error>
              </mat-form-field>
            </div>
            <div class="row pw-confirmation-box__item">
              <mat-form-field class="col-7">
                <mat-label>{{ 'pw.panFormVerifyPopup.retypePanCardLabel' | translate }}
                </mat-label>
                <input class="pw-uppercase" formControlName='retypePanCard' matInput />
                <mat-error
                  *ngIf="
                    formGroup.get('retypePanCard').errors &&
                    formGroup.get('retypePanCard').errors.errorArray
                  "
                >
                  <poss-web-error-info-tooltip
                    [errorMessage]="formGroup.get('retypePanCard').errors.errorArray"
                  ></poss-web-error-info-tooltip>
                </mat-error>
                <mat-error
              *ngIf="
              formGroup.get('retypePanCard').hasError('retype') &&
                !formGroup.get('retypePanCard').hasError('required')
              "
              >{{
                'pw.panFormVerifyPopup.confirmpanCardRetypeErrorMessage' | translate
              }}
            </mat-error>
              </mat-form-field>
              <div class="col-auto" *ngIf='isPanVerificationEnabled'>
                <div class="col-auto">
                  <button mat-flat-button class="pw-btn pw-accent-btn" (click)='verifyPanDetails()'>
                    {{ 'pw.panFormVerifyPopup.verifyButtonLabel' | translate }}
                  </button>
                </div>
              </div>
            </div>
            <ng-container *ngIf='isVerificationInitiated'>
              <ng-container *ngIf='isPanVerificationEnabled'>
                <div class="row pw-confirmation-box__item">
                  <div class="col-lg-4 col-4 pw-confirmation-box__label">
                    {{ 'pw.panFormVerifyPopup.nameLabel' | translate }}
                  </div>
                  <div class="col-auto pw-confirmation-box__label">
                    : {{ panDetailsResponse?.name }}
                  </div>
                  <div class="col pw-font-weight-bold"></div>
                </div>
                <div class="row pw-confirmation-box__item">
                  <div class="col-lg-4 col-4 pw-confirmation-box__label">
                    {{ 'pw.panFormVerifyPopup.statusLabel' | translate }}
                  </div>
                  <div class="col-auto pw-confirmation-box__label" *ngIf="panDetailsResponse?.verificationStatus">
                    : {{ 'pw.panFormVerifyPopup.validVerificationStatys' | translate }}
                  </div>
                  <div class="col-auto pw-confirmation-box__label" *ngIf="!panDetailsResponse?.verificationStatus">
                    : {{ 'pw.panFormVerifyPopup.invalidVerificationStatys' | translate }}
                  </div>
                  <div class="col pw-font-weight-bold"></div>
                </div>
                <div class="row pw-confirmation-box__item">
                  <div class="col-lg-4 col-4 pw-confirmation-box__label">
                    {{ 'pw.panFormVerifyPopup.CategoryLabel' | translate }}
                  </div>
                  <div class="col-auto pw-confirmation-box__label">
                    : {{ panDetailsResponse?.category }}
                  </div>
                  <div class="col pw-font-weight-bold"></div>
                </div>
              </ng-container>
              <div class='row pw-confirmation-box__item'>
                <div class="col-7">
                  <mat-checkbox formControlName="isHardCopySubmitted">{{ 'pw.panFormVerifyPopup.isHardCopySubmittedLabel' | translate}}</mat-checkbox>
                  <mat-error
                    *ngIf="
                      formGroup.get('isHardCopySubmitted').errors &&
                      formGroup.get('isHardCopySubmitted').errors.errorArray &&
                      formGroup.get('isHardCopySubmitted').touched
                    "
                  >
                    <poss-web-error-info-tooltip
                      [errorMessage]="formGroup.get('isHardCopySubmitted').errors.errorArray"
                    ></poss-web-error-info-tooltip>
                  </mat-error>
                </div>
              </div>
              <div class='row pw-confirmation-box__item'>
                <div class="col-7">
                  <mat-radio-group formControlName="isMatched">
                    <mat-radio-button
                      class="pw-filter-box__radio-btn"
                      value=true
                    >
                        {{
                          'pw.panFormVerifyPopup.matchedLabel' | translate
                        }}
                    </mat-radio-button>
                    <mat-radio-button
                      value=false
                      class="pw-filter-box__radio-btn"
                    >
                        {{
                          'pw.panFormVerifyPopup.notMatchedLabel'
                            | translate
                        }}
                    </mat-radio-button>
                    <mat-error
                      *ngIf="
                        formGroup.get('isMatched').errors &&
                        formGroup.get('isMatched').errors.errorArray &&
                        formGroup.get('isMatched').touched
                      "
                    >
                      <poss-web-error-info-tooltip
                        [errorMessage]="formGroup.get('isMatched').errors.errorArray"
                      ></poss-web-error-info-tooltip>
                    </mat-error>
                  </mat-radio-group>
              </div>
              </div>
            </ng-container>
          </div>
        </mat-tab>

        <mat-tab label="{{ 'pw.panFormVerifyPopup.formTabLabel' | translate }}" [disabled]='custPanNumber !== "" || data?.customerType === customerTypeEnumRef.INSTITUTIONAL || data?.customerType === customerTypeEnumRef.ONE_TIME'>
          <div class="pw-confirmation-box__item pw-overflow-hidden">
            <div class="row pw-confirmation-box__item">
              <poss-web-select-dropdown
                disableOptionCentering
                class="col-12"
                [placeholder]="'pw.panFormVerifyPopup.typeOfProofLabel' | translate"
                [control]="formGroup.get('form60AndIdProofSubmitted')"
                [options]=idProofs
              >
              </poss-web-select-dropdown>
            </div>
            <div class="row pw-confirmation-box__item">
              <mat-form-field class="col-12">
                <mat-label>{{
                  'pw.panFormVerifyPopup.idNumberLabel' | translate
                }}</mat-label>

                <input
                  matInput
                  type="text"
                  autocomplete="off"
                  formControlName="idNumber"
                />
                <mat-error
                  *ngIf="
                  formGroup.get('idNumber').errors &&
                  formGroup.get('idNumber').errors.errorArray
                  "
                >
                  <poss-web-error-info-tooltip
                    [errorMessage]="
                    formGroup.get('idNumber').errors.errorArray
                    "
                  ></poss-web-error-info-tooltip>
                </mat-error>
              </mat-form-field>
            </div>
            <div class='row pw-confirmation-box__item'>
              <div class="col-7">
                <mat-checkbox formControlName="isHardCopySubmitted">{{ 'pw.panFormVerifyPopup.isHardCopySubmittedLabel' | translate}}</mat-checkbox>
                <mat-error
                  *ngIf="
                    formGroup.get('isHardCopySubmitted').errors &&
                    formGroup.get('isHardCopySubmitted').errors.errorArray &&
                    formGroup.get('isHardCopySubmitted').touched
                  "
                >
                  <poss-web-error-info-tooltip
                    [errorMessage]="formGroup.get('isHardCopySubmitted').errors.errorArray"
                  ></poss-web-error-info-tooltip>
                </mat-error>
              </div>
            </div>
            <div class='row pw-confirmation-box__item'>
              <div class="col-7">
                <mat-radio-group formControlName="isMatched">
                  <mat-radio-button
                    class="pw-filter-box__radio-btn"
                    value=true
                  >
                      {{
                        'pw.panFormVerifyPopup.matchedLabel' | translate
                      }}
                  </mat-radio-button>
                  <mat-radio-button
                    value=false
                    class="pw-filter-box__radio-btn"
                  >
                      {{
                        'pw.panFormVerifyPopup.notMatchedLabel'
                          | translate
                      }}
                  </mat-radio-button>
                  <mat-error
                    *ngIf="
                      formGroup.get('isMatched').errors &&
                      formGroup.get('isMatched').errors.errorArray &&
                      formGroup.get('isMatched').touched
                    "
                  >
                    <poss-web-error-info-tooltip
                      [errorMessage]="formGroup.get('isMatched').errors.errorArray"
                    ></poss-web-error-info-tooltip>
                  </mat-error>
                </mat-radio-group>
            </div>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </form>
  </div>
  <mat-divider></mat-divider>
  <div class="pw-confirmation-box__footer-box row pw-text-right">
    <mat-divider></mat-divider>
    <div class="col-auto pw-confirmation-box__right-content">
      <button mat-flat-button class="pw-btn pw-accent-btn" (click)='close()'>
        {{ 'pw.panFormVerifyPopup.cancelButtonLabel' | translate }}
      </button>
    </div>
    <div class="col-auto">
      <button mat-flat-button class="pw-btn pw-accent-btn" (click)='submit()' [disabled]='verificationType === verificationTypeEnumRef.PAN_CARD && !isVerificationInitiated'>
        {{ 'pw.panFormVerifyPopup.confirmButtonLabel' | translate }}
      </button>
    </div>
  </div>
  <poss-web-loader *ngIf="isLoading$ | async"> </poss-web-loader>
</div>


