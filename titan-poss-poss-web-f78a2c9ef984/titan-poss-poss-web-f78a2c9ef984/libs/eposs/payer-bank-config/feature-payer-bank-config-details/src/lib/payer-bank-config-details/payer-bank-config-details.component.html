<div class="container-fluid">
  <div class="row">
    <div class="col-12 col-lg-10 m-auto">
      <div class="pw-top-heading-container">
        <div class="row pw-top-heading-container__item">
          <div class="col-auto">
            <div class="pw-top-heading-container__main-head">
              <a (click)="back()">
                <span class="pw-i-24 pw-back-arrow-icon-24"></span>
              </a>
              <span class="pw-i-36 pw-company-icon-36"></span>
              <div>
                <h2>
                  {{
                    'pw.payerBankConfiguration.customerLabelText' | translate
                  }}
                </h2>
                <h5 class="pw-top-heading-container__sub-heading">
                  {{
                    'pw.payerBankConfiguration.configurationLabelText'
                      | translate
                  }}
                </h5>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row pw-sub-header">
        <div class="col-auto">
          <div class="pw-sub-header__padding-heading">
            {{ 'pw.payerBankConfiguration.payerBankDetailsLabel' | translate }}
          </div>
        </div>
      </div>
      <ng-container *ngIf="!showViewOnly; else elseTemplate">
        <div [formGroup]="bankDetailsFormGroup">
          <div class="pw-form-card">
            <div class="row">
              <mat-form-field class="col-lg-3 col-5">
                <mat-label class="pw-fourth-color">
                  {{
                    'pw.payerBankConfiguration.configurationNameLabel'
                      | translate
                  }}</mat-label
                >
                <input
                  matInput
                  class="pw-single-bordered-input"
                  formControlName="configName"
                />
                <mat-error
                  *ngIf="
                    bankDetailsFormGroup.get('configName').errors &&
                    bankDetailsFormGroup.get('configName').errors.errorArray
                  "
                >
                  <poss-web-error-info-tooltip
                    [errorMessage]="
                      bankDetailsFormGroup.get('configName').errors.errorArray
                    "
                  ></poss-web-error-info-tooltip>
                </mat-error>
              </mat-form-field>

              <poss-web-select-dropdown
                class="col-lg-3 col-5"
                [placeholder]="
                  'pw.payerBankConfiguration.payementModeLabel' | translate
                "
                [control]="bankDetailsFormGroup.get('paymentMode')"
                [options]="paymentModes"
                [required]="true"
                (selectionChange)="selectionChange($event.value)"
              >
              </poss-web-select-dropdown>


            </div>
          </div>
          <div class="pw-form-card" [hidden]="hidden">
            <div class="pw-font-weight-bold">
              {{
                'pw.payerBankConfiguration.selectPreferencesLabel' | translate
              }}
            </div>
            <div class="pw-form-card__margin-top">
              <mat-checkbox
                class="col-auto"
                formControlName="isCardMandatory"
                >{{
                  'pw.payerBankConfiguration.isCardMandatoryLabel' | translate
                }}</mat-checkbox
              >
            </div>
            <div
              class="row pw-form-card__margin-top"
              class="col-auto"
              *ngFor="let cards of cardsList"
            >
              <mat-checkbox
                class="col-auto"
                [formControlName]="cards.id"
                (change)="change($event)"
                id="{{ cards.id }}"
                >{{ cards.name }}</mat-checkbox
              >
            </div>
            <div class="pw-form-card__margin-top">
              <mat-checkbox
                class="col-auto"
                formControlName="isBankMandatory"
                >{{
                  'pw.payerBankConfiguration.isBankMandatoryLabel' | translate
                }}</mat-checkbox
              >
            </div>
          </div>
        </div>
      </ng-container>
      <ng-template #elseTemplate>
        <div>
          <div class="pw-form-card">
            <div class="row">
              <div class="pw-form-card__margin-bottom col-4">
                <div class="row">
                  <div class="col-5">
                    <span class="pw-fourth-color">
                      {{
                        'pw.payerBankConfiguration.configurationNameLabel'
                          | translate
                      }}
                    </span>
                  </div>
                  <div class="col-auto pw-form-card__padding-5">
                    <span> : </span>
                  </div>
                  <div class="col-6 pw-form-card__padding-5">
                    {{ configDetails?.description }}
                  </div>
                </div>
              </div>
              <div class="pw-form-card__margin-bottom col-4">
                <div class="row">
                  <div class="col-5">
                    <span class="pw-fourth-color">
                      {{
                        'pw.payerBankConfiguration.payementModeLabel'
                          | translate
                      }}
                    </span>
                  </div>
                  <div class="col-auto pw-form-card__padding-5">
                    <span> : </span>
                  </div>
                  <div class="col-6 pw-form-card__padding-5">
                    {{ configDetails?.paymentCode }}
                  </div>
                </div>
              </div>

              <div class="col-auto pw-detail-card__right-container">
                <poss-web-toggle-button
                  class="col-6 pw-form-card__padding-5"
                  [isActive]="configDetails?.isActive"
                  [isDisabled]="true"
                >
                </poss-web-toggle-button>
              </div>
            </div>
          </div>
          <div class="pw-form-card" [hidden]="hidden">
            <div class="pw-font-weight-bold">
              {{
                'pw.payerBankConfiguration.selectPreferencesLabel' | translate
              }}
            </div>
            <div class="pw-form-card__margin-top">
              <mat-checkbox class="col-auto" disabled>{{
                'pw.payerBankConfiguration.isCardMandatoryLabel' | translate
              }}</mat-checkbox>
            </div>
            <div
              class="row pw-form-card__margin-top"
              class="col-auto"
              *ngFor="let cards of cardsList"
            >
              <mat-checkbox class="col-auto" disabled id="{{ cards.id }}">{{
                cards.name
              }}</mat-checkbox>
            </div>
            <div class="pw-form-card__margin-top">
              <mat-checkbox class="col-auto" disabled>{{
                'pw.payerBankConfiguration.isBankMandatoryLabel' | translate
              }}</mat-checkbox>
            </div>
          </div>
        </div>
      </ng-template>

      <ng-container *ngIf="!showViewOnly; else elseTemplateGrid">
        <poss-web-payer-bank-config-detail
          [banksList]="payerBanks"
          [selectedBanks]="selectedBanksList"
          (addedBank)="addedBank($event)"
          (removedBank)="removedBank($event)"
          [count]="banksCount$ | async"
          [pageEvent]="payerBankConfigPageEvent"
          (paginator)="paginate($event)"
          [pageSizeOptions]="pageSizeOptions"
          [minPageSize]="minPageSize"
          (selectionChange)="rowSelectionChange($event)"
          (emitSearchValue)="search($event)"
          (loadDetails)="loadPayerBanks()"
        ></poss-web-payer-bank-config-detail>
        <div class="row mb-3 pw-mr-n13">
          <div class="col-auto ml-auto">
            <button
              class="pw-btn pw-primary-btn"
              (click)="locationMapping()"
              [disabled]="disable"
            >
              {{ 'pw.payerBankConfiguration.locationMappingLabel' | translate }}
            </button>
          </div>
          <div class="col-auto">
            <button
              class="pw-btn pw-accent-btn"
              [disabled]="bankDetailsFormGroup.invalid || !rowChange"
              (click)="save()"
            >
              {{ 'pw.payerBankConfiguration.saveLabel' | translate }}
            </button>
          </div>
        </div>
      </ng-container>
      <ng-template #elseTemplateGrid>
        <poss-web-payer-bank-config-view
          [banksList]="payerBanks"
          [selectedBanks]="selectedBanksList"
          (addedBank)="addedBank($event)"
          (removedBank)="removedBank($event)"
          [count]="banksCount$ | async"
          [pageEvent]="payerBankConfigPageEvent"
          (paginator)="paginate($event)"
          [pageSizeOptions]="pageSizeOptions"
          [minPageSize]="minPageSize"
          (selectionChange)="rowSelectionChange($event)"
        ></poss-web-payer-bank-config-view>
        <div class="row mb-3 pw-mr-n13">
          <div class="col-auto ml-auto">
            <button
              class="pw-btn pw-primary-btn"
              (click)="openViewLocationMapping()"
              [disabled]="disable"
            >
              {{ 'pw.payerBankConfiguration.locationMappingLabel' | translate }}
            </button>
          </div>
        </div>
      </ng-template>

      <poss-web-loader *ngIf="isLoading$ | async"> </poss-web-loader>
    </div>
  </div>
</div>
