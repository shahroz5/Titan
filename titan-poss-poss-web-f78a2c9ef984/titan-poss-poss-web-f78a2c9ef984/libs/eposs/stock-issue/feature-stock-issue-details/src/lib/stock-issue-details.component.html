<div class="container-fluid">
  <div class="row">
    <div class="col-12 col-lg-10 m-auto">
      <div class="pw-top-heading-container">
        <div class="row pw-top-heading-container__item">
          <div class="col-auto">
            <div class="pw-top-heading-container__main-head">
              <a (click)="back()">
                <span class="pw-i-24 pw-back-arrow-icon-24"></span>
              </a>
              <span class="pw-i-36 pw-issue-stock-icon-36"></span>
              <div>
                <h2>{{ 'pw.stockIssue.title' | translate }}</h2>
                <div *ngIf="type == stockIssueTypesEnumRef.FACTORY">
                  <h5
                    class="pw-top-heading-container__sub-heading pw-fith-heading"
                  >
                    {{ 'pw.stockIssue.toLabelText' | translate }}:
                    {{ 'pw.stockIssue.factoryLabelText' | translate }}
                    <span class="pw-seventh-color"></span>
                  </h5>
                </div>
                <div *ngIf="type == stockIssueTypesEnumRef.BOUTIQUE">
                  <h5
                    class="pw-top-heading-container__sub-heading pw-fith-heading"
                  >
                    {{ 'pw.stockIssue.toLabelText' | translate }}:
                    {{ 'pw.stockIssue.boutiqueLabelText' | translate
                    }}<span class="pw-seventh-color"></span>
                  </h5>
                </div>
                <div *ngIf="type == stockIssueTypesEnumRef.MERCHANDISE">
                  <h5
                    class="pw-top-heading-container__sub-heading pw-fith-heading"
                  >
                    {{ 'pw.stockIssue.fromLabelText' | translate }}:
                    {{ 'pw.stockIssue.merchandiseLabelText' | translate
                    }}<span class="pw-seventh-color"></span>
                  </h5>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- grid-card-list  -->
      <div class="row">
        <div class="col-lg-3 col-md-4 col-6 pw-grid-card">
          <div class="pw-grid-card__item pw-is-active-bar">
            <h4>Request No: {{ selected?.reqDocNo }}</h4>

            <div>
              {{ selected?.destLocationCode }} |
              {{ selected?.destLocationDescription }}
            </div>
            <div class="mt-1">
              <p>
                {{ selected?.totalAvailableQuantity }}
                Qty. |
                {{
                  selected?.totalAvailableValue
                    | currencyFormatter: selected?.currencyCode
                }}
              </p>
              <p>
                Total Weight:
                {{ selected?.totalAvailableWeight | weightFormatter }}
                {{ selected?.weightUnit }}
              </p>
              <p>
                {{ selected?.reqDocDate | dateFormatter }}
              </p>
            </div>
          </div>
        </div>
        <div class="col-lg-2 col-md-3 col-3">
          <div *ngIf="tab == stockIsuueDetailsTabEnumRef.SELECTED_PRODUCTS_TAB">
            <div class="p-2">
              <p>
                {{ 'pw.stockIssue.measuredWeightLabelText' | translate }} :
                {{ totalMeasuredWeight | weightFormatter }}

                {{ selected?.weightUnit }}
              </p>
              <p class="pt-2">
                {{ 'pw.stockIssue.measuredValueLabelText' | translate }} :
                {{
                  selected?.totalMeasuredValue
                    | currencyFormatter: selected?.currencyCode
                }}
              </p>
            </div>
          </div>
        </div>

        <div class="col-lg-7 col-md-5 align-self-flex-end">
          <div class="pb-3 pw-mont-semibold-14">
            {{ 'pw.stockIssue.carrierDetailsText' | translate }}
          </div>
          <div class="row">
            <div class="col-lg-6 col-12">
              <mat-radio-group
                aria-label="Select an option"
                required
                (change)="loadForm($event)"
              >
                <mat-radio-button
                  class="mr-3"
                  value="{{ stockIssueeCarrierTypesEnumRef.COURIER }}"
                  checked
                >
                  {{
                    'pw.stockIssueTepGep.courierRadioButtonLabel' | translate
                  }}</mat-radio-button
                >
                <mat-radio-button
                  class="mr-3"
                  value="{{ stockIssueeCarrierTypesEnumRef.HANDCARRY }}"
                >
                  {{
                    'pw.stockIssueTepGep.handCarryRadioButtonLabel' | translate
                  }}</mat-radio-button
                >
              </mat-radio-group>
            </div>
          </div>
          <form [formGroup]="form">
            <div class="row">
              <div class="col-12">
                <div formArrayName="formCollection">
                  <div *ngFor="let form of formList.controls; let i = index">
                    <ng-container
                      *ngIf="
                        selectedFormName !==
                          stockIssueeCarrierTypesEnumRef.HANDCARRY;
                        else formTwoBlock
                      "
                      [formGroupName]="i"
                    >
                      <div class="row">
                        <poss-web-select-dropdown
                          #typeDropdown
                          class="col-3"
                          [placeholder]="
                            'pw.stockIssue.selectCourierText' | translate
                          "
                          [control]="form.get('courierName')"
                          [options]="courierArray"
                          [required]="true"
                        >
                        </poss-web-select-dropdown>

                        <mat-form-field class="col-3">
                          <input
                            matInput
                            placeholder="{{
                              'pw.stockIssue.courierDocketNumberText'
                                | translate
                            }}"
                            formControlName="courierDocketNumber"
                            required
                            name="courierDocNoField"
                            possWebMaxLengthValidator
                          />

                          <mat-error
                            *ngIf="
                              form.get('courierDocketNumber').errors &&
                              form.get('courierDocketNumber').errors.errorArray
                            "
                          >
                            <poss-web-error-info-tooltip
                              [errorMessage]="
                                form.get('courierDocketNumber').errors
                                  .errorArray
                              "
                            ></poss-web-error-info-tooltip>
                          </mat-error>
                        </mat-form-field>
                        <mat-form-field class="col-3">
                          <input
                            matInput
                            class="pw-input-box"
                            placeholder="{{
                              'pw.stockIssue.courierPermitNumber' | translate
                            }}"
                            formControlName="courierRoadPermitNumber"
                            name="courierRoadPermitNoField"
                            possWebMaxLengthValidator
                          />

                          <mat-error
                            *ngIf="
                              form.get('courierRoadPermitNumber').errors &&
                              form.get('courierRoadPermitNumber').errors
                                .errorArray
                            "
                          >
                            <poss-web-error-info-tooltip
                              [errorMessage]="
                                form.get('courierRoadPermitNumber').errors
                                  .errorArray
                              "
                            ></poss-web-error-info-tooltip>
                          </mat-error>
                        </mat-form-field>
                        <div class="col-3 align-self-center">
                          <a class="pw-cta-button" (click)="boxDetailsPopUp()">
                            <div
                              class="pw-text-center"
                              *ngIf="boxDetails_count == 0"
                            >
                              {{
                                'pw.stockIssue.boxDetailsLabelText' | translate
                              }}
                            </div>
                            <div
                              class="pw-text-center"
                              *ngIf="boxDetails_count == 1"
                            >
                              {{ boxDetails_count }}
                              {{
                                'pw.stockIssue.boxAddedLabelText' | translate
                              }}
                            </div>
                            <div
                              class="pw-text-center"
                              *ngIf="boxDetails_count > 1"
                            >
                              {{ boxDetails_count }}
                              {{
                                'pw.stockIssue.boxesAddedLabelText' | translate
                              }}
                            </div>
                          </a>
                        </div>
                      </div>
                    </ng-container>
                    <ng-template #formTwoBlock [formGroupName]="i">
                      <div class="row">
                        <mat-form-field class="col-4">
                          <input
                            type="text"
                            placeholder="Employee ID"
                            aria-label="Number"
                            matInput
                            formControlName="employeeID"
                            (input)="
                              employeeIDChange(form.get('employeeID').value)
                            "
                            [matAutocomplete]="auto"
                            required
                            name="employeeCodeField"
                            possWebMaxLengthValidator
                          />
                          <mat-autocomplete #auto="matAutocomplete">
                            <mat-option
                              *ngFor="let employeeCode of employeeCodes"
                              [value]="employeeCode"
                              (onSelectionChange)="
                                employeeIDSelected($event, employeeCode)
                              "
                            >
                              {{ employeeCode }}
                            </mat-option>
                          </mat-autocomplete>

                          <mat-error
                            *ngIf="
                              form.get('employeeID').errors &&
                              form.get('employeeID').errors.errorArray
                            "
                          >
                            <poss-web-error-info-tooltip
                              [errorMessage]="
                                form.get('employeeID').errors.errorArray
                              "
                            ></poss-web-error-info-tooltip>
                          </mat-error>
                        </mat-form-field>

                        <mat-form-field class="col-4">
                          <input
                            matInput
                            class="pw-input-box"
                            placeholder="{{
                              'pw.stockIssue.employeeNameText' | translate
                            }}"
                            formControlName="employeeName"
                            [readonly]="isReadOnly"
                            required
                            name="nameWithSpaceField"
                            possWebMaxLengthValidator
                          />

                          <mat-error
                            *ngIf="
                              form.get('employeeName').errors &&
                              form.get('employeeName').errors.errorArray
                            "
                          >
                            <poss-web-error-info-tooltip
                              [errorMessage]="
                                form.get('employeeName').errors.errorArray
                              "
                            ></poss-web-error-info-tooltip>
                          </mat-error>
                        </mat-form-field>
                        <mat-form-field class="col-4">
                          <input
                            matInput
                            class="pw-input-box"
                            placeholder="{{
                              'pw.stockIssue.mobileNoText' | translate
                            }}"
                            formControlName="employeeMobileNumber"
                            [readonly]="isReadOnly"
                            required
                            name="mobileField"
                            possWebMaxLengthValidator
                          />

                          <mat-error
                            *ngIf="
                              form.get('employeeMobileNumber').errors &&
                              form.get('employeeMobileNumber').errors.errorArray
                            "
                          >
                            <poss-web-error-info-tooltip
                              [errorMessage]="
                                form.get('employeeMobileNumber').errors
                                  .errorArray
                              "
                            ></poss-web-error-info-tooltip>
                          </mat-error>
                        </mat-form-field>
                      </div>
                    </ng-template>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="container-fluid" [class.pw-overlay-notification-gutter]="true">
  <div class="row">
    <div class="col-12 col-lg-10 m-auto">
      <div class="pw-filter-box">
        <div class="row">
          <div class="col-12">
            <ul class="pw-filter-box__sub-head-lists">
              <li class="pw-filter-box__list">
                <a
                  [class.is-active]="
                    tab == stockIsuueDetailsTabEnumRef.APPROVED_PRODUCTS_TAB
                  "
                  class="pw-filter-box__heading is-active"
                  (click)="changeType(0)"
                >
                  {{ 'pw.stockIssue.listOfProductstabText' | translate }}
                  <span class="pw-fourth-color"
                    >({{ approvedItemsTotalCount }})</span
                  >
                </a>
              </li>
              <li class="pw-filter-box__list">
                <a
                  [class.is-active]="
                    tab == stockIsuueDetailsTabEnumRef.SELECTED_PRODUCTS_TAB
                  "
                  (click)="changeType(1)"
                  class="pw-filter-box__heading"
                >
                  {{ 'pw.stockIssue.selectedProductsTabText' | translate }}
                  <span class="pw-fourth-color"
                    >({{ selectedItemsTotalCount }})</span
                  >
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="row align-items-flex-end">
        <div class="col-lg-7">
          <div class="row" [formGroup]="selectForm">
            <div *ngIf="(items$ | async).length > 0">
              <mat-radio-group
                aria-label="Select an option"
                class="col-auto"
                (change)="selectChange()"
                formControlName="selectRadioButton"
              >
                <mat-radio-button
                  value="1"
                  class="mr-3"
                  *ngIf="
                    (tab == stockIsuueDetailsTabEnumRef.APPROVED_PRODUCTS_TAB &&
                      filterSelectedProducts.length == 0) ||
                    (tab == stockIsuueDetailsTabEnumRef.SELECTED_PRODUCTS_TAB &&
                      filterApprovedProducts.length == 0)
                  "
                >
                  <p>
                    {{ 'pw.stockIssue.selectAllRadioButtonText' | translate }}
                  </p>
                </mat-radio-button>

                <mat-radio-button value="2">
                  <p>
                    {{
                      'pw.stockIssue.selectCurrentPageRadioButtonText'
                        | translate
                    }}
                  </p>
                </mat-radio-button>
              </mat-radio-group>
            </div>

            <div
              class="col-auto ml-auto ml-lg-0"
              *ngIf="
                selectForm.value.selectRadioButton === '1' ||
                selectForm.value.selectRadioButton === '2' ||
                itemIds.length > 0
              "
            >
              <a (click)="clearAll()">
                <p>
                  <span class="pw-i-16 pw-clear-icon-16"></span>
                  {{ 'pw.stockIssue.clearAllButtonText' | translate }}
                </p>
              </a>
            </div>
            <div
              class="col-auto"
              *ngIf="tab == stockIsuueDetailsTabEnumRef.SELECTED_PRODUCTS_TAB"
            ></div>
          </div>
        </div>

        <div class="col-lg-5">
          <div class="row pw-filter-box__right-content">
            <div class="col-auto">
              <a (click)="openFilter()">
                <p>
                  <span
                    *ngIf="
                      (tab ==
                        stockIsuueDetailsTabEnumRef.APPROVED_PRODUCTS_TAB &&
                        filterApprovedProducts.length === 0) ||
                      (tab ==
                        stockIsuueDetailsTabEnumRef.SELECTED_PRODUCTS_TAB &&
                        filterSelectedProducts.length === 0)
                    "
                    class="pw-i-16 pw-filter-icon-16 pw-filter-box__icon"
                  ></span>
                  <span
                    *ngIf="
                      (tab ==
                        stockIsuueDetailsTabEnumRef.APPROVED_PRODUCTS_TAB &&
                        filterApprovedProducts.length !== 0) ||
                      (tab ==
                        stockIsuueDetailsTabEnumRef.SELECTED_PRODUCTS_TAB &&
                        filterSelectedProducts.length !== 0)
                    "
                    class="pw-i-24 pw-filter-icon-color-24 pw-filter-box__icon"
                  ></span>
                  {{ 'pw.stockIssue.productFilterLable' | translate }}
                </p>
              </a>
            </div>
            <div class="col-auto">
              <a (click)="openSort()">
                <p>
                  <span
                    class="pw-i-16 pw-sort-icon-16 pw-filter-box__icon"
                  ></span>
                  {{ 'pw.stockIssue.sortLable' | translate }}
                </p>
              </a>
            </div>
            <poss-web-item-search
              class="ml-auto ml-lg-0 col-lg-6 col-4"
              placeholder="{{
                'pw.stockReceive.searchByVariantCodePlaceholderText' | translate
              }}"
              (search)="searchItems($event)"
              (clear)="clearSearchItems()"
            >
            </poss-web-item-search>
          </div>
        </div>
      </div>

      <poss-web-stock-issue-item-list
        [type]="type"
        [tab]="tab"
        [count]="itemsCount$ | async"
        [itemList]="items$ | async"
        [pageEvent]="issueItemsPageEvent"
        [pageSizeOptions]="pageSizeOptions"
        (selection)="selectionEmit($event)"
        (paginator)="paginateIssueItems($event)"
        [selectionEvents]="selectionAllObservable"
        (update)="updateItem($event)"
        (parentFormDirty)="onParentFormDirty($event)"
        (validate)="validateItem($event)"
        (updateHeader)="loadHeader($event)"
        (loadImageEvent)="loadImageUrl($event)"
      >
      </poss-web-stock-issue-item-list>

      <div
        *ngIf="
          (isItemsLoaded$ | async) &&
          approvedItemsTotalCount === 0 &&
          tab == stockIsuueDetailsTabEnumRef.APPROVED_PRODUCTS_TAB
        "
        class="pw-success-color pw-message pw-text-center mg-t-100"
      >
        {{ noDataFoundMessage }}
      </div>
      <div
        *ngIf="
          (isItemsLoaded$ | async) &&
          selectedItemsTotalCount === 0 &&
          tab == stockIsuueDetailsTabEnumRef.SELECTED_PRODUCTS_TAB
        "
        class="pw-success-color pw-message pw-text-center mg-t-100"
      >
        {{ noDataFoundMessage }}
      </div>

      <div
        *ngIf="
          (isItemsLoaded$ | async) &&
          (filterApprovedProducts.length > 0 || itemCode) &&
          (items$ | async)?.length == 0 &&
          tab == stockIsuueDetailsTabEnumRef.APPROVED_PRODUCTS_TAB &&
          ((isLoading$ | async) === null || false || undefined) &&
          approvedItemsTotalCount > 0
        "
        class="pw-success-color pw-message pw-text-center mg-t-100"
      >
        <span class="pw-i-16 pw-success-icon-16"></span>
        {{ noDataFoundMessage }}
      </div>

      <div
        *ngIf="
          (isItemsLoaded$ | async) &&
          (filterSelectedProducts.length > 0 || itemCode) &&
          (items$ | async)?.length == 0 &&
          tab == stockIsuueDetailsTabEnumRef.SELECTED_PRODUCTS_TAB &&
          ((isLoading$ | async) === null || false || undefined) &&
          selectedItemsTotalCount > 0
        "
        class="pw-success-color pw-message pw-text-center mg-t-100"
      >
        <span class="pw-i-16 pw-success-icon-16"></span>
        {{ noDataFoundMessage }}
      </div>
      <poss-web-loader
        *ngIf="
          (isItemsLoading$ | async) ||
          (itemsTotalCountLoading$ | async) ||
          (isLoadingSelectedIssue$ | async) ||
          (isLoadingImage$ | async)"
      >
      </poss-web-loader>
    </div>
  </div>
</div>
<ng-template #confirmSuccessNotificationTemplate>
  <div class="pw-text-center">
    <h3 class="pw-success-color">
      {{
        'pw.stockIssueNotificationMessages.confirmSuccessMessage1' | translate
      }}
    </h3>
    <div class="pt-2"></div>
    <h5 class="pw-success-color pt-2">
      {{
        'pw.stockIssueNotificationMessages.confirmSuccessMessage3' | translate
      }}
      {{ confirmationSrcDocNo }}
    </h5>
    <h4 class="pw-success-color pw-pointer" (click)="print()">
      <span class="pw-i-16 pw-download-icon-16 pw-print"></span>Print
    </h4>
  </div>
</ng-template>
