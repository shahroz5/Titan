<div class="row align-items-center">
  <ng-container [formGroup]="historyForm">
    <mat-radio-group
      aria-label="Select an option"
      class="col-lg-auto col-auto row"
      formControlName="selectRadioButton"
    >
      <mat-radio-button
        value="{{ StockIssueTypesEnumRef.FACTORY }}"
        class="col-auto"
        *possWebPermission="loadPermission(HISTORY_RADIO_BTN_FACTORY)"
      >
        <p>Issued to Factory</p>
      </mat-radio-button>
      <mat-radio-button
        value="{{ StockIssueTypesEnumRef.BOUTIQUE }}"
        class="col-auto"
        *possWebPermission="loadPermission(HISTORY_RADIO_BTN_BOUTIQUE)"
      >
        <p>Issued to Other Boutiques</p>
      </mat-radio-button>
    </mat-radio-group>
  </ng-container>

  <div class="col-auto ml-auto">
    <a (click)="openHistoryFilter()">
      <p>
        <span
          class="pw-i-24 pw-filter-icon-24 pw-filter-box__icon"
          [ngClass]="
            !(
              (advanceFilter?.docFromDate == null ||
                advanceFilter?.docFromDate == '') &&
              (advanceFilter?.docToDate == null ||
                advanceFilter?.docToDate == '') &&
              (advanceFilter?.fiscalYear == null ||
                advanceFilter?.fiscalYear == '') &&
              (advanceFilter?.locationCode == null ||
                advanceFilter?.locationCode == '')
            )
              ? 'pw-filter-icon-color-24'
              : ''
          "
        ></span>
        {{ 'pw.stockReceive.advancedFilterText' | translate }}
      </p>
    </a>
  </div>

  <mat-form-field floatLabel="never" class="col-lg-3 col-4 pw-search-bar">
    <input
      #historySearch
      matInput
      class="pw-input-box"
      [formControl]="historySearchControl"
      [placeholder]="'Search with Doc No'"
      (keypress)="numberCheck($event)"
    />

    <mat-icon matSuffix>
      <span
        class="pw-i-16 pw-search-icon-16"
        *ngIf="!historySearchControl.value"
      ></span
    ></mat-icon>
    <mat-icon matSuffix (click)="clearHistorySearch()">
      <span
        *ngIf="historySearchControl.value"
        class="pw-i-10 pw-close-icon-16"
      ></span
    ></mat-icon>
  </mat-form-field>
</div>

<div class="pw-scrollable">
  <ng-container *ngIf="!showNoResultsFoundNaN && isL1L2Store">
    <poss-web-card-list
      [count]="
        (isSearchingIssues$ | async) === false &&
        (hasSearchIssueResults$ | async) === false
          ? (issueHistoryCount$ | async)
          : 0
      "
      [dataList]="
        (isSearchingIssues$ | async) === false &&
        (hasSearchIssueResults$ | async) === false
          ? (issueHistory$ | async)
          : (searchIssueSTNResult$ | async)
      "
      [pageSize]="pageSize"
      (loadMore)="loadStocks($event)"
      (selected)="onSelected($event)"
    >
      <ng-template let-item="data">
        <poss-web-card-title>Doc No: {{ item.srcDocNo }}</poss-web-card-title>
        <poss-web-card-subtitle
          >{{ item.destLocationCode }} |
          {{ item.destLocationDescription }}
        </poss-web-card-subtitle>
        <poss-web-card-content>
          <p></p>
          <p
            *ngIf="
              !(
                requestType === 'GEP' ||
                requestType === 'TEP_PLAIN' ||
                requestType === 'TEP_STUDDED' ||
                requestType === 'DIRECT_ISSUE' ||
                requestType === 'TEP_GOLD_COIN' ||
                requestType === 'BTQ_CFA' ||
                requestType === 'DEFECTIVE'
              )
            "
          >
            Req Doc No: {{ item.reqDocNo }}
          </p>
          <p>
            {{ item.totalMeasuredQuantity }}
            Qty. |
            {{ item.totalMeasuredValue | currencyFormatter: item.currencyCode }}
          </p>
          <p>
            Total Weight:
            {{ item.totalMeasuredWeight | weightFormatter }}
            {{ item.weightUnit }}
          </p>
          <p>Doc Date: {{ item.srcDocDate | dateFormatter }}</p>
          <p
            *ngIf="
            !(
              requestType === 'GEP' ||
              requestType === 'TEP_PLAIN' ||
              requestType === 'TEP_STUDDED' ||
              requestType === 'DIRECT_ISSUE' ||
              requestType === 'TEP_GOLD_COIN' ||
              requestType === 'BTQ_CFA' ||
              requestType === 'DEFECTIVE'
            )
            "
          >
            Req Date: {{ item.reqDocDate | dateFormatter }}
          </p>
          <p [ngClass]="getStatus(item.status)">Status: {{ status }}</p>
          <div class="row">
            <div class="col"></div>
          </div>
        </poss-web-card-content>
      </ng-template>
    </poss-web-card-list>

    <h3
      class="pw-text-center m-5"
      *ngIf="
        !(
          isLoadingHistory ||
          (isLoadingCount$ | async) ||
          (isLoadingHistoryCount$ | async)
        ) &&
        (isSearchingIssues$ | async) === false &&
        (hasSearchIssueResults$ | async) &&
        (searchIssueSTNResult$ | async) &&
        (searchIssueSTNResult$ | async).length === 0
      "
    >
      {{ noDataFoundMessage }}
    </h3>
    <h3
      class="pw-success-color pw-message pw-text-center mg-t-100"
      *ngIf="
        isLoadingHistory == false &&
        (issueHistory$ | async) &&
        (issueHistory$ | async).length === 0 &&
        (advanceFilter?.docFromDate === null ||
          advanceFilter?.docFromDate == '') &&
        (advanceFilter?.docToDate === null || advanceFilter?.docToDate == '') &&
        (advanceFilter?.locationCode == null ||
          advanceFilter?.locationCode == '') &&
        (advanceFilter?.fiscalYear == null || advanceFilter?.fiscalYear == '')
      "
    >
      {{ noDataFoundMessage }}
    </h3>
    <h3
      class="pw-success-color pw-message pw-text-center mg-t-100"
      *ngIf="
        isLoadingHistory == false &&
        (issueHistory$ | async) &&
        (issueHistory$ | async).length === 0 &&
        !(
          (advanceFilter?.docFromDate === null ||
            advanceFilter?.docFromDate == '') &&
          (advanceFilter?.docToDate === null ||
            advanceFilter?.docToDate == '') &&
          (advanceFilter?.locationCode == null ||
            advanceFilter?.locationCode == '') &&
          (advanceFilter?.fiscalYear == null || advanceFilter?.fiscalYear == '')
        )
      "
    >
      {{ noDataFoundMessage }}
    </h3>
  </ng-container>

  <h3 *ngIf="showNoResultsFoundNaN" class="pw-text-center m-5">
    {{ noDataFoundMessage }}
  </h3>

  <poss-web-loader
    *ngIf="(isLoadingCount$ | async) || (isHistoryLoading$ | async)"
  >
  </poss-web-loader>
  <poss-web-loader *ngIf="isSearchingIssues$ | async"></poss-web-loader>
</div>
