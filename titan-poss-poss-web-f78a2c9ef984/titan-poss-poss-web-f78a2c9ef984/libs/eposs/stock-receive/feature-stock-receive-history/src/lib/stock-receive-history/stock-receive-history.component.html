<div class="row mt-3 align-items-center" [formGroup]="historyFormGroup">
  <mat-radio-group
    *ngIf="isL1L2Store"
    class="col-auto row"
    formControlName="selectRadioButton"
  >
    <mat-radio-button
      *possWebPermission="loadPermission(factoryRadioButtonPermission)"
      [value]="stockReceiveEnumRef.FAC_BTQ"
      class="mr-3"
      class="col-auto"
    >
      <p class="pw-radio-btn__label">
        {{ 'pw.stockReceive.factoryReceivalsText' | translate }}
      </p>
    </mat-radio-button>
    <mat-radio-button
      *possWebPermission="loadPermission(boutiqueRadioButtonPermission)"
      [value]="stockReceiveEnumRef.BTQ_BTQ"
      class="col-auto"
    >
      <p class="pw-radio-btn__label">
        {{ 'pw.stockReceive.boutiqueReceivalsText' | translate }}
      </p>
    </mat-radio-button>
    <mat-radio-button
      *possWebPermission="loadPermission(merchandiseRadioButtonPermission)"
      [value]="stockReceiveEnumRef.MER_BTQ"
      class="col-auto"
    >
      <p class="pw-radio-btn__label">
        {{ 'pw.stockReceive.merchandiseReceivalsText' | translate }}
      </p>
    </mat-radio-button>
  </mat-radio-group>
  <div class="col-auto ml-auto">
    <a (click)="openHistoryFilter()">
      <p>
        <span
          class="pw-i-24 pw-filter-icon-24 pw-filter-box__icon"
          [ngClass]="
            !(
              (advanceFilter?.stnNumber == null ||
                advanceFilter?.stnNumber == '') &&
              (advanceFilter?.docNumber === null ||
                advanceFilter?.docNumber == '') &&
              (advanceFilter?.docFromDate == null ||
                advanceFilter?.docFromDate == '') &&
              (advanceFilter?.docToDate == null ||
                advanceFilter?.docToDate == '') &&
              (advanceFilter?.fiscalYear == null ||
                advanceFilter?.fiscalYear == '') &&
              (advanceFilter?.locationCode == null ||
                advanceFilter?.locationCode == '')
            )
              ? 'pw-filter-icon-color-24'
              : ''
          "
        ></span>
        {{ 'pw.stockReceive.advancedFilterText' | translate }}
      </p>
    </a>
  </div>
  <mat-form-field class="col-lg-3 col-sm-4 pw-search-bar">
    <mat-label>{{ 'pw.stockReceive.docNumberSearch' | translate }}</mat-label>

    <input
      #searchBox
      id="searchBox"
      matInput
      class="pw-input-box"
      [placeholder]="
        isL3Store ? ('pw.stockReceive.invoiceSearchFormat' | translate) : ''
      "
      [formControl]="searchFormControl"
      (keypress)="searchKeyCheck($event)"
    />
    <mat-icon matSuffix>
      <span
        *ngIf="!searchFormControl.value"
        class="pw-i-16 pw-search-icon-16"
      ></span
    ></mat-icon>
    <mat-icon matSuffix (click)="clearSearch()">
      <span
        *ngIf="searchFormControl.value"
        class="pw-i-10 pw-close-icon-16"
      ></span
    ></mat-icon>
  </mat-form-field>
</div>

<poss-web-card-list
  [count]="stockReceiveHistoryCount$ | async"
  [dataList]="stockReceiveHistory$ | async"
  [pageSize]="pageSize"
  (loadMore)="loadStocks($event)"
  (selected)="onSelected($event)"
>
  <ng-template let-item="data">
    <poss-web-card-title>
      <div class="row">
        <div class="col-auto">
          <h4>
            {{ 'pw.stockReceive.doc' | translate }}
            :
            {{ item.destDocNo }}
          </h4>
        </div>
        <div class="col-auto ml-auto">
          <p class="pw-seventh-color">
            <span class="pw-font-weight-bold"> {{ item.orderType }}</span>
          </p>
        </div>
      </div>
    </poss-web-card-title>
    <poss-web-card-subtitle>
      {{ item.srcLocationCode }} | {{ item.srcDocNo }}
    </poss-web-card-subtitle>
    <poss-web-card-content>
      <div class="mt-1">
        <p>
          {{ 'pw.stockReceive.statusLabel' | translate }} :
          <span
            [class.pw-success-color]="
              item.status === stockStatusEnumRef.RECEIVED
            "
            [class.pw-warning-color]="
              item.status === stockStatusEnumRef.PUBLISHED
            "
          >
            {{ item.status }}
          </span>
        </p>
        <p>
          {{ item.totalMeasuredQuantity }}
          {{ 'pw.stockReceive.quantityLableText' | translate }} |
          {{
            (isL3Store ? item?.totalValue : item?.totalMeasuredValue)
              | currencyFormatter: item?.currencyCode
          }}
        </p>
        <p *ngIf="item?.invoiceType === StockReceiveAPITypesEnumRef.CFA_BTQ">
          {{ 'pw.stockReceive.totalDiscountLabel' | translate }} :
          {{ item.totalDiscount | currencyFormatter: item.currencyCode }}
        </p>
        <p>
          {{
            (isL1L2Store
              ? 'pw.stockReceive.stnDateLable'
              : 'pw.stockReceive.invoiceDate'
            ) | translate
          }}
          {{ item.srcDocDate | dateFormatter }}
        </p>
        <p>
          {{ 'pw.stockReceive.docDateLable' | translate }} :
          {{ item.destDocDate | dateFormatter }}
        </p>
        <ng-container *ngIf="isL1L2Store">
          <p>
            <ng-container
              *ngIf="
                item?.courierDetails.type ==
                stockReceiveCarrierTypesEnumRef.COURIER
              "
            >
              {{ 'pw.stockReceive.courierLableText' | translate }} :
              {{ item?.courierDetails.data.companyName }}
            </ng-container>
            <ng-container
              *ngIf="
                item?.courierDetails.type ==
                stockReceiveCarrierTypesEnumRef.EMPLOYEE
              "
            >
              {{ 'pw.stockReceive.employeeLableText' | translate }} :
              {{ item?.courierDetails.data.employeeName }}
            </ng-container>
          </p>
          <p>
            <ng-container
              *ngIf="
                item?.courierDetails.type ==
                stockReceiveCarrierTypesEnumRef.COURIER
              "
            >
              {{ 'pw.stockReceive.courierdocketNumberLableText' | translate }} :
              {{ item?.courierDetails.data.docketNumber }}
            </ng-container>
            <ng-container
              *ngIf="
                item?.courierDetails.type ==
                stockReceiveCarrierTypesEnumRef.EMPLOYEE
              "
            >
              {{ 'pw.stockReceive.employeeIdLableText' | translate }} :
              {{ item?.courierDetails.data.employeeId }}
            </ng-container>
          </p>
        </ng-container>
      </div>
    </poss-web-card-content>
  </ng-template>
</poss-web-card-list>

<h3
  class="pw-text-center m-5 pw-success-color"
  *ngIf="
    isLoadingStockReceiveHistory == false &&
    (stockReceiveHistory$ | async) &&
    (stockReceiveHistory$ | async).length === 0 &&
    (advanceFilter?.stnNumber === null || advanceFilter?.stnNumber == '') &&
    (advanceFilter?.docNumber === null || advanceFilter?.docNumber == '') &&
    (advanceFilter?.docFromDate === null || advanceFilter?.docFromDate == '') &&
    (advanceFilter?.docToDate === null || advanceFilter?.docToDate == '') &&
    (advanceFilter?.sourceLocationCode == null ||
      advanceFilter?.sourceLocationCode == '') &&
    (advanceFilter?.fiscalYear == null || advanceFilter?.fiscalYear == '')
  "
>
  <ng-container *ngIf="isL1L2Store">
    {{ noDataFoundMessageSTN }}
  </ng-container>
  <ng-container *ngIf="isL3Store">
    {{ noDataFoundMessagePurchaseInvoice }}
  </ng-container>
</h3>
<h3
  class="pw-text-center m-5 pw-success-color"
  *ngIf="
    isLoadingStockReceiveHistory == false &&
    !(
      (advanceFilter?.stnNumber === null || advanceFilter?.stnNumber == '') &&
      (advanceFilter?.docNumber === null || advanceFilter?.docNumber == '') &&
      (advanceFilter?.docFromDate === null ||
        advanceFilter?.docFromDate == '') &&
      (advanceFilter?.docToDate === null || advanceFilter?.docToDate == '') &&
      (advanceFilter?.sourceLocationCode == null ||
        advanceFilter?.sourceLocationCode == '') &&
      (advanceFilter?.fiscalYear == null || advanceFilter?.fiscalYear == '')
    ) &&
    (stockReceiveHistory$ | async) &&
    (stockReceiveHistory$ | async).length === 0
  "
>
  <ng-container *ngIf="isL1L2Store">
    {{ noDataFoundMessageSTN }}
  </ng-container>
  <ng-container *ngIf="isL3Store">
    {{ noDataFoundMessagePurchaseInvoice }}
  </ng-container>
</h3>

<poss-web-loader
  *ngIf="isLoadingStockReceiveHistory || (isLoadingCount$ | async)"
>
</poss-web-loader>
