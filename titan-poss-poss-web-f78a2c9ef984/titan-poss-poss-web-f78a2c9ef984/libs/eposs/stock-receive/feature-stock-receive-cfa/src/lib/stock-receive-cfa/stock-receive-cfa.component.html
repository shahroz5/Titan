<div class="row mt-3">
  <poss-web-select-dropdown
    *ngIf="stockReceiveType !== stockReceiveEnumRef.HISTORY && isL3Store"
    class="col-lg-4 col-4 pw-form-card__right-container"
    [placeholder]="'pw.stockReceive.searchBy' | translate"
    [control]="searchByFormControl"
    (selectionChange)="selectionChange($event.value)"
    [options]="searchTypes"
    [required]="true"
  >
  </poss-web-select-dropdown>
  <mat-form-field class="col-lg-3 col-sm-4" [hidden]="isL1L2Store">
    <input
      #searchBox
      id="searchBox"
      matInput
      class="pw-input-box"
      [placeholder]="
        stockReceiveType !== stockReceiveEnumRef.HISTORY && isL3Store
          ? searchByFormControl.value ===
            stockReceiveCFAInvoiceTypeFieldEnum.CFA_INVOICE_ORACLE
            ? ('pw.stockReceive.CFASearchLabel' | translate)
            : searchByFormControl.value ===
              stockReceiveCFAInvoiceTypeFieldEnum.CFA_INVOICE
            ? ('pw.stockReceive.invoiceSearchLabel' | translate)
            : ''
          : ''
      "
      [formControl]="searchFormControl"
      (keypress)="searchKeyCheck($event)"
    />
    <mat-icon matSuffix>
      <span
        *ngIf="!searchFormControl.value"
        class="pw-i-16 pw-search-icon-16"
      ></span
    ></mat-icon>
    <mat-icon matSuffix (click)="clearSearch()">
      <span
        *ngIf="searchFormControl.value"
        class="pw-i-10 pw-close-icon-16"
      ></span
    ></mat-icon>
    <mat-error
      *ngIf="searchFormControl.errors && searchFormControl.errors.errorArray"
    >
      <poss-web-error-info-tooltip
        [errorMessage]="searchFormControl.errors.errorArray"
      ></poss-web-error-info-tooltip>
    </mat-error>
  </mat-form-field>
</div>
<poss-web-card-list
  [count]="
    (isSearchingInvoices$ | async) === false &&
    (hasSearchInvoiceResults$ | async) === false
      ? (pendingCFAInvoiceCount$ | async)
      : 0
  "
  [dataList]="
    (isSearchingInvoices$ | async) === false &&
    (hasSearchInvoiceResults$ | async) === false
      ? (pendingCFAInvoice$ | async)
      : (searchInvoiceResults$ | async)
  "
  [pageSize]="pageSize"
  (loadMore)="loadStocks($event)"
  (selected)="onSelected($event)"
>
  <ng-template let-item="data">
    <poss-web-card-title>
      <div class="row">
        <div class="col-auto">
          <h4>
            {{ 'pw.stockReceive.invoiceNoLable' | translate }} :
            {{ item.srcDocNo }}
          </h4>
        </div>
        <div class="col-auto ml-auto">
          <p class="pw-seventh-color">
            <span class="pw-font-weight-bold"> {{ item.orderType }}</span>
          </p>
        </div>
      </div>
    </poss-web-card-title>
    <poss-web-card-subtitle>
      {{ item.srcLocationCode }} | {{ item.srcLocationDescription }}
    </poss-web-card-subtitle>
    <poss-web-card-content>
      <div class="mt-1">
        <p>
          {{ item.totalAvailableQuantity }}
          {{ 'pw.stockReceive.quantityLableText' | translate }} |
          {{
            (isL3Store ? item?.totalValue : item?.totalAvailableValue)
              | currencyFormatter: item?.currencyCode
          }}
        </p>
        <p *ngIf="item.invoiceType === 'CFA_BTQ'">
          {{ 'pw.stockReceive.totalDiscountLabel' | translate }} :
          {{ item.totalDiscount | currencyFormatter: item.currencyCode }}
        </p>
        <p>
          {{ 'pw.stockReceive.invoiceDateLable' | translate }} :
          {{ item.srcDocDate | dateFormatter }}
        </p>
      </div>
    </poss-web-card-content>
  </ng-template>
</poss-web-card-list>
<ng-container *ngIf="isL3Store">
  <h3
    class="pw-text-center m-5 pw-success-color"
    *ngIf="
      isLoadingPendingCFAInvoice == false &&
      (isSearchingInvoices$ | async) === false &&
      (hasSearchInvoiceResults$ | async) === false &&
      (pendingCFAInvoice$ | async) &&
      (pendingCFAInvoice$ | async).length === 0
    "
  >
    {{ noDataFoundMessagePurchaseInvoice }}
  </h3>
  <h3
    class="pw-text-center m-5 pw-success-color"
    *ngIf="
      isLoadingPendingCFAInvoice == false &&
      (isSearchingInvoices$ | async) === false &&
      searchFormControl.value &&
      (hasSearchInvoiceResults$ | async) &&
      (searchInvoiceResults$ | async) &&
      (searchInvoiceResults$ | async).length === 0
    "
  >
    <ng-container *ngIf="!hasFromFetchedOracle">
      {{ 'pw.stockReceive.fetchFromOracleMessage4' | translate }}
      {{ searchedSrcDocNumber }}
      {{ 'pw.stockReceive.fetchFromOracleMessage7' | translate }}
      <br />
    </ng-container>
    <ng-container *ngIf="hasFromFetchedOracle">
      {{ 'pw.stockReceive.fetchFromOracleMessage6' | translate }}
    </ng-container>
  </h3>
</ng-container>

<poss-web-loader
  *ngIf="
    isLoadingPendingCFAInvoice ||
    (isLoadingCount$ | async) ||
    (isSearchingStocks$ | async) ||
    (isSearchingInvoices$ | async)
  "
>
</poss-web-loader>
