<div class="row align-items-center">
  <div class="col-auto">
    <div class="pw-form-card__item mb-0">
      <h4>
        {{ 'pw.rivaahEligibilityConfig.eligibilityCriteriaLabel' | translate }}
      </h4>
    </div>
  </div>

  <div class="pw-detail-card pw-shadow">
    <div class="row pw-detail-card__flex-end" [formGroup]="rivaahConfigFormGroup">
      <button
        *ngIf="!productCategoryCode"
        mat-flat-button
        class="ml-3 mb-3 pw-btn pw-cta-btn"
        (click)="openProductCategoryPopup()"
      >
        <div class="row">
          <div class="col-auto">
            <p>
              {{ 'pw.rivaahEligibilityConfig.selectProductCategory' | translate }}
            </p>
          </div>
        </div>
      </button>

      <button
        *ngIf="productCategoryCode"
        mat-flat-button
        class="ml-3 mb-3 pw-btn pw-cta-btn"
      >

        <div class="row">
          <div class="col-lg-2 col-3">
            <p>
              {{ 'pw.rivaahEligibilityConfig.productCategoryCode' | translate }} :
              {{ productCategoryCode }}
            </p>
          </div>

          <div class="col-auto ml-auto">
            <a>
              <span
                class="pw-i-10 pw-close-icon-16"
                (click)="clearProductCategory()"
              ></span>
            </a>
          </div>
        </div>
      </button>
      
      <mat-form-field class="col-auto">
        <mat-select
          formControlName="eleventhDigit"
          disableOptionCentering
          multiple
          [placeholder]="
            getLableWithSelectedOptionsCount(
              'eleventhDigit',
              'pw.rivaahEligibilityConfig.11thDigit' | translate
            )
          "
          required
        >
          <poss-web-select-check-all
            [model]="rivaahConfigFormGroup.get('eleventhDigit')" 
            [values]="eleventhDigit">
          </poss-web-select-check-all>
          <mat-option
            *ngFor="let option of eleventhDigit"
            [value]="option"
            [disabled]="
            rivaahConfigFormGroup.get('eleventhDigit').value?.length >=
               maxFilterOptionsSelection &&
              !rivaahConfigFormGroup.get('eleventhDigit').value?.includes(option)
            "
          >
            {{ option }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="col-auto">
        <mat-label class="pw-fourth-color">
          {{ 'pw.rivaahEligibilityConfig.grammage' | translate }}</mat-label
        >
        <input
          formControlName="grammage"
          possWebWeightInput
          matInput
          type="text"
          class="pw-single-bordered-input"
          required
        />

        <mat-error
          *ngIf="
            rivaahConfigFormGroup.get('grammage').touched &&
            rivaahConfigFormGroup.get('grammage').errors &&
            rivaahConfigFormGroup.get('grammage').errors.errorArray
          "
        >
          <poss-web-error-info-tooltip
            [errorMessage]="rivaahConfigFormGroup.get('grammage').errors.errorArray"
          ></poss-web-error-info-tooltip>
        </mat-error>
      </mat-form-field>
      <poss-web-select-dropdown
        class="col-lg-2 col-3"
        [placeholder]="'pw.rivaahEligibilityConfig.occasion' | translate"
        [options]="occasion"
        [control]="rivaahConfigFormGroup.get('occasion')"
        required
      >
      </poss-web-select-dropdown>
      <div class="col-auto ml-auto align-self-baseline">
        <button
          class="pw-btn pw-accent-btn"
          (click)="createConfig()"
          [disabled]="
            rivaahConfigFormGroup.invalid ||
            productCategoryCode === ''
          "
        >
          {{ 'pw.rivaahEligibilityConfig.createConfigButton' | translate }}
        </button>
      </div>
    </div>
  </div>


  <div class="col-auto ml-auto">
    <div class="row align-items-center mb-0">
      <poss-web-select-dropdown
        class="col-auto ml-auto mt-3"
        [control]="searchByFormControl"
        [placeholder]="'Search By'"
        [options]="searchByArray"
        [required]="true"
        (selectionChange)="onSearchByChanged($event)"
      >
      </poss-web-select-dropdown>
      <mat-form-field
        [formGroup]="searchForm"
        class="col-auto pw-search-bar mt-3"
      >
        <input
          type="text"
          matInput
          #searchBox
          formControlName="productCodeField"
          name="productCodeField"
          possWebMaxLengthValidator
          placeholder="{{
            'pw.rivaahEligibilityConfig.searchLabel' | translate
          }}"
          class="pw-single-bordered-input"
        />
        <mat-icon matSuffix>
          <span
            class="pw-i-16 pw-search-icon-16"
            *ngIf="!searchForm.value.productCodeField"
          ></span>
        </mat-icon>
        <mat-icon matSuffix (click)="clearSearch()">
          <span
            *ngIf="searchForm.value.productCodeField"
            class="pw-i-10 pw-close-icon-16"
          ></span
        ></mat-icon>
      </mat-form-field>
      <div class="col-auto">
        <button
          [disabled]="disableButton"
          class="pw-btn pw-primary-btn"
          (click)="removeconfig()"
        >
          <span class="pw-i-24 pw-delete-icon-24"></span>
          {{ 'pw.rivaahEligibilityConfig.removeButtonLabel' | translate }}
        </button>
      </div>
    </div>
  </div>

  <poss-web-top-info-panel
    *ngIf="isFocusing && focusedHeaderName"
    [isFocusing]="isFocusing"
    [focusedHeaderName]="focusedHeaderName"
    [currentRowData]="currentRowInfo"
  >
  </poss-web-top-info-panel>
  <ag-grid-angular
    class="ag-theme-alpine pw-titan-poss-theme pw-ag-grid-table"
    [columnDefs]="columnDefs"
    domLayout="autoHeight"
    rowSelection="multiple"
    [rowMultiSelectWithClick]="true"
    [enableRangeSelection]="true"
    [suppressRowClickSelection]="true"
    [frameworkComponents]="getComponents()"
    [context]="getContext()"
    (gridReady)="gridReady($event)"
    (selectionChanged)="onSelectionChanged($event)"
    (gridSizeChanged)="onGridSizeChanged()"
    (cellFocused)="onCellFocused($event)"
    (focusout)="focusOut($event)"
  >
  </ag-grid-angular>
  <div class="col m1-auto">
    <mat-paginator
      class="pw-paginator"
      *ngIf="
        totalCount > minPageSize &&
        rivaahEligibilityConfig.length > 0 &&
        totalCount != 1
      "
      [length]="totalCount"
      [pageSize]="pageEvent.pageSize"
      [pageIndex]="pageEvent.pageIndex"
      showFirstLastButtons
      [pageSizeOptions]="pageSizeOptions"
      (page)="paginator.emit($event)"
    >
    </mat-paginator> 
  </div>
</div>

<div class="row mb-5">
  <div class="col-auto">
    <button
      [disabled]="disableButton"
      (click)="updateConfig()"
      class="pw-btn pw-accent-btn"
    >
      {{ 'pw.rivaahEligibilityConfig.updateValues' | translate }}
    </button>
  </div>

  <!-- <div class="col-auto ml-auto">
    <button 
      (click)="onSave()" 
      class="pw-btn pw-accent-btn"
    >
      {{ 'pw.rivaahEligibilityConfig.saveButton' | translate }}
    </button>
  </div> -->
</div>
