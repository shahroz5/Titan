<div
  class="container-fluid"
  [class.pw-overlay-notification-gutter]="hasNotification"
>
  <div class="row">
    <div class="col-12 col-lg-10 m-auto">
      <div class="pw-top-heading-container">
        <div class="row pw-top-heading-container__item">
          <div class="col-auto">
            <div class="pw-top-heading-container__main-head">
              <a (click)="back()">
                <span class="pw-i-24 pw-back-arrow-icon-24"></span>
              </a>
              <span class="pw-i-36 pw-instock-icon-36"></span>
              <div>
                <h2>{{ 'pw.conversion.inStock' | translate }}</h2>
                <h5 class="pw-top-heading-container__sub-heading">
                  {{ 'pw.conversion.management' | translate }}
                </h5>
              </div>
            </div>
          </div>
        </div>
      </div>

      <h3 class="mb-3">{{ 'pw.conversion.title' | translate }}</h3>
      <div class="mb-2">
        <span class="pw-font-weight-bold">{{
          'pw.conversion.requestSentTabText' | translate
        }}</span>
      </div>
      <div class="pw-grid-card">
        <div class="row align-items-end">
          <div class="col-lg-3 col-md-4 col-6">
            <div class="pw-grid-card__item pw-is-active-bar">
              <h4>
                {{ 'pw.conversion.requestNo' | translate }}:
                {{ selectedRequest?.srcDocNo }}
              </h4>
              <div class="mt-2">
                <p [ngClass]="getStatus(selectedRequest?.status)">
                  {{ 'pw.conversion.statusText' | translate }}: {{ status }}
                </p>
                <p></p>
                <p>{{ selectedRequest?.createdDate | dateFormatter }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <ng-container *ngIf="parentItem !== null">
        <div>
          <span class="pw-font-weight-bold">{{
            'pw.conversion.yourProductIsHereText' | translate
          }}</span>
        </div>
        <p class="pt-2">{{ 'pw.conversion.parentVariantText' | translate }}</p>
        <poss-web-conversion-item
          [item]="parentItem"
          [tab]="1"
          [hasForm]="0"
          [priceDetails]="mapItemPriceDetails(parentItem?.itemCode)"
          (showPriceDetails)="openPriceDetailsPopup($event)"
          class="pw-list-card d-block"
          (loadImageEvent)="loadImageUrl($event, false)"
        >
        </poss-web-conversion-item>

        <ng-container *ngIf="childItems !== []">
          <div class="pt-4">
            <span class="pw-font-weight-bold">{{
              'pw.conversion.availableSplitOptionsText' | translate
            }}</span>
          </div>
          <div possWebFocusableList>
            <ng-container *ngIf="childItemArray.length > 0">
              <ng-container
                *ngFor="let item of childItemArray; trackBy: trackBy"
              >
                <poss-web-conversion-item
                  possWebFocusableListItem
                  [item]="item"
                  [tab]="1"
                  [parentForm]="parentForm"
                  [hasForm]="1"
                  [binCodes]="binCodes"
                  [conversionWeightToleranceForBangle]="
                    conversionWeightToleranceForBangle
                  "
                  [isWeightEditable]="
                    item?.studded === false && item?.itemCode?.charAt(6) === 'V'
                      ? true
                      : false
                  "
                  class="pw-list-card d-block"
                  (loadImageEvent)="loadImageUrl($event, true)"
                  (showPriceDetails)="openPriceDetailsPopup($event)"
                >
                </poss-web-conversion-item>
              </ng-container>
            </ng-container>
            <ng-container *ngIf="childItemArray.length === 0">
              <ng-container *ngFor="let item of childItems; trackBy: trackBy">
                <poss-web-conversion-item
                  possWebFocusableListItem
                  [item]="item"
                  [priceDetails]="mapItemPriceDetails(item?.itemCode)"
                  [tab]="1"
                  [parentForm]="parentForm"
                  [hasForm]="1"
                  [binCodes]="binCodes"
                  [conversionWeightToleranceForBangle]="
                    conversionWeightToleranceForBangle
                  "
                  [isWeightEditable]="
                    item?.studded === false && item?.itemCode?.charAt(6) === 'V'
                      ? true
                      : false
                  "
                  class="pw-list-card d-block"
                  (loadImageEvent)="loadImageUrl($event, true)"
                  (showPriceDetails)="openPriceDetailsPopup($event)"
                >
                </poss-web-conversion-item>
              </ng-container>
            </ng-container>
          </div>
          <div *ngIf="enableAddRowBtn">
            <button class="pw-btn pw-primary-btn" (click)="AddNewChildItem()">
              {{ 'pw.conversion.addRow' | translate }}
            </button>
          </div>
          <div *ngIf="weightMissmatchError" class="pw-error-color">
            {{ weightMissmatchError }}
          </div>
          <div *ngIf="priceMissmatchError" class="pw-error-color">
            {{ priceMissmatchError }}
          </div>
          <div
            *ngIf="
              selectedRequest?.status === conversionApprovalStatus.APPROVED
            "
            class="row"
          >
            <poss-web-select-dropdown
              class="col-4"
              [control]="rsoForm.get('rsoName')"
              [placeholder]="'pw.conversion.selectRsoText' | translate"
              [options]="rsoNamesArray"
              [required]="true"
            >
            </poss-web-select-dropdown>
          </div>
        </ng-container>
      </ng-container>

      <div *ngIf="selectedRequest?.approvalRemarks" class="pt-2 pb-2">
        <span class="pw-font-weight-bold"
          >{{ 'pw.conversionApprovals.approverRemarks' | translate }}:
        </span>
        <span>{{ selectedRequest?.approvalRemarks }}</span>
      </div>
    </div>
  </div>
  <poss-web-loader
    *ngIf="
      (isLoadingSelectedRequest$ | async) ||
      (isLoadingSelectedRequestData$ | async) ||
      (isLoadingCount$ | async) ||
      (isLoadingRsoDetails$ | async) ||
      (isLoadingImage$ | async)
    "
  >
  </poss-web-loader>
</div>
<ng-template #confirmSuccessNotificationTemplate>
  <div class="pw-text-center">
    <h3 class="pw-success-color">
      {{
        'pw.conversionNotificationMessages.convertNowSuccessOverlayMessage1'
          | translate
      }}
    </h3>
    <div class="pt-2">
      {{
        'pw.conversionNotificationMessages.convertNowSuccessOverlayMessage2'
          | translate
      }}
    </div>
    <h5 class="pw-success-color pt-2">
      {{
        'pw.conversionNotificationMessages.convertNowSuccessOverlayMessage3'
          | translate
      }}
      {{ conversionDocNo }}
    </h5>
  </div>
</ng-template>
