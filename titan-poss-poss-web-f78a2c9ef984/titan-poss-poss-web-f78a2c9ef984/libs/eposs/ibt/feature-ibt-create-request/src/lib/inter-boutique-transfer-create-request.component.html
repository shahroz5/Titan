<div
  class="container-fluid"
  [class.pw-overlay-notification-gutter]="hasNotification"
>
  <div class="row">
    <div class="col-12 col-lg-10 m-auto">
      <div class="pw-top-heading-container">
        <div class="row pw-top-heading-container__item align-items-center mb-3">
          <div class="col-auto">
            <div class="pw-top-heading-container__main-head">
              <a (click)="back()">
                <span class="pw-i-24 pw-back-arrow-icon-24"></span>
              </a>
              <span class="pw-i-36 pw-instock-icon-36"></span>
              <div>
                <h2>{{ 'pw.instock.title' | translate }}</h2>
                <h5 class="pw-top-heading-container__sub-heading">
                  {{ 'pw.instock.titlehead' | translate }}
                </h5>
              </div>
            </div>
          </div>
        </div>
      </div>
      <h3 class="mb-3">
        {{ 'pw.instock.interBoutiqueTransferHeaderText' | translate }}
      </h3>
      <p>
        {{ 'pw.interboutiqueTransfer.checkAvailabilityInfoText' | translate }}
      </p>
      <form [formGroup]="searchForm">
        <div class="row mt-3">
          <mat-form-field class="col-12 pw-search-bar pr-3">
            <input
              #searchBox
              matInput
              type="text"
              class="pw-input-box pw-uppercase"
              placeholder="{{
                'pw.stockIssue.searchWithVariantCodeText' | translate
              }}"
              formControlName="searchValue"
              name="itemCodeField"
              possWebMaxLengthValidator
            />
            <mat-icon matSuffix>
              <span
                class="pw-i-16 pw-search-icon-16"
                *ngIf="!searchForm.get('searchValue').value"
              ></span
            ></mat-icon>
            <mat-icon matSuffix *ngIf="searchForm.get('searchValue').value">
              <span
                (click)="clearSearch()"
                class="pw-i-10 pw-close-icon-16"
              ></span>
            </mat-icon>
            <mat-error
              *ngIf="
                searchForm.get('searchValue').errors &&
                searchForm.get('searchValue').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="searchForm.get('searchValue').errors.errorArray"
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
          <mat-error
            class="align-top"
            *ngIf="
              !(
                searchForm.get('searchValue').errors &&
                searchForm.get('searchValue').errors.errorArray
              ) &&
              (searchItemResponse$ | async).searchResult === null &&
              (searchItemResponse$ | async).isSearchSuccess
            "
            >Invalid Itemcode</mat-error
          >
        </div>
      </form>

      <mat-accordion [formGroup]="itemForm">
        <mat-expansion-panel
          class="pw-accordion"
          [expanded]="allExpandState"
          (opened)="panelOpenState = true"
          (closed)="panelOpenState = false"
          [disabled]="itemList.controls.length === 0"
        >
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{ 'pw.interboutiqueTransfer.variantCodesPanelText' | translate }}
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="row mb-2" *ngIf="itemList.controls.length > 1">
            <div class="col-auto ml-auto">
              <a (click)="resetValue()">
                <p>
                  <span class="pw-i-16 pw-clear-icon-16"></span>
                  {{ 'pw.interboutiqueTransfer.clearAllLabel' | translate }}
                </p>
              </a>
            </div>
          </div>
          <div class="row">
            <div
              class="col-lg-4 col-6"
              formArrayName="searchItem"
              *ngFor="let item of itemList.controls; let i = index"
            >
              <div class="pw-card" [formGroupName]="i">
                <div class="row pw-card__header">
                  <div class="col-10">
                    <div>
                      {{
                        'pw.interboutiqueTransfer.variantCodePanelText'
                          | translate
                      }}
                      <span class="pw-font-weight-bold">
                        {{ item.value.itemCode }}</span
                      >
                    </div>
                    <div>
                      {{
                        'pw.interboutiqueTransfer.productCategoryPanelText'
                          | translate
                      }}
                      {{ item.value.productCategory }}
                    </div>
                    <div>
                      {{
                        'pw.interboutiqueTransfer.descriptionPanelText'
                          | translate
                      }}
                      {{ item.value.productCategoryDescription }}
                    </div>
                  </div>

                  <div class="col-2 pw-text-right">
                    <span
                      class="pw-i-10 pw-close-icon-16"
                      (click)="removeSearchedItem(i)"
                    ></span>
                  </div>
                </div>
                <div class="row pw-card__body align-items-center">
                  <div class="col-auto">
                    <p>
                      {{
                        'pw.interboutiqueTransfer.itemListInlineText7'
                          | translate
                      }}
                    </p>
                  </div>
                  <div class="col">
                    <div class="row no-gutters pw-input-group">
                      <div class="col-6">
                        <input
                          type="number"
                          #quantity
                          class="pw-bg-input-box border-right pw-border-radius-left"
                          (keypress)="numberOnly($event)"
                          formControlName="quantity"
                        />
                      </div>
                      <div class="col-3">
                        <button
                          class="pw-bg-input-box border-right"
                          (click)="increaseQuantity(i)"
                        >
                          <span class="pw-i-12 pw-plus-icon-12"></span>
                        </button>
                      </div>
                      <div class="col-3">
                        <button
                          (click)="decreaseQuantity(i)"
                          class="pw-bg-input-box pw-border-radius-right"
                        >
                          <span class="pw-i-12 pw-minus-icon-12"></span>
                        </button>
                      </div>
                    </div>
                    <mat-error
                      *ngIf="
                        item.get('quantity').errors &&
                        item.get('quantity').errors.errorArray
                      "
                    >
                      <poss-web-error-info-tooltip
                        [errorMessage]="item.get('quantity').errors.errorArray"
                      ></poss-web-error-info-tooltip>
                    </mat-error>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-auto ml-auto pw-text-right">
              <button
                *ngIf="
                  itemList.controls.length !== 0 && itemList.status === 'VALID'
                "
                (click)="checkAvailability()"
                class="pw-btn pw-accent-btn"
              >
                {{ 'pw.instock.checkAvailablityButtonText' | translate }}
              </button>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
      <div class="row align-items-center">
        <div class="col-auto">
          <p *ngIf="boutiqueListCount !== 0 && boutiqueListCount !== -1">
            {{
              'pw.interboutiqueTransfer.availableBoutiquesInfoText' | translate
            }}
          </p>
        </div>
        <div class="col-auto pw-list-header__right-content" *ngIf="filterShow">
          <button
            mat-button
            [matMenuTriggerFor]="filterby"
            #clickMenuTrigger="matMenuTrigger"
          >
            <span
              *ngIf="filterValue !== null; else defaultIcon"
              class="pw-i-24 pw-filter-icon-color-24"
            ></span>
            <ng-template #defaultIcon>
              <span class="pw-i-24 pw-filter-icon-24"></span
            ></ng-template>

            {{ getFilterValue() }}
          </button>

          <mat-menu #filterby="matMenu">
            <button
              mat-menu-item
              (click)="filterBoutiqueList(IBTBoutiquesFilterEnumRef.ALL)"
            >
              {{ 'pw.interboutiqueTransfer.filterOption5' | translate }}
            </button>
            <button
              mat-menu-item
              (click)="filterBoutiqueList(IBTBoutiquesFilterEnumRef.TOWN)"
            >
              {{ 'pw.interboutiqueTransfer.filterOption1' | translate }}
            </button>
            <button
              mat-menu-item
              (click)="filterBoutiqueList(IBTBoutiquesFilterEnumRef.STATE)"
            >
              {{ 'pw.interboutiqueTransfer.filterOption2' | translate }}
            </button>
            <button
              mat-menu-item
              (click)="filterBoutiqueList(IBTBoutiquesFilterEnumRef.REGION)"
            >
              {{ 'pw.interboutiqueTransfer.filterOption3' | translate }}
            </button>
            <button
              mat-menu-item
              (click)="filterBoutiqueList(IBTBoutiquesFilterEnumRef.COUNTRY)"
            >
              {{ 'pw.interboutiqueTransfer.filterOption4' | translate }}
            </button>
          </mat-menu>
        </div>
      </div>

      <!-- boutique list -->
      <poss-web-card-list
        [count]="boutiqueListCount"
        [dataList]="boutiqueList$ | async"
        [pageSize]="pageSize"
        (selected)="onSelectedBoutique($event)"
        (loadMore)="loadBoutiques($event)"
      >
        <ng-template let-item="data">
          <poss-web-card-title>
            {{ item.description }} ({{ item.locationCode }})
          </poss-web-card-title>
          <poss-web-card-subtitle>{{ item.address }}</poss-web-card-subtitle>
          <poss-web-card-content>
            <p>
              {{ item.contactNo }}
            </p>
            <p>
              {{ item.phoneNo }}
            </p>
          </poss-web-card-content>
        </ng-template>
      </poss-web-card-list>
      <!-- loader -->
      <poss-web-loader *ngIf="isLoading"> </poss-web-loader>
    </div>
  </div>
</div>
