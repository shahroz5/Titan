<form
  [formGroup]="tepStoneConfigForm"
  (ngSubmit)="onSubmit()"
  id="ngForm"
  #detailForm="ngForm"
>
  <div class="pw-form-card pw-form-card__margin-top">
    <div class="row">
      <div class="col-lg-3 col-3">
        <mat-form-field>
          <mat-label>{{
            'pw.tepStoneConfig.configName' | translate
          }}</mat-label>
          <input required matInput formControlName="configName" />
          <mat-error
            *ngIf="
              tepStoneConfigForm.get('configName').errors &&
              tepStoneConfigForm.get('configName').errors.errorArray
            "
          >
            <poss-web-error-info-tooltip
              [errorMessage]="
                tepStoneConfigForm.get('configName').errors.errorArray
              "
            >
            </poss-web-error-info-tooltip>
          </mat-error>
        </mat-form-field>
      </div>

      <div class="col-auto pw-detail-card__item pw-form-card__right-container">
        <mat-slide-toggle formControlName="isActive"
          >{{ 'pw.tepStoneConfig.isActive' | translate }}
        </mat-slide-toggle>
      </div>
    </div>
  </div>
  <div class="pw-form-card">
    <form
      [formGroup]="tepStoneConfigDetailsForm"
      (ngSubmit)="onStoneDetailsSubmit()"
    >
      <div class="row">
        <div class="col-md-4 col-lg-2">
          <poss-web-select-dropdown
            class="pw-mat-form-field"
            placeholder="{{
              'pw.tepStoneConfig.stoneTypeCodeTranslate' | translate
            }}"
            [control]="tepStoneConfigDetailsForm.get('stoneTypeCode')"
            [options]="tepStoneConfigStoneTypeList"
            [required]="true"
          >
          </poss-web-select-dropdown>
        </div>
        <div class="col-md-4 col-lg-2">
          <mat-form-field>
            <mat-label>{{
              'pw.tepStoneConfig.descriptionTranslate' | translate
            }}</mat-label>
            <input
              required
              matInput
              formControlName="stoneTypeCodeDescription"
            />
          </mat-form-field>
        </div>
        <div class="col-md-4 col-lg-2">
          <poss-web-select-dropdown
            class="pw-mat-form-field"
            placeholder="{{
              'pw.tepStoneConfig.stoneQualityTranslate' | translate
            }}"
            [control]="tepStoneConfigDetailsForm.get('stoneQuality')"
            [options]="tepStoneConfigQualitiesList"
            [required]="true"
          >
          </poss-web-select-dropdown>
        </div>
        <div class="col-md-4 col-lg-2">
          <poss-web-select-dropdown
            class="pw-mat-form-field"
            placeholder="{{ 'pw.tepStoneConfig.rangeTranslate' | translate }}"
            [control]="tepStoneConfigDetailsForm.get('rangeId')"
            [options]="tepStoneConfigRangeList"
            [required]="true"
          >
          </poss-web-select-dropdown>
        </div>
        <div class="col-md-4 col-lg-2">
          <mat-form-field>
            <mat-label>{{
              'pw.tepStoneConfig.deductionPercentTranslate' | translate
            }}</mat-label>
            <input required matInput formControlName="deductionPercentage" />
            <mat-error
              *ngIf="
                tepStoneConfigDetailsForm.get('deductionPercentage').errors &&
                tepStoneConfigDetailsForm.get('deductionPercentage').errors
                  .errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  tepStoneConfigDetailsForm.get('deductionPercentage').errors
                    .errorArray
                "
              >
              </poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col-auto ml-auto">
          <button mat-button class="pw-btn pw-primary-btn" type="submit">
            {{ 'pw.tepStoneConfig.add' | translate }}
          </button>
        </div>
      </div>
    </form>
  </div>
  <div class="pw-form-card">
    <div class="row">
      <div class="col-auto mt-3">
        <div class="pw-font-weight-bold">
          {{ 'pw.tepProductGroupConfig.details' | translate }}
        </div>
      </div>
      <div class="col-lg-auto col-auto ml-auto">
        <div class="pw-search-bar">
          <mat-form-field [formGroup]="searchForm">
            <input
              #searchBox
              matInput
              type="text"
              placeholder="{{
                'pw.tepStoneConfig.searchByStoneTypeCode' | translate
              }}"
              formControlName="searchValue"
            />
            <mat-icon matSuffix>
              <span
                class="pw-i-16 pw-search-icon-16"
                *ngIf="!searchForm.value.searchValue"
              ></span>
            </mat-icon>
            <mat-icon matSuffix (click)="clearSearch()">
              <span
                *ngIf="searchForm.value.searchValue"
                class="pw-i-10 pw-close-icon-16"
              ></span
            ></mat-icon>
          </mat-form-field>
        </div>
      </div>
    </div>
    <div class="row">
      <poss-web-top-info-panel
        *ngIf="isFocusing && focusedHeaderName"
        [isFocusing]="isFocusing"
        [focusedHeaderName]="focusedHeaderName"
        [currentRowData]="currentRowInfo"
      >
      </poss-web-top-info-panel>
      <ag-grid-angular
        class="m-2 pw-titan-poss-theme pw-ag-grid-table"
        [defaultColDef]="defaultColDef"
        rowSelection="multiple"
        [columnDefs]="themeCodesColumnDefs"
        [rowData]="tepStoneConfigDetailsGridData"
        [context]="getContext()"
        [domLayout]="domLayout"
        [rowHeight]="rowHeight"
        [animateRows]="animateRows"
        [frameworkComponents]="getComponents()"
        (cellKeyPress)="onCellKeyPress($event)"
        (gridReady)="gridReady($event)"
        (gridSizeChanged)="onGridSizeChanged($event)"
        (selectionChanged)="selectionChanged($event)"
        (cellFocused)="onCellFocused($event)"
        (focusout)="focusOut($event)"
      >
      </ag-grid-angular>
    </div>
    <div class="row no-gutters d-flex justify-content-between">
      <div class="mt-2">
        <button
          type="button"
          class="pw-btn pw-accent-btn"
          (click)="editValue()"
          [disabled]="!hasSelectedRow"
        >
          {{ 'pw.tepStoneConfig.editValue' | translate }}
        </button>
      </div>
      <div class="col-auto ml-auto">
        <mat-paginator
          class="pw-paginator"
          *ngIf="
            totalElements > minPageSize &&
            tepStoneConfigDetailsGridData.length > 0
          "
          [length]="totalElements"
          [pageSize]="pageEvent.pageSize"
          [pageIndex]="pageEvent.pageIndex"
          showFirstLastButtons
          [pageSizeOptions]="pageSizeOptions"
          (page)="paginator.emit($event)"
        >
        </mat-paginator>
      </div>
    </div>
  </div>
</form>

<div class="row mb-3">
  <div class="col-auto ml-auto">
    <button
      class="pw-btn pw-primary-btn"
      type="button"
      [disabled]="!tepStoneConfig.configId"
      (click)="openLocationMapping()"
    >
      {{ 'pw.tepExceptionConfig.locationMapping' | translate }}
    </button>
  </div>
  <div class="col-auto">
    <button
      class="pw-btn pw-accent-btn"
      type="submit"
      (click)="detailForm.ngSubmit.emit()"
    >
      {{ 'pw.tepExceptionConfig.save' | translate }}
    </button>
  </div>
</div>
