<div
  class="container-fluid pw-overlay-notification-gutter"
  [class.pw-overlay-notification-gutter]="hasNotification"
  [formGroup]="binToBinTransferForm"
>
  <div class="row">
    <div class="col-12 col-lg-10 m-auto">
      <div class="pw-top-heading-container">
        <div class="row pw-top-heading-container__item">
          <div class="col-auto">
            <div class="pw-top-heading-container__main-head">
              <a (click)="back()">
                <span class="pw-i-24 pw-back-arrow-icon-24"></span>
              </a>
              <span class="pw-i-36 pw-instock-icon-36"></span>
              <div>
                <h2>{{ 'pw.binToBinTransfer.title' | translate }}</h2>
                <h5 class="pw-top-heading-container__sub-heading">
                  {{ 'pw.binToBinTransfer.subTitle' | translate }}
                </h5>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="pw-tab">
        <ul #tabRef class="pw-tab__list">
          <li
            id="binToBin"
            class="pw-tab__list-item"
            *possWebPermission="loadPermission(BIN_TO_BIN_TRANSFER_TAB)"
          >
            <a
              [class.pw-is-active-bar]="
                type == binToBinTransferTypeEnumRef.VARIANT_CODE ||
                type == binToBinTransferTypeEnumRef.BIN_CODE ||
                type == binToBinTransferTypeEnumRef.PRODUCT_GROUP ||
                type == binToBinTransferTypeEnumRef.PRODUCT_CATEGORY
              "
              (click)="
                changeBinToBinTransferType(
                  binToBinTransferTypeEnumRef.BTB_TRANSFER_TAB
                )
              "
            >
              <h5 class="pw-tab__item">
                {{ 'pw.binToBinTransfer.heading' | translate }}
              </h5>
            </a>
          </li>
          <li
            id="history"
            class="pw-tab__list-item"
            *possWebPermission="loadPermission(BIN_TO_BIN_TRANSFER_HISTORY_TAB)"
          >
            <a
              [class.pw-is-active-bar]="
                type == binToBinTransferTypeEnumRef.HISTORY
              "
              (click)="
                changeBinToBinTransferType(binToBinTransferTypeEnumRef.HISTORY)
              "
            >
              <h5 class="pw-tab__item">History</h5>
            </a>
          </li>
        </ul>
      </div>
      <div
        [ngClass]="{
          hidden:
            type === binToBinTransferTypeEnumRef.VARIANT_CODE ||
            type === binToBinTransferTypeEnumRef.BIN_CODE ||
            type === binToBinTransferTypeEnumRef.PRODUCT_CATEGORY ||
            type === binToBinTransferTypeEnumRef.PRODUCT_GROUP
        }"
      >
        <div class="row align-items-center ml-0">
          <div class="col-auto ml-auto">
            <a (click)="advancedFilter()">
              <p>
                <span
                  class="pw-i-24 pw-filter-icon-24 pw-filter-box__icon"
                  [ngClass]="isFilterApplied ? 'pw-filter-icon-color-24' : ''"
                ></span>
                {{ 'pw.binToBinTransfer.advancedFilter' | translate }}
              </p>
            </a>
          </div>
          <div class="col-lg-3 col-4">
            <mat-form-field class="pw-search-bar" floatLabel="never">
              <input
                #searchBox
                matInput
                class="pw-input-box"
                [placeholder]="'pw.binToBinTransfer.searchDocNo' | translate"
                [formControl]="historySearchFormControl"
                (keypress)="numberCheck($event)"
              />
              <mat-icon matSuffix>
                <span
                  *ngIf="!historySearchFormControl.value"
                  class="pw-i-16 pw-search-icon-16"
                ></span
              ></mat-icon>
              <mat-icon matSuffix (click)="clearHistorySearch()">
                <span
                  *ngIf="historySearchFormControl.value"
                  class="pw-i-10 pw-close-icon-16"
                ></span
              ></mat-icon>
            </mat-form-field>
          </div>
        </div>
        <div *ngIf="type === binToBinTransferTypeEnumRef.HISTORY">
          <poss-web-card-list
            *ngIf="type == binToBinTransferTypeEnumRef.HISTORY"
            [count]="binToBinHistoryTotalCount$ | async"
            [dataList]="
              (hasSearchedItems$ | async) === false
                ? (binToBinHistory$ | async)
                : 0
            "
            [pageSize]="pageSize"
            (loadMore)="loadList($event)"
            (selected)="onSelected($event)"
          >
            <ng-template let-item="data">
              <poss-web-card-title>
                <h4>
                  {{ 'pw.binToBinTransfer.historyDocNo' | translate
                  }}{{ item.srcDocNo }}
                </h4>
              </poss-web-card-title>

              <div class="pw-grid-card__content">
                {{ item.totalAvailableQuantity + item.totalMeasuredQuantity }}
                {{ 'pw.binToBinTransfer.quantityLableText' | translate }}
              </div>
              <poss-web-card-content>
                <p class="pw-grid-card__content">
                  {{ item.srcDocDate | dateFormatter }}
                </p>
                <p class="pw-grid-card__content">
                  {{
                    item.totalAvailableWeight + item.totalMeasuredWeight
                      | weightFormatter
                  }}
                  {{ item.weightUnit }} |
                  {{
                    item.totalAvailableValue + item.totalMeasuredValue
                      | currencyFormatter: item.currencyCode
                  }}
                </p>
              </poss-web-card-content>
            </ng-template>
          </poss-web-card-list>
          <h3
            class="pw-text-center m-5"
            *ngIf="
              isLoadingHistory === false &&
              (binToBinHistory$ | async)?.length == 0
            "
          >
            {{ 'pw.binToBinTransfer.emptyFilterCombination' | translate }}
          </h3>
        </div>
      </div>
      <ng-container
        *ngIf="
          type == binToBinTransferTypeEnumRef.VARIANT_CODE ||
          type == binToBinTransferTypeEnumRef.BIN_CODE ||
          type == binToBinTransferTypeEnumRef.PRODUCT_CATEGORY ||
          type == binToBinTransferTypeEnumRef.PRODUCT_GROUP
        "
      >
        <div class="pw-search-container">
          <div class="row justify-content-end" *ngIf="allItemList.length === 0">
            <div class="col-auto">
              <button
                (click)="downLoadFormatFn()"
                class="pw-btn pw-primary-btn pw-form-card__upload-btn"
              >
                <span class="pw-i-24 pw-download-icon-24"></span>
                {{ 'pw.discountExculdeConfig.downloadButton' | translate }}
              </button>
            </div>
            <div class="col-auto">
              <button
                (click)="fileInput.click()"
                class="pw-btn pw-primary-btn pw-form-card__upload-btn"
              >
                <span class="pw-i-24 pw-upload-icon-24"></span>
                <input
                  [hidden]="true"
                  #fileInput
                  class="pw-hidden"
                  type="file"
                  (change)="uploadConfigDetails($event)"
                />

                {{ 'pw.discountExculdeConfig.uploadButton' | translate }}
              </button>
            </div>
          </div>
          <div class="row align-items-baseline" *ngIf="!isUploadedItemsList()">
            <poss-web-select-dropdown
              #typeDropdown
              class="col-lg-2 pw-selectable-dropdown"
              placeholder="{{
                'pw.binToBinTransfer.selectByPlaceholderText' | translate
              }}"
              [control]="binToBinTransferForm.get('type')"
              [options]="selectByOptions"
              [required]="true"
            >
            </poss-web-select-dropdown>

            <poss-web-item-search-list
              class="col-lg-10"
              [itemList]="isSelectByVariantCode() ? searchedItemList : []"
              [multipleSelection]="true"
              [validate]="isSelectByVariantCode()"
              [placeholder]="
                isSelectByVariantCode()
                  ? ('pw.binToBinTransfer.searchByvariantCodePlaceholder'
                    | translate)
                  : (
                      'pw.binToBinTransfer.searchByGroupCodePlaceholder'
                      | translate
                    ).replace(
                      '{0}',
                      selectByKeyMap.get(binToBinTransferForm.get('type').value)
                    )
              "
              [hasResults]="
                !(
                  isSelectByVariantCode() &&
                  (hasSearchedItems$ | async) &&
                  searchedItemList.length == 0 &&
                  !isAddedToCart
                )
              "
              [hasSuggestiveSearch]="isSelectByVariantCode()"
              [isBinToBinTransfer]="true"
              [isMaintainSelection]="true"
              (search)="search($event)"
              (clear)="onSearchClear()"
              (selected)="onSearchItemsSelected($event)"
            >
              <ng-template let-item="data">
                <poss-web-bin-to-bin-transfer-item
                  class="pw-list-card d-block"
                  [canSelect]="false"
                  [item]="item"
                  [showSourceBin]="true"
                  (loadImageEvent)="loadImageUrl($event, true)"
                ></poss-web-bin-to-bin-transfer-item>
              </ng-template>
            </poss-web-item-search-list>
          </div>
        </div>
        <ng-container *ngIf="isSelectByGroup()">
          <div class="pw-message mb-3">
            {{ 'pw.binToBinTransfer.selectLable' | translate }}
            {{ selectByKeyMap.get(binToBinTransferForm.get('type').value) }}
          </div>

          <poss-web-card-list
            [count]="itemGroupsTotalCount$ | async"
            [dataList]="itemGroups$ | async"
            [pageSize]="pageSize"
            (loadMore)="loadList($event)"
            (selected)="onSelected($event)"
          >
            <ng-template let-info="data">
              <poss-web-card-title>
                {{ info.name }}
                <ng-container
                  *ngIf="
                    binToBinTransferForm.get('type').value !=
                    binToBinTransferTypeEnumRef.BIN_CODE
                  "
                >
                  - {{ info.description }}
                </ng-container>
              </poss-web-card-title>
              <poss-web-card-subtitle>
                {{ info.products }}
                {{ 'pw.binToBinTransfer.quantityLableText' | translate }}
              </poss-web-card-subtitle>
              <poss-web-card-content>
                <div class="mt-3">
                  <p>
                    {{ info.totalValue | currencyFormatter: info.currencyCode }}
                  </p>
                  <p>
                    {{ info.totalWeight | weightFormatter }}
                    {{ info.weightUnit }}
                  </p>
                </div>
              </poss-web-card-content>
            </ng-template>
          </poss-web-card-list>
          <h3
            class="pw-text-center m-5 pw-success-color"
            *ngIf="
              (isLoadingItemListGroup$ | async) === false &&
              (itemGroups$ | async)?.length == 0
            "
          >
            {{ getNoDataFoundMsg() }}
          </h3>
        </ng-container>

        <ng-container
          *ngIf="isSelectByVariantCode() && allItemList.length != 0"
        >
          <div class="row align-items-center">
            <div class="col-auto pw-message">
              {{ 'pw.binToBinTransfer.productListLable' | translate }}
            </div>

            <div class="col-lg-4 col-md-4 col-6 ml-auto pt-2 pb-3 d-flex">
              <div class="ml-auto">
                <p>
                  {{
                    'pw.binToBinTransfer.selectDestinationBinLableText'
                      | translate
                  }}
                </p>

                <button
                  class="pw-btn pw-cta-btn pw-accent-btn"
                  (click)="openBinSelectionPopup()"
                  [disabled]="!selectedItems.length"
                >
                  <div class="row no-gutters align-items-center">
                    <div class="col-auto">
                      <p>
                        <ng-container *ngIf="selectedBin; else showSelectBin">
                          {{ selectedBin.binCode }} ({{
                            selectedBin.binGroupCode
                          }})
                        </ng-container>
                        <ng-template #showSelectBin>
                          {{
                            'pw.binToBinTransfer.selectDestinationBinLableText'
                              | translate
                          }}
                        </ng-template>
                      </p>
                    </div>
                    <div class="col-auto ml-auto">
                      <span class="pw-i-16 pw-bin-icon-16"></span>
                    </div>
                  </div>
                </button>
              </div>
            </div>
          </div>

          <div class="row align-items-flex-end pw-filter-box">
            <div class="col-lg-7">
              <div class="row align-items-baseline">
                <mat-radio-group formControlName="selectItems" class="col-auto">
                  <mat-radio-button
                    value="selectAll"
                    class="pw-filter-box__radio-btn"
                    *ngIf="isUploadedItemsList()"
                  >
                    <p>
                      {{
                        'pw.binToBinTransfer.selectAllCheckBoxLable' | translate
                      }}
                    </p>
                  </mat-radio-button>
                  <mat-radio-button
                    value="selectCurrentPage"
                    class="pw-filter-box__radio-btn"
                  >
                    <p>
                      {{
                        'pw.binToBinTransfer.selectCurrentPageProductsCheckBoxLable'
                          | translate
                      }}
                    </p>
                  </mat-radio-button>
                </mat-radio-group>
                <div
                  *ngIf="selectedItems.length > 0"
                  class="col-auto ml-auto ml-lg-0"
                >
                  <a
                    id="clearAll"
                    (click)="resetSelection()"
                    class="pw-clickable"
                  >
                    <p>
                      <span class="pw-i-16 pw-clear-icon-16"></span>
                      {{ 'pw.binToBinTransfer.clearAllLable' | translate }}
                    </p>
                  </a>
                </div>
              </div>
            </div>

            <div class="col-lg-5">
              <div
                class="row pw-filter-box__right-content align-items-flex-end"
              >
                <div class="col-auto">
                  <a id="filter" (click)="openFilter()">
                    <p>
                      <span
                        *ngIf="filter.length === 0"
                        class="pw-i-16 pw-filter-icon-16 pw-filter-box__icon"
                      ></span>
                      <span
                        *ngIf="filter.length !== 0"
                        class="pw-i-24 pw-filter-icon-color-24 pw-filter-box__icon"
                      ></span>
                      {{ 'pw.binToBinTransfer.filterLable' | translate }}
                    </p>
                  </a>
                </div>
                <div class="col-auto">
                  <a id="sort" (click)="openSortDailog()">
                    <p>
                      <span
                        class="pw-i-16 pw-sort-icon-16 pw-filter-box__icon"
                      ></span>

                      {{ 'pw.binToBinTransfer.sortLable' | translate }}
                    </p>
                  </a>
                </div>
                <poss-web-item-search
                  class="col-lg-6 col-4 ml-auto ml-lg-0"
                  placeholder="{{
                    'pw.binToBinTransfer.searchByVariantCodePlaceholderText'
                      | translate
                  }}"
                  (search)="searchInCart($event)"
                  (clear)="clearSearchofCart()"
                >
                </poss-web-item-search>
              </div>
            </div>
          </div>

          <poss-web-bin-to-bin-transfer-item-list
            [itemList]="itemList"
            [canDelete]="!isUploadedItemsList()"
            [showSourceBin]="true"
            [showDestinationBin]="
              binToBinTransferForm?.get('selectItems')?.value !== 'selectAll'
            "
            [bins]="bins"
            [canSelect]="true"
            [isSelectAll]="binToBinTransferForm?.get('selectItems')?.value === 'selectAll'"
            [defectTypeDescriptionList]="defectTypeDescriptionList"
            [defectCodeDescriptionList]="defectCodeDescriptionList"
            (delete)="onDelete($event)"
            (updateItem)="onUpdateItem($event)"
            (loadImageEvent)="loadImageUrl($event, false)"
          ></poss-web-bin-to-bin-transfer-item-list>

          <mat-paginator
            *ngIf="isUploadedItemsList()"
            class="pw-paginator"
            [length]="count"
            [pageSize]="pageEvent.pageSize"
            [pageIndex]="pageEvent.pageIndex"
            showFirstLastButtons
            [pageSizeOptions]="pageSizeOptions"
            (page)="paginate($event)"
          >
          </mat-paginator>
          <h3
            class="pw-text-center m-5 pw-success-color"
            *ngIf="itemList.length == 0"
          >
            {{ noDataFoundMessageProducts }}
          </h3>
        </ng-container>
      </ng-container>

      <poss-web-loader
        *ngIf="
          (isLoadingBins$ | async) ||
          (isSearchingItems$ | async) ||
          (isLoadingItems$ | async) ||
          (isLoadingItemListGroup$ | async) ||
          isLoadingHistory ||
          (isLoadingImage$ | async)
        "
      >
      </poss-web-loader>
    </div>
  </div>
</div>
<ng-template #stockInformationNotificationTemplate>
  <div
    class="pw-text-center pw-max-width-50-rem pw-max-height-10-rem pw-overflow-y"
  >
    <div *ngIf="invalidStockItems">
      {{ 'pw.binToBinTransfer.invalidItemsLabel' | translate }}:<br />
      {{ invalidStockItems }}
    </div>
    <div *ngIf="notAllowedItems">
      {{ 'pw.binToBinTransfer.notAllowedItemsLabel' | translate }}:<br />
      {{ notAllowedItems }}
    </div>
  </div>
</ng-template>
