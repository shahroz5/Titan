<div class="pw-detail-card">
  <div class="row pw-detail-card__flex-end" [formGroup]="TEPHistory">
    <mat-form-field class="col-lg-2 col-3" [floatLabel]="'auto'">
      <mat-label>{{ 'pw.tep.docNoPlaceholder' | translate }}</mat-label>
      <input
        matInput
        class="pw-single-bordered-input"
        formControlName="docNumber"
        type="text"
        autocomplete="off"
      />
      <mat-error
        *ngIf="
          TEPHistory.get('docNumber').errors &&
          TEPHistory.get('docNumber').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="TEPHistory.get('docNumber').errors.errorArray"
        >
        </poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>
    <mat-form-field class="col-lg-2 col-3" [floatLabel]="'auto'">
      <mat-label>{{ 'pw.tep.cnDocNoPlaceholder' | translate }}</mat-label>
      <input
        matInput
        class="pw-single-bordered-input"
        formControlName="cnDocNo"
        type="number"
        autocomplete="off"
      />
      <mat-error
        *ngIf="
          TEPHistory.get('cnDocNo').errors &&
          TEPHistory.get('cnDocNo').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="TEPHistory.get('cnDocNo').errors.errorArray"
        >
        </poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>

    <poss-web-fiscal-year
      class="col-lg-2 col-3"
      [control]="TEPHistory.get('fiscalYear')"
      [required]="false"
      [currentFiscalYear]="currentFiscalYear"
      [placeHolder]="'pw.creditNote.searchByFiscalYearLabel' | translate"
      [disabled]="false"
      [data]="data?.fiscalYear"
    ></poss-web-fiscal-year>
    <poss-web-select-dropdown
      class="col-lg-2 col-3"
      [placeholder]="'pw.tep.searchType' | translate"
      [control]="TEPHistory.get('searchType')"
      [options]="searchTypes"
      [required]="false"
      (selectionChange)="onSearchTypeChanged($event)"
    ></poss-web-select-dropdown>
    <mat-form-field
      class="col-lg-2 col-3"
      [floatLabel]="'auto'"
      *ngIf="showSearchField"
    >
      <mat-label>{{ searchFieldPlaceholder | translate }}</mat-label>
      <input
        matInput
        class="pw-single-bordered-input"
        formControlName="searchField"
        type="text"
        required
        autocomplete="off"
      />
      <mat-error
        *ngIf="
          TEPHistory.get('searchField').errors &&
          TEPHistory.get('searchField').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="TEPHistory.get('searchField').errors.errorArray"
        >
        </poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>
    <poss-web-select-dropdown
      class="col-lg-2 col-3"
      [placeholder]="'pw.tep.status' | translate"
      [control]="TEPHistory.get('status')"
      [options]="statusOptions"
      [required]="true"
      (selectionChange)="onStatusChanged($event)"
    ></poss-web-select-dropdown>
    <mat-form-field class="col-lg-4 col-3">
      <mat-label>{{ 'pw.tep.docDateRange' | translate }}</mat-label>
      <mat-date-range-input [rangePicker]="picker" [max]="currentDate">
        <input
          matStartDate
          formControlName="startDate"
          placeholder="Doc From Date"
        />
        <input matEndDate formControlName="endDate" placeholder="Doc To Date" />
      </mat-date-range-input>
      <mat-datepicker-toggle matSuffix [for]="picker">
        <mat-icon matDatepickerToggleIcon>
          <span class="pw-i-12 pw-calender-icon-12"></span>
        </mat-icon>
      </mat-datepicker-toggle>
      <mat-date-range-picker #picker></mat-date-range-picker>

      <mat-error
        *ngIf="
          TEPHistory.get('startDate').errors &&
          TEPHistory.get('startDate').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="TEPHistory.get('startDate').errors.errorArray"
        ></poss-web-error-info-tooltip>
      </mat-error>
      <mat-error
        *ngIf="
          TEPHistory.get('endDate').errors &&
          TEPHistory.get('endDate').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="TEPHistory.get('endDate').errors.errorArray"
        ></poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>
    <mat-form-field class="col-lg-2 col-3" [floatLabel]="'auto'">
      <mat-label>{{ 'pw.tep.fromNetAmountPlaceholder' | translate }}</mat-label>
      <input
        matInput
        class="pw-single-bordered-input"
        formControlName="fromNetAmount"
        type="text"
        autocomplete="off"
        possWebAmountInput
      />
      <mat-error
        *ngIf="
          TEPHistory.get('fromNetAmount').errors &&
          TEPHistory.get('fromNetAmount').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="TEPHistory.get('fromNetAmount').errors.errorArray"
        >
        </poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>
    <mat-form-field class="col-lg-2 col-3" [floatLabel]="'auto'">
      <mat-label>{{ 'pw.tep.toNetAmountPlaceholder' | translate }}</mat-label>
      <input
        matInput
        class="pw-single-bordered-input"
        formControlName="toNetAmount"
        type="text"
        autocomplete="off"
        possWebAmountInput
      />
      <mat-error
        *ngIf="
          TEPHistory.get('toNetAmount').errors &&
          TEPHistory.get('toNetAmount').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="TEPHistory.get('toNetAmount').errors.errorArray"
        >
        </poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>
    <poss-web-select-dropdown
      class="col-lg-2 col-3"
      [placeholder]="'pw.tep.tepType' | translate"
      [control]="TEPHistory.get('tepType')"
      [options]="tepTypes"
      [required]="true"
      (selectionChange)="onStatusChanged($event)"
    ></poss-web-select-dropdown>

    <div class="col-auto pw-detail-card__right-container">
      <button
        mat-flat-button
        class="pw-btn pw-accent-btn"
        (click)="searchAdvanceHistoryItem(0, true)"
        [disabled]="TEPHistory.invalid"
      >
        {{ 'pw.tep.search' | translate }}
      </button>
    </div>
  </div>
</div>

<poss-web-tep-search-list
  [tep]="historyItems"
  [disable]="historyItems.length == 0"
  [count]="this.totalElements"
  [pageEvent]="configPageEvent"
  (paginator)="paginate($event)"
  [pageSizeOptions]="pageSizeOptions"
  [currencyCode]="currencyCode"
  [minPageSize]="minPageSize"
  (onselected)="onSelected($event)"
  (sort)="sort($event)"
></poss-web-tep-search-list>

<poss-web-loader *ngIf="isLoading$ | async"></poss-web-loader>
