<form [formGroup]="createTepFormGroup">
  <poss-web-view-tep-details
    [workflowDetails]="workflowDetails"
    [cancelDetails]="tepDetails"
    [tepType]="tepType"
    [rsoNames]="rsoNamesList"
  ></poss-web-view-tep-details>

  <div class="pw-detail-card">
    <div class="row">
      <div class="col-auto">
        <div class="pw-detail-card__heading">
          {{ 'pw.tep.productDetails' | translate }}
        </div>
      </div>
    </div>
    <poss-web-cut-piece-tep-item-grid *ngIf="tepType === tepTypesEnum.TEP_CUT_PIECE"
      [tepItemList]="tepItemList"
      [isEditMode]="false"
    ></poss-web-cut-piece-tep-item-grid>

    <poss-web-tep-items-listing-grid *ngIf="tepType !== tepTypesEnum.TEP_CUT_PIECE"
      [tepItemList]="tepItemList"
      [isEditMode]="false"
      [disabled]="true"
      (isViewItemValuation)="viewTepItemValuation($event)"
      (loadImageUrl)="loadItemImageUrl($event)"
    ></poss-web-tep-items-listing-grid>
  </div>
  <div class="pw-detail-card">
    <div class="pw-detail-card__heading">
      {{ 'pw.tep.selectMethod' | translate }}
    </div>
    <div class="row">
      <mat-radio-group
        class="col-auto"
        aria-labelledby="tep-type-radio-group-label"
        formControlName="tepPaymentType"
      >
        <mat-radio-button
          class="pw-radio-btn mr-3"
          [value]="tepPaymentTypesEnum?.CN"
          [disabled]="true"
        >
          <label class="pw-radio-btn__label">{{
            'pw.tep.cn' | translate
          }}</label>
        </mat-radio-button>
        <mat-radio-button
          class="pw-radio-btn mr-3"
          [value]="tepPaymentTypesEnum?.REFUND"
          [disabled]="true"
        >
          <label class="pw-radio-btn__label">{{
            'pw.tep.refundRadioLabel' | translate
          }}</label>
        </mat-radio-button>
      </mat-radio-group>
    </div>
    <poss-web-refund-payment-mode-fields
      *ngIf="
        createTepFormGroup.get('tepPaymentType').value ===
        tepPaymentTypesEnum?.REFUND
      "
      [isCashLimitExceeded]="netRefundAmt > tepItemConfiguration?.refundCashLimit"
      [allowedPaymentMode]="allowedPaymentMode"
      [refundDeductionAmt]="refundDeductionAmt"
      [netRefundAmt]="netRefundAmt"
      [refundDetails]="refundDetails"
      [disabled]="true"
      [idProofImageUrl]="idProofImageUrl"
      [cancelledChequeImageUrl]="cancelledChequeImageUrl"
      [approvalMailImageUrl]="approvalMailImageUrl"
      (emitRefundDetails)="getRefundDetails($event)"
      (uploadFile)="uploadFile($event)"
    ></poss-web-refund-payment-mode-fields>

    <poss-web-file-upload-list-items
      [fileList]="filesList"
      (view)="loadImageUrl($event)"
      [viewMode]="'true'"
    ></poss-web-file-upload-list-items>
  </div>

  <div
    class="pw-detail-card"
    *ngIf="
      createTepFormGroup.get('tepType').value ===
      createTepTypesEnum?.FULL_VALUE_TEP
    "
  >
    <div class="pw-detail-card__heading">
      {{ 'pw.tep.approverDetails' | translate }}
    </div>
    <div class="row pw-detail-card__margin-top">
      <div class="col-auto">
        <poss-web-select-dropdown
          [placeholder]="'pw.tep.selectApprover' | translate"
          [control]="createTepFormGroup.get('fvtApprover')"
          [options]="approverListForFvt"
          [disabled]="true"
        ></poss-web-select-dropdown>
      </div>

   <mat-form-field
        *ngIf="approverProcessType === 'CODE'"
        class="col-lg-2 col-3"
      >
        <input
          matInput
          formControlName="fvtApprovalCode"
          class="pw-single-bordered-input"
          placeholder="Approval code"
          [disabled]="true"
        />
        <mat-error
          *ngIf="
            createTepFormGroup.get('fvtApprovalCode').errors &&
            createTepFormGroup.get('fvtApprovalCode').errors.errorArray
          "
        >
          <poss-web-error-info-tooltip
            [errorMessage]="
              createTepFormGroup.get('fvtApprovalCode').errors.errorArray
            "
          ></poss-web-error-info-tooltip>
        </mat-error>
      </mat-form-field>

      <div class="col-auto" *ngIf="approverProcessType === 'EMAIL'">
        <mat-form-field class="pw-full-bordered-input-box">
          <input
            matInput
            [matDatepicker]="datepicker"
            formControlName="fvtApprovalDate"
            (click)="datepicker.open()"
            placeholder="{{ 'pw.tep.approvalDate' | translate }}"
            [max]="businessDate"
            [min]="addedItemCmDocDate"
            readonly
            [disabled]="true"
            required
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="datepicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #datepicker></mat-datepicker>
        </mat-form-field>
        <mat-error
          class="col-auto"
          *ngIf="
            createTepFormGroup.get('fvtApprovalDate').errors &&
            createTepFormGroup.get('fvtApprovalDate').errors.errorArray
          "
        >
          <poss-web-error-info-tooltip
            [errorMessage]="
              createTepFormGroup.get('fvtApprovalDate').errors.errorArray
            "
          >
          </poss-web-error-info-tooltip>
        </mat-error>
      </div>
    </div>
  </div>
</form>

<ng-template #tepSuccessNotificationTemplate>
  <div class="pw-text-center">
    <h3 class="pw-success-color" *ngIf="status === tepStatusEnum.CONFIRMED">
      {{ 'pw.tep.tepGenerationSuccessMsg' | translate }}
    </h3>
    <h3
      class="pw-success-color"
      *ngIf="
        status === tepStatusEnum.APPROVAL_PENDING &&
        createTepFormGroup.get('tepType').value !==
          createTepTypesEnum?.FULL_VALUE_TEP
      "
    >
      {{ 'pw.tep.requestApprovalSuccessMsg' | translate }}
    </h3>
    <h3
      class="pw-success-color"
      *ngIf="
        status === tepStatusEnum.APPROVAL_PENDING &&
        createTepFormGroup.get('tepType').value ===
          createTepTypesEnum?.FULL_VALUE_TEP
      "
    >
      {{ 'pw.tep.requestApprovalSuccessMsgForFullValueTep' | translate }}
    </h3>
    <h3 class="pw-success-color" *ngIf="status === tepStatusEnum.HOLD">
      {{ 'pw.tep.holdTepSuccessMsg' | translate }}
    </h3>
    <br />
    <div
      class="pw-black-popup-box__margin-top-10"
      *ngIf="
        docNo &&
        (status === tepStatusEnum.CONFIRMED || status === tepStatusEnum.HOLD)
      "
    >
      {{ 'pw.tep.tepDocNo' | translate }}: {{ docNo }}
    </div>
    <br
      *ngIf="
        tepCnNo &&
        (status === tepStatusEnum.CONFIRMED || status === tepStatusEnum.HOLD)
      "
    />
    <div
      class="pw-black-popup-box__margin-top-10"
      *ngIf="
        tepCnNo &&
        (status === tepStatusEnum.CONFIRMED || status === tepStatusEnum.HOLD)
      "
    >
      {{ 'pw.tep.tepCnNo' | translate }}: {{ tepCnNo }}
    </div>
    <div
      class="pw-black-popup-box__margin-top-10"
      *ngIf="docNo && status === tepStatusEnum.APPROVAL_PENDING"
    >
      {{ 'pw.tep.requestNumber' | translate }}: {{ docNo }}
    </div>
    <br />
    <div class="pw-black-popup-box__margin-top-10">
      <button
        matButton
        class="pw-white-btn"
        (click)="
          printTepConfirmedTransaction(
            tepTransactionId,
            transactionTypeEnum?.TEP,
            subTransactionTypeEnum?.NEW_TEP
          )
        "
      >
        {{ 'pw.tep.print' | translate }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #confirmSuccessNotificationTemplate1>
  <div class="pw-text-center">
    <h3 class="pw-success-color">
      {{ 'pw.tep.TEPRequestCancelmsg' | translate }}
    </h3>
    <h4 class="pw-success-color pw-pointer" (click)="print(true)">
      <span class="pw-i-16 pw-download-icon-16 pw-print"></span>
      {{ 'pw.regularCashMemo.printButtonTxt' | translate }}
    </h4>
  </div>
</ng-template>

<ng-template #confirmSuccessNotificationTemplate2>
  <div class="pw-text-center">
    <h3 class="pw-success-color">
      {{ 'pw.tep.TEPCancelmsg' | translate }}
    </h3>
    <h5 class="pt-2">{{ 'pw.tep.docNo' | translate }} : {{ srcDocNo }}</h5>
    <h4 class="pw-success-color pw-pointer" (click)="print(true)">
      <span class="pw-i-16 pw-download-icon-16 pw-print"></span>
      {{ 'pw.regularCashMemo.printButtonTxt' | translate }}
    </h4>
  </div>
</ng-template>
<poss-web-loader
  *ngIf="
    (isLoading$ | async) ||
    (isProductSearchLoading$ | async) ||
    (printingService.getPrinterIsLoading() | async) ||
    (tepFacade.getIsPriceUpdateLoading() | async)
  "
></poss-web-loader>
