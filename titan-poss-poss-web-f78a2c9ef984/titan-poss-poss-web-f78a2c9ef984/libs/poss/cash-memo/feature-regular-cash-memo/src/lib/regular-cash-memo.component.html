<mat-accordion multi>
  <mat-expansion-panel expanded class="pw-expansion-panel">
    <mat-expansion-panel-header
      class="pw-expansion-panel__header"
      [collapsedHeight]="'40px'"
      [expandedHeight]="'40px'"
    >
      <mat-panel-title class="pw-expansion-panel__heading">
        <span
          class="pw-gold-info-icon"
          [matBadge]="badgeNumber"
          matBadgeOverlap="false"
          [matBadgeColor]="'primary'"
          matBadgePosition="before"
        >
          {{ 'pw.regularCashMemo.customerOderLabel' | translate }}
        </span>
      </mat-panel-title>
    </mat-expansion-panel-header>
    <!-- <ng-container
      *possWebPermission="loadPermission(CASH_MEMO_ADD_EDIT_SUBMENU)"
    > -->
    <div class="pw-card pw-panel">
      <div class="row pw-card__header">
        <poss-web-order-search
          class="col-xl-6 col-lg-6"
          (selectedDocNumberEmit)="selectedDocNumber($event)"
          [clearFormEvent]="clearForm$.asObservable()"
          [disableFormEvent]="disableForm$.asObservable()"
          [abDetails]="abDetails"
          [currentFiscalYear]="currentFiscalYear"
          [setFocus]="setOrderSearchFocus"
        ></poss-web-order-search>
        <poss-web-occasion-selection
          class="col-xl-6 col-lg-6"
          [occasionList]="occasionList$ | async"
          [discountList]="discountList"
          [selectedOccasionEvent]="selectedOccasion$.asObservable()"
          [selectedEncircleEvent]="selectedEncircle$.asObservable()"
          [clearOccasionEvent]="clearOccasion$.asObservable()"
          [clearEncircleEvent]="clearEncircle$.asObservable()"
          [resetEncircleEvent]="resetEncircle$.asObservable()"
          [clearOccasionIconEvent]="clearOccasionIcon$.asObservable()"
          [occasionEnable]="customerId !== null"
          [customerLoyaltyDetails]="customerLoyaltyDetails"
          [enableDiscountUpdate]="enableDiscountUpdate"
          [setFocus]="setOccasionFocus"
          (occasionValueEmit)="selectedOccasionEmit($event)"
          (selectedEncircle)="selectedEncircle($event)"
          (availableEncircle)="availableEncircle($event)"
        ></poss-web-occasion-selection>
      </div>
      <div class="pw-card__body" *ngIf="abDetails">
        <div class="row pw-card__row">
          <div
            *ngIf="abDetails.docDate"
            class="col-xl-auto col-lg-auto col-auto"
          >
            <div class="pw-tertiary-color">
              {{ 'pw.regularCashMemo.docDateLabel' | translate }}
            </div>
            {{ dateFormat(abDetails.docDate) | dateFormatter }}
          </div>
          <div
            *ngIf="abDetails.totalWeight"
            class="col-xl-auto col-lg-auto col-auto"
          >
            <div class="pw-tertiary-color">
              {{ 'pw.regularCashMemo.orderedGrossWtLabel' | translate }}
            </div>
            {{ abDetails.totalWeight | weightFormatter }} {{ weightUnit }}
          </div>
          <div
            *ngIf="abDetails.totalDeliveredWeight"
            class="col-xl-auto col-lg-auto col-auto"
          >
            <div class="pw-tertiary-color">
              {{ 'pw.regularCashMemo.orderedABBalanceWtLabel' | translate }}
            </div>
            {{
              abDetails.totalWeight - abDetails.totalDeliveredWeight
                | weightFormatter
            }}
            {{ weightUnit }}
          </div>

          <div
            *ngIf="
              cmDetails?.metalRateList &&
              cmDetails.metalRateList?.metalRates?.J?.metalTypeCode ===
                metalTypeEnum.GOLD &&
              abDetails?.isFrozenRate
            "
            class="col-xl-2 col-lg-3 col-3"
          >
            <div class="pw-tertiary-color">
              {{ 'pw.advanceBooking.frozenGoldRate' | translate }}
            </div>

            {{
              cmDetails.metalRateList?.metalRates?.J?.ratePerUnit
                | currencyFormatter: currencyCode
            }}
          </div>
          <div
            *ngIf="
              cmDetails?.metalRateList &&
              cmDetails.metalRateList?.metalRates?.L?.metalTypeCode ===
                metalTypeEnum.PLATINUM &&
              abDetails?.isFrozenRate
            "
            class="col-xl-2 col-lg-3 col-3"
          >
            <div class="pw-tertiary-color">
              {{ 'pw.advanceBooking.frozenPlatinumRate' | translate }}
            </div>

            {{
              cmDetails.metalRateList?.metalRates?.L?.ratePerUnit
                | currencyFormatter: currencyCode
            }}
          </div>
          <div
            *ngIf="
              cmDetails?.metalRateList &&
              cmDetails.metalRateList?.metalRates?.P?.metalTypeCode ===
                metalTypeEnum.SILVER &&
              abDetails?.isFrozenRate
            "
            class="col-xl-2 col-lg-3 col-4"
          >
            <div class="pw-tertiary-color">
              {{ 'pw.advanceBooking.frozenSiverRate' | translate }}
            </div>

            {{
              cmDetails.metalRateList?.metalRates?.P?.ratePerUnit
                | currencyFormatter: currencyCode
            }}
          </div>
          <div
            *ngIf="
              cmDetails?.metalRateList &&
              cmDetails.metalRateList?.metalRates?.J?.metalTypeCode ===
                metalTypeEnum.GOLD &&
              abDetails?.isBestRate
            "
            class="col-xl-2 col-lg-3 col-3"
          >
            <div class="pw-tertiary-color">
              {{ 'pw.advanceBooking.bestGoldRate' | translate }}
            </div>

            {{
              cmDetails.metalRateList?.metalRates?.J?.ratePerUnit
                | currencyFormatter: currencyCode
            }}
          </div>
          <poss-web-select-dropdown
            *ngIf="abDetails?.isFrozenRate || abDetails?.isBestRate"
            class="col-auto ml-auto pw-btn-bottom"
            [placeholder]="
              'pw.regularCashMemo.selectItemTypePlaceHolder' | translate
            "
            [control]="metalType"
            [options]="metalTypes"
            (selectionChange)="selectedItemType($event)"
          >
          </poss-web-select-dropdown>
        </div>

        <div class="row pw-card__row">
          <!-- Same has to be implemented for CO, as part of CO Invoke: NAP-10776 -->
          <div
            *ngIf="abDetails?.collectedBy"
            class="col-xl-auto col-lg-auto col-auto"
          >
            <div class="pw-tertiary-color">
              {{ 'pw.regularCashMemo.productCollectedByLabel' | translate }}
            </div>
            {{ abDetails?.collectedBy }}
          </div>
          <div
            *ngIf="abDetails.remarks"
            class="col-xl-auto col-lg-auto col-auto"
          >
            <div class="pw-tertiary-color">
              {{ 'pw.regularCashMemo.remarksLabel' | translate }}
            </div>
          </div>
          {{ abDetails.remarks }}
        </div>
      </div>
    </div>
    <!-- </div> -->
    <!-- </ng-container> -->
  </mat-expansion-panel>
</mat-accordion>
<div class="pw-flat-btn-container" *ngIf="customerId && cashMemoId">
  <button class="pw-flat-btn-container__button">
    <div
      class="pw-flat-btn-container__vertical-label"
      matTooltip="VIEW TCS"
      matTooltipPosition="before"
      (click)="viewTcs()"
    >
      View TCS
    </div>
  </button>
</div>
<ng-template #confirmSuccessNotificationTemplate>
  <div class="pw-text-center">
    <h3 class="pw-success-color">
      {{ 'pw.regularCashMemo.confirmCashMemoMessage' | translate }}:
      {{ confirmedCashmemoDoc }}
    </h3>
    <h3 *ngIf="rivaahGenerated">
      Customer is eligible for Rivaah coupon, which will be sent to the
      customer's mobile number
    </h3>

    <h4 *ngIf="newlyGeneratedCn?.length > 0">
      Generated Partial CN Amount of :
      {{
        newlyGeneratedCn[0].otherDetails.data.remainingAmount
          | currencyFormatter: currencyCode
      }}
      ,&nbsp; {{ 'pw.regularCashMemo.newCnLabel' | translate }}:
      {{ newlyGeneratedCn[0].otherDetails.data.newCNNumber }}
    </h4>
    <!--this line was commented because of UAT defect : 1933 -->
    <!-- <h4 *ngIf="cnNos.length > 0">
      {{ 'pw.regularCashMemo.CNNO' | translate }} :
      {{ cnNos }}
    </h4> -->
    <h4 *ngIf="refundAmountAsCash !== 0">
      {{ 'pw.regularCashMemo.refundAmountMsg' | translate }} :
      {{ refundAmountAsCash | currencyFormatter: currencyCode }}
    </h4>

    <h4 class="pw-success-color pw-pointer" (click)="print()">
      <span class="pw-i-16 pw-download-icon-16 pw-print"></span>
      {{ 'pw.regularCashMemo.printButtonTxt' | translate }}
    </h4>
    <h4 class="pw-success-color pw-pointer mt-1" (click)="printAnnexure()">
      <span class="pw-i-16 pw-download-icon-16 pw-print"></span>
      {{ 'pw.regularCashMemo.printAnnexure' | translate }}
    </h4>
  </div>
</ng-template>
<poss-web-loader
  *ngIf="
    (isLoading$ | async) ||
    (isLoadingOrder$ | async) ||
    (printingService.getPrinterIsLoading() | async)
  "
>
</poss-web-loader>
