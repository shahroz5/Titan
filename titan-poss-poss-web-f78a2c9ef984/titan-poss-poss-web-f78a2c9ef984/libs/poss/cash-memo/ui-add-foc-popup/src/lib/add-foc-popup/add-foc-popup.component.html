<div class="pw-confirmation-box">
  <div
    class="row pw-confirmation-box__header pw-cursor-grab"
    cdkDragBoundary=".cdk-overlay-container"
    cdkDragRootElement=".cdk-overlay-pane"
    cdkDrag
    cdkDragHandle
  >
    <div class="col-auto">{{ 'pw.foc.addFoc' | translate }}</div>
    <div class="col pw-text-right">
      <a class="sub-heading" (click)="closePopup()">
        <span class="pw-i-24 pw-close-no-border-icon-24"></span>
      </a>
    </div>
  </div>
  <div class="pw.confirmation-box">
    <div class="row">
      <div class="col-lg-3 col-3 pw-vertical-tab schemes-row">
        <mat-selection-list [multiple]="false">
          <mat-card-header>
            <h4 class="mt-1 mb-2">{{ 'pw.foc.offers' | translate }}</h4>
          </mat-card-header>
          <mat-divider></mat-divider>
          <mat-list-option
            *ngFor="let focScheme of focData; let rowIndex = index"
            (click)="updateTab(rowIndex)"
          >
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <div style="display: flex; flex-direction: column">
                <div>{{ 'pw.foc.offer' | translate }} {{ rowIndex + 1 }}</div>
              </div>

              <div>
                <button mat-icon-button>
                  <mat-icon
                    *ngIf="
                      form &&
                      form.touched &&
                      form.controls?.parentForm &&
                      getControls()[rowIndex] &&
                      getControls()[rowIndex].valid
                    "
                    class="pw-i-24 pw-arrow-circle-green-icon-24"
                    [matMenuTriggerFor]="greenMessageMenu"
                  >
                    <mat-menu #greenMessageMenu="matMenu" class="pw-info-menu">
                      <ul class="pw-custom-error-msg pw-custom-error-msg__list">
                        <li>{{ 'pw.foc.focItemsSelected' | translate }}</li>
                      </ul>
                    </mat-menu></mat-icon
                  >
                  <mat-icon
                    *ngIf="
                      form &&
                      form.touched &&
                      form.controls?.parentForm &&
                      getControls()[rowIndex] &&
                      getControls()[rowIndex].invalid
                    "
                    class="pw-i-24 pw-error-circle-icon-24"
                    [matMenuTriggerFor]="errorMessageMenu"
                  >
                    <mat-menu #errorMessageMenu="matMenu" class="pw-info-menu">
                      <ul class="pw-custom-error-msg pw-custom-error-msg__list">
                        <li>{{ 'pw.foc.pleaseSelectFocItems' | translate }}</li>
                      </ul>
                    </mat-menu></mat-icon
                  >
                </button>
              </div>
            </div>
          </mat-list-option>
        </mat-selection-list>
      </div>
      <div class="col-lg-9 col-9">
        <ng-container *ngFor="let focScheme of focData; let rowIndex = index">
          <div [ngClass]="{ hidden: tabIndex != rowIndex }">
            <div
              input
              disabled
              class="pw-single-bordered-input pw-confirmation-box__item pw-confirmation-box__input border-bottom"
            >
              <div class="row pw-chip-container-height">
                <mat-chip-list class="col-auto pw-chip-box" selectable="false">
                  <!-- <span *ngFor="let item of focScheme.purchaseItems">
                    <span *ngFor="let code of item.focItemDetails">
                      <mat-chip disableRipple>{{ code.itemCode }}</mat-chip>
                    </span>
                  </span> -->
                  <span
                    *ngFor="
                      let item of getPurchaseItems(focScheme.purchaseItems)
                    "
                  >
                    <mat-chip disableRipple>{{ item }}</mat-chip>
                  </span>
                </mat-chip-list>
              </div>
            </div>

            <poss-web-add-foc-popup-item
              [focScheme]="focScheme"
              [parentForm]="form.controls.parentForm"
              [resetEvent]="resetForm$.asObservable()"
            ></poss-web-add-foc-popup-item>
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <div class="pw-confirmation-box__footer mt-2">
    <div class="row pw-confirmation-box__footer-border no-gutters">
      <div class="col-4 mr-auto pw-confirmation-box__footer-item">
        <poss-web-select-dropdown
          [control]="form.get('rsoName')"
          [placeholder]="'pw.conversion.selectRsoText' | translate"
          [options]="rsoNamesArray"
          [required]="true"
        >
        </poss-web-select-dropdown>
      </div>
      <div
        class="col-auto pw-confirmation-box__footer-item"
        *ngIf="hasPendingFlow"
      >
        <button class="pw-btn pw-primary-btn" (click)="keepFocPending()">
          {{ 'pw.foc.keepFocPending' | translate }}
        </button>
      </div>
      <div
        class="col-auto pw-confirmation-box__footer-item"
        *ngIf="!hasPendingFlow"
      >
        <button class="pw-btn pw-primary-btn" (click)="reset()">
          {{ 'pw.foc.reset' | translate }}
        </button>
      </div>

      <div class="col-auto pw-confirmation-box__footer-item">
        <button class="pw-btn pw-accent-btn" (click)="addFoc()">
          {{ 'pw.foc.addFoc' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>
