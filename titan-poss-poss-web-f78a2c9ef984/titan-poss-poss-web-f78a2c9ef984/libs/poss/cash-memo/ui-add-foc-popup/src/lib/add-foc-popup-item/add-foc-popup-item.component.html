<div class="container">
  <form [formGroup]="itemForm" autocomplete="off">
    <ng-container formArrayName="inventoryFocItemList">
      <mat-table
        [dataSource]="getFocItemDetails.controls"
        class="pw-mat-table pw-foc-table"
      >
        <!--- Note that these columns can be defined in any order.
            The actual rendered columns are set as a property on the row definition" -->

        <!-- checkbox Column -->
        <ng-container matColumnDef="isSelected">
          <mat-header-cell
            *matHeaderCellDef
            class="pw-mat-table__item pw-cell-width-5"
          >
          </mat-header-cell>
          <mat-cell
            class="pw-mat-table__item pw-cell-width-5"
            *matCellDef="let element; let index = index"
            [formGroupName]="index"
          >
            <mat-checkbox [checked]="true" formControlName="isSelected">
            </mat-checkbox>
          </mat-cell>
        </ng-container>

        <!--VariantCodeColumn -->
        <ng-container matColumnDef="itemCode">
          <mat-header-cell
            *matHeaderCellDef
            class="pw-mat-table__item pw-cell-width-27"
          >
            FOC Variant Code
          </mat-header-cell>
          <mat-cell
            class="pw-mat-table__item pw-cell-width-27"
            *matCellDef="let element; let index = index"
            [formGroupName]="index"
          >
            <div>
              <div>
                <input matInput formControlName="itemCode" readonly />
              </div>

              <div class="pw-tertiary-color">
                (Qty :
                {{
                  itemForm.controls.inventoryFocItemList.value[index]
                    .availableQuantity
                }})
              </div>
            </div>
          </mat-cell>
        </ng-container>

        <!-- Qty Column -->
        <ng-container matColumnDef="quantity">
          <mat-header-cell
            *matHeaderCellDef
            class="pw-mat-table__item pw-cell-width-15"
          >
            Qty.
          </mat-header-cell>
          <mat-cell
            class="pw-mat-table__item pw-cell-width-15"
            *matCellDef="let element; let index = index"
            [formGroupName]="index"
          >
            <div class="pw-fourth-color">
              <input matInput type="number" formControlName="quantity" />

              <span
                *ngIf="
                  element.get('quantity').errors &&
                  element.get('quantity').errors.errorArray
                "
              >
                <poss-web-error-info-tooltip
                  [errorMessage]="element.get('quantity').errors.errorArray"
                ></poss-web-error-info-tooltip>
              </span>
            </div>
          </mat-cell>
        </ng-container>

        <!-- Lot No Column -->
        <ng-container matColumnDef="lotNumber">
          <mat-header-cell
            *matHeaderCellDef
            class="pw-mat-table__item pw-cell-width-20"
          >
            Lot No.
          </mat-header-cell>
          <mat-cell
            class="pw-mat-table__item pw-cell-width-20"
            *matCellDef="let element; let index = index"
            [formGroupName]="index"
          >
            <input matInput formControlName="lotNumber" readonly />
          </mat-cell>
        </ng-container>

        <!-- Unit Wt Column -->
        <ng-container matColumnDef="unitWeight">
          <mat-header-cell
            *matHeaderCellDef
            class="pw-mat-table__item pw-cell-width-15"
          >
            Unit Wt.
          </mat-header-cell>
          <mat-cell
            class="pw-mat-table__item pw-cell-width-15"
            *matCellDef="let element; let index = index"
            [formGroupName]="index"
          >
            <input
              matInput
              formControlName="unitWeight"
              type="number"
              possWebWeightInput
              readonly
            />
          </mat-cell>
        </ng-container>

        <!--Selected Wt Column -->
        <ng-container matColumnDef="selectedWt">
          <mat-header-cell
            *matHeaderCellDef
            class="pw-mat-table__item pw-cell-width-18"
          >
            Selected Wt
          </mat-header-cell>
          <mat-cell
            class="pw-mat-table__item pw-cell-width-18"
            *matCellDef="let element; let index = index"
            [formGroupName]="index"
          >
            <input
              matInput
              formControlName="actualWeight"
              type="number"
              possWebWeightInput
              readonly
            />
          </mat-cell>
        </ng-container>
        <!-- -->
        <mat-header-row
          class="pw-mat-table__header"
          *matHeaderRowDef="displayedColumns; sticky: true"
        ></mat-header-row>
        <mat-row
          *matRowDef="let row; columns: displayedColumns"
          class="pw-mat-table__body-row"
        ></mat-row>
      </mat-table>
    </ng-container>
  </form>
  <div
    *ngIf="type === 'weight'"
    class="d-flex justify-content-between pw-mat-table__header align-items-center px-2 pw-mat-table_footer"
  >
    <span>
      <p class="pw-tertiary-color">Total FOC Eligible Wt.</p>
      <div>
        <p>
          {{
            weightFormatter.format(itemForm.get('otherFocDetails').value.weight)
          }}
          (gms)
        </p>
      </div>
    </span>

    <span>
      <p class="pw-tertiary-color">FOC Scheme Name</p>
      <div>
        <p>{{ this.focScheme.schemeName }}</p>
      </div>
    </span>

    <span>
      <p class="pw-tertiary-color">Total Selected FOC Wt.</p>
      <div>
        <p>{{ weightFormatter.format(totalIssueFocWt) }} (gms)</p>
      </div>
    </span>
  </div>

  <div
    *ngIf="type !== 'weight'"
    class="d-flex justify-content-between pw-mat-table__header align-items-center px-2 pw-mat-table_footer"
  >
    <span>
      <p class="pw-tertiary-color">Total FOC Eligible Qty.</p>
      <div>
        <p>
          {{ itemForm.get('otherFocDetails').value.quantity }}
        </p>
      </div>
    </span>
    <span>
      <p class="pw-tertiary-color">FOC Scheme</p>
      <div>
        <p>{{ this.focScheme.schemeName }}</p>
      </div>
    </span>
    <span>
      <p class="pw-tertiary-color">Total SelectedFOC Qty.</p>
      <div>
        <p>{{ totalIssueFocQty }}</p>
      </div>
    </span>
  </div>
  <div
    class="pw-error-color mt-1"
    *ngIf="itemForm && itemForm.touched && itemForm.invalid"
  >
    <p *ngIf="type === 'weight'">
      <button
        mat-mini-fab
        class="pw-error-mini-btn mr-1"
        type="button"
      ></button>
      Eligible FOC weight and selected FOC weight are not matching
    </p>
    <p *ngIf="type !== 'weight'">
      <button
        mat-mini-fab
        class="pw-error-mini-btn mr-1"
        type="button"
      ></button>
      Eligible FOC quantity and selected FOC quantity are not matching
    </p>
  </div>
</div>
