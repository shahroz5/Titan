<div class="container-fluid">
  <div class="row">
    <div class="col-12 col-lg-1"></div>
    <div class="col-12 col-lg-10 m-auto">
      <div class="pw-top-heading-container">
        <div class="row pw-top-heading-container__item">
          <div class="col-auto">
            <div class="pw-top-heading-container__main-head">
              <a (click)="back()">
                <span
                  class="pw-i-24 pw-back-arrow-icon-24 pw-back-arrow-position-middle"
                ></span>
              </a>
              <span class="pw-i-32 pw-cash-memo-icon-32"></span>
              <div class="pw-top-heading-container__heading">
                {{ 'pw.creditNote.creditNoteHeaderLabel' | translate }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="pw-tab mt-4">
        <ul class="pw-tab__list">
          <li class="pw-tab__list-item">
            <a
              (click)="tab(CNSearchEnumRef.CN_ACTIVITY)"
              [class.pw-is-active-bar]="tabType === CNSearchEnumRef.CN_ACTIVITY"
            >
              <h5 class="pw-tab__item">
                {{ 'pw.creditNote.cnActivityLabel' | translate }}
              </h5>
            </a>
          </li>
          <li class="pw-tab__list-item">
            <a
              (click)="tab(CNSearchEnumRef.SENT_REQUESTS)"
              [class.pw-is-active-bar]="
                tabType === CNSearchEnumRef.SENT_REQUESTS
              "
            >
              <h5 class="pw-tab__item">
                {{ 'pw.creditNote.sentRequestsLabel' | translate }}
                <span class="pw-fourth-color">({{ count }})</span>
              </h5></a
            >
          </li>

          <li class="pw-tab__list-item">
            <a
              (click)="tab(CNSearchEnumRef.EGHS_TRANSFER)"
              [class.pw-is-active-bar]="
                tabType === CNSearchEnumRef.EGHS_TRANSFER
              "
            >
              <h5 class="pw-tab__item">
                e-GHS Transfer
                <span class="pw-fourth-color"
                  >({{ transferedCNs ? transferedCNs?.length : 0 }})</span
                >
              </h5></a
            >
          </li>
        </ul>
      </div>
      <div *ngIf="tabType === CNSearchEnumRef.CN_ACTIVITY">
        <poss-web-cn-search-result-list
          [searchResult]="creditNoteSearchResult"
          (cnDetails)="cnDetails($event)"
          [count]="totalElements$ | async"
          [pageEvent]="searchPageEvent"
          [pageSizeOptions]="pageSizeOptions"
          [searchData]="searchData"
          [currentFiscalYear]="currentFiscalYear"
          (emitPaginator)="paginate($event)"
          [minPageSize]="minPageSize"
          (emitSearch)="search($event)"
          (onSearchChange)="onSearchChange()"
          [businessDay] = "businessDay"
        ></poss-web-cn-search-result-list>
      </div>
      <div [hidden]="tabType !== CNSearchEnumRef.SENT_REQUESTS">
        <div class="row align-items-end" [formGroup]="sentRequestFormGroup">
          <mat-form-field class="col-lg-3 col-4 ml-auto" floatLabel="never">
            <input
              #searchBox
              id="searchBox"
              matInput
              class="pw-input-box"
              formControlName="cnNumber"
              placeholder="{{
                'pw.creditNote.searchByRequestNumberLabel' | translate
              }}"
            />
            <mat-icon matSuffix>
              <span
                *ngIf="!sentRequestFormGroup.get('cnNumber').value"
                class="pw-i-16 pw-search-icon-16"
              ></span
            ></mat-icon>
            <mat-icon matSuffix (click)="clearSearch()">
              <span
                *ngIf="sentRequestFormGroup.get('cnNumber').value"
                class="pw-i-10 pw-close-icon-16"
              ></span
            ></mat-icon>
          </mat-form-field>

          <mat-form-field class="col-lg-3 col-3" floatLabel="never">
            <input
              #fiscalYearSearchBox
              id="fiscalYearSearchBox"
              matInput
              class="pw-input-box"
              formControlName="fiscalYear"
              placeholder="{{
                'pw.creditNote.searchByFiscalYearLabel' | translate
              }}"
            />
            <mat-icon matSuffix>
              <span
                *ngIf="!sentRequestFormGroup.get('fiscalYear').value"
                class="pw-i-16 pw-search-icon-16"
              ></span
            ></mat-icon>
            <mat-icon matSuffix (click)="clearFiscalYearSearch()">
              <span
                *ngIf="sentRequestFormGroup.get('fiscalYear').value"
                class="pw-i-10 pw-close-icon-16"
              ></span
            ></mat-icon>
            <mat-error
              *ngIf="
                sentRequestFormGroup.get('fiscalYear').errors &&
                sentRequestFormGroup.get('fiscalYear').errors.errorArray
              "
            >
              <poss-web-error-info-tooltip
                [errorMessage]="
                  sentRequestFormGroup.get('fiscalYear').errors.errorArray
                "
              ></poss-web-error-info-tooltip>
            </mat-error>
          </mat-form-field>
          <poss-web-select-dropdown
            class="col-lg-2 col-3"
            [placeholder]="'pw.creditNote.requestTypeLabel' | translate"
            [control]="sentRequestFormGroup.get('requestType')"
            (selectionChange)="selectionChange($event.value)"
            [options]="requestTypes"
            [required]="true"
          >
          </poss-web-select-dropdown>
        </div>

        <poss-web-card-list
          *ngIf="sentRequests && !invalidSearch"
          [count]="count"
          [dataList]="
            (isLoading$ | async) === false && (hasSearched$ | async) === false
              ? (sentRequests$ | async)
              : (searchRequests$ | async)
          "
          [pageSize]="pageSize"
          (loadMore)="loadRequests($event)"
          (selected)="onSelected($event)"
        >
          <ng-template let-item="data">
            <poss-web-card-title>
              <div class="row">
                <div class="col-5 pw-grid-card__label">
                  <h4>{{ item.docNo }}</h4>
                </div>
                <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">
                  -
                </p>
                <h4 class="col pw-tertiary-color">{{ item?.fiscalYear }}</h4>
              </div>

              <div class="col-auto ml-auto"></div>
            </poss-web-card-title>

            <poss-web-card-content>
              <div class="row pw-grid-card__content">
                <p class="col-5 pw-grid-card__label">
                  {{ 'pw.creditNote.cnTypeLabel' | translate }}
                </p>
                <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">
                  :
                </p>
                <p class="col">{{ item?.cnType }}</p>
              </div>
              <div class="row pw-grid-card__content">
                <p class="col-5 pw-grid-card__label">CN Number</p>
                <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">
                  :
                </p>
                <p class="col">{{ item?.cnNumber }}</p>
              </div>
              <div class="row pw-grid-card__content">
                <p class="col-5 pw-grid-card__label">
                  {{ 'pw.creditNote.cnAmountLabel' | translate }}
                </p>
                <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">
                  :
                </p>
                <p class="col">{{ item?.amount | currencyFormatter }}</p>
              </div>
              <div class="row pw-grid-card__content">
                <p class="col-5 pw-grid-card__label">
                  {{ 'pw.creditNote.customerNameLabel' | translate }}
                </p>
                <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">
                  :
                </p>
                <p class="col">
                  {{ item?.custName }}
                </p>
              </div>
              <div class="row pw-grid-card__content">
                <p class="col-5 pw-grid-card__label">
                  {{ 'pw.creditNote.reqDateLabel' | translate }}
                </p>
                <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">
                  :
                </p>
                <p class="col">{{ item?.reqDate | dateFormatter }}</p>
              </div>
              <div class="mt-1">
                <p [ngClass]="getStatusColor(item.status ? item.status : '')">
                  {{ item.status }}
                </p>
              </div>
            </poss-web-card-content>
          </ng-template>
        </poss-web-card-list>

        <div
          *ngIf="
            ((isLoading$ | async) === false &&
              tabType === CNSearchEnumRef.SENT_REQUESTS &&
              (searchRequests$ | async)?.length == 0 &&
              (hasSearched$ | async) === true) ||
            invalidSearch
          "
          class="pw-message pw-text-center mg-t-100"
        >
          <h3 class="m-auto">
            {{ noDataFoundMessage }}
          </h3>
        </div>
        <div
          *ngIf="
            (isLoading$ | async) === false &&
            (sentRequests$ | async)?.length == 0 &&
            (hasSearched$ | async) === false
          "
          class="pw-message pw-text-center mg-t-100"
        >
          <h3 class="m-auto">
            {{ 'pw.creditNote.noRecordsFoundLabel' | translate }}
          </h3>
        </div>
      </div>

      <div [hidden]="tabType !== CNSearchEnumRef.EGHS_TRANSFER">


        <poss-web-card-list
          *ngIf="transferedCNs && !invalidSearch"
          [count]="transferedCNsCount"
          [dataList]="
            (isLoading$ | async) === false && (hasSearched$ | async) === false
              ? (transferedCNs$ | async)
              : (searchTransferedCN$ | async)
          "
          [pageSize]="pageSize"
          (loadMore)="loadTransferedCNs($event)"
          (selected)="onSelected($event)"
        >
          <ng-template let-item="data">
            <poss-web-card-title>
              <div class="row">
                <div class="col-5 pw-grid-card__label">
                  <h4>{{ item.docNo }}</h4>
                </div>
                <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">
                  -
                </p>
                <h4 class="col pw-tertiary-color">{{ item?.fiscalYear }}</h4>
              </div>

              <div class="col-auto ml-auto"></div>
            </poss-web-card-title>

            <poss-web-card-content>
              <div class="row pw-grid-card__content">
                <p class="col-5 pw-grid-card__label">
                  {{ 'pw.creditNote.cnTypeLabel' | translate }}
                </p>
                <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">
                  :
                </p>
                <p class="col">{{ item?.creditNoteType }}</p>
              </div>
              <div class="row pw-grid-card__content">
                <p class="col-5 pw-grid-card__label">
                  {{ 'pw.creditNote.cnAmountLabel' | translate }}
                </p>
                <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">
                  :
                </p>
                <p class="col">{{ item?.amount | currencyFormatter }}</p>
              </div>
              <div class="row pw-grid-card__content">
                <p class="col-5 pw-grid-card__label">
                  {{ 'pw.creditNote.customerNameLabel' | translate }}
                </p>
                <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">
                  :
                </p>
                <p class="col">
                  {{ item?.customerName }}
                </p>
              </div>
              <div class="mt-1">
                <p [ngClass]="getStatusColor(item ? item?.status : '')">
                  {{ item?.status }}
                </p>
              </div>
            </poss-web-card-content>
          </ng-template>
        </poss-web-card-list>

        <div
          *ngIf="
            (isLoading$ | async) === false &&
            eghsSearchErrorcode === 'ERR-INT-041'
          "
          class="pw-message pw-text-center mg-t-100"
        >
          <h3 class="m-auto">
            {{ 'pw.creditNote.noRecordsFoundLabel' | translate }}
          </h3>
        </div>
      </div>
      <poss-web-loader *ngIf="isLoading$ | async"></poss-web-loader>
      <div class="pw-grid-card">
        <div class="row"></div>
      </div>
    </div>
    <div class="col-12 col-lg-1"></div>
  </div>
</div>
