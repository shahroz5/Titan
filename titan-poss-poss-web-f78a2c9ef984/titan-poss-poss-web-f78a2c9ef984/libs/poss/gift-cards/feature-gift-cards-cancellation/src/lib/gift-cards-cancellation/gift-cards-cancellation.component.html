<div class="pw-detail-card" *ngIf="isGcCancellationAllowed">
  <div class="pw-detail-card__heading">
    {{ 'pw.giftCards.giftCardDetails' | translate }}
  </div>
  <div class="row pw-detail-card__flex-end" [formGroup]="gcCancellationForm">
    <mat-form-field class="col-lg-2 col-3" [floatLabel]="'auto'">
      <mat-label>{{
        'pw.giftCards.mobileNumberPlaceholder' | translate
      }}</mat-label>
      <input
        matInput
        class="pw-single-bordered-input"
        formControlName="mobileNumber"
        maxLength="10"
        type="tel"
        autocomplete="off"
      />
      <mat-error
        *ngIf="
          gcCancellationForm.get('mobileNumber').errors &&
          gcCancellationForm.get('mobileNumber').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="
            gcCancellationForm.get('mobileNumber').errors.errorArray
          "
        >
        </poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>
    <mat-form-field class="col-lg-2 col-3" [floatLabel]="'auto'">
      <mat-label>{{
        'pw.giftCards.cmNumberPlaceholder' | translate
      }}</mat-label>
      <input
        matInput
        class="pw-single-bordered-input"
        formControlName="cmNumber"
        type="text"
        autocomplete="off"
      />
      <mat-error
        *ngIf="
          gcCancellationForm.get('cmNumber').errors &&
          gcCancellationForm.get('cmNumber').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="gcCancellationForm.get('cmNumber').errors.errorArray"
        >
        </poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>
    <div class="col-auto pw-detail-card__right-container">
      <button
        (click)="searchGcCashMemo()"
        mat-flat-button
        class="pw-btn pw-accent-btn"
        [disabled]="
          gcCancellationForm.invalid ||
          (!gcCancellationForm.get('mobileNumber').value &&
            !gcCancellationForm.get('cmNumber').value)
        "
      >
        {{ 'pw.giftCards.search' | translate }}
      </button>
    </div>
  </div>
  <div class="pw-detail-card__secondary-section" *ngIf="gcCmDetails">
    <div class="row">
      <div class="col-auto">
        <div class="pw-detail-card__label">
          {{ 'pw.giftCards.invoicedAt' | translate }}
        </div>
        <div class="pw-font-weight-bold">
          {{ invoicedTime ? invoicedTime : '--:--' }}
        </div>
      </div>
      <div class="col-auto">
        <div class="pw-detail-card__label">
          {{ 'pw.giftCards.cmNumber' | translate }}
        </div>
        <div class="pw-font-weight-bold">
          {{ gcCmDetails?.docNo ? gcCmDetails?.docNo : '-' }}
        </div>
      </div>

      <poss-web-gift-cards-cancellation-reasons
        class="col-lg-3 col-3 pw_top"
        [reasons]="cancellationReasons"
        (selectedCancellationReason)="setSelectedCancellationReason($event)"
        [clearSelectedCancellationReason]="clearSelectedCancellationReason"
      >
      </poss-web-gift-cards-cancellation-reasons>

      <poss-web-ui-rso-name
        class="col-lg-2 col-3 pw_top"
        [selectedRso]="selectedRsoName"
        [rsoNamesList]="rsoNamesList"
        (selectedRSOName)="setSelectedRSOName($event)"
        [clearSelectedRsoName]="clearSelectedRsoName"
        [isDisable]="true"
      >
      </poss-web-ui-rso-name>
    </div>
  </div>
</div>

<div class="pw-detail-card" *ngIf="gcCmDetails && isGcCancellationAllowed">
  <div class="row">
    <div class="col-lg-12">
      <poss-web-ag-gift-cards-grid
        [giftCardEvent]="giftCardObservable$"
        [clearAllEvent]="clearAllDataObservable$"
        [operationType]="giftCardsTypesEnum?.GIFTCARD_CANCELLATION"
      >
      </poss-web-ag-gift-cards-grid>
    </div>
  </div>
</div>

<ng-template #cancellationSuccessNotificationTemplate>
  <div class="pw-text-center">
    <h3
      class="pw-success-color"
      *ngIf="
        gcCashMemoCancelResponse?.cndocNos &&
        gcCashMemoCancelResponse?.cndocNos?.length > 0
      "
    >
      {{ 'pw.giftCards.giftCardCancellationWithCnSuccessMessage' | translate }}
    </h3>
    <h3
      class="pw-success-color"
      *ngIf="
        gcCashMemoCancelResponse?.cndocNos &&
        gcCashMemoCancelResponse?.cndocNos?.length === 0
      "
    >
      {{ 'pw.giftCards.giftCardCancellationSuccessMessage' | translate }}
    </h3>
    <br />
    <div class="pw-black-popup-box__margin-top-10">
      {{ 'pw.giftCards.cancellationDocNo' | translate }} :
      {{ gcCashMemoCancelResponse?.docNo }}
    </div>
    <br />
    <div
      class="pw-black-popup-box__margin-top-10"
      *ngIf="
        gcCashMemoCancelResponse?.cndocNos
      "
    >
      {{ 'pw.giftCards.cnNo' | translate }} :
      {{ cnDocNo}}
    </div>
    <h4 class="pw-success-color pw-pointer" (click)="print()">
      <span class="pw-i-16 pw-download-icon-16 pw-print"></span>Print
    </h4>
  </div>
</ng-template>

<poss-web-loader *ngIf="(isLoading$ | async) ||
(printingService.getPrinterIsLoading() | async)"></poss-web-loader>
