<div class="pw-detail-card pw-shadow">
  <div class="pw-detail-card__heading">
    {{ 'pw.grn.cmDetails' | translate }}
  </div>
  <div class="row pw-detail-card__flex-end">
    <div class="col-2">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.boutiqueCode' | translate }}
      </div>
      <div class="pw-font-weight-bold">{{ grnDetails?.boutiqueCode }}</div>
    </div>

    <div class="col-lg-2 col-2 align-self-center">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.boutiqueName' | translate }}
      </div>
      <div class="pw-font-weight-bold">{{ boutiqueName }}</div>
    </div>

    <div class="col-2 pw-detail-card__margin-top">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.fiscalYear' | translate }}
      </div>
      <div class="pw-font-weight-bold">{{ grnDetails?.fiscalYear }}</div>
    </div>
    <div class="col-lg-2 col-2 align-self-center">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.cmNumber' | translate }}
      </div>
      <div class="pw-font-weight-bold">{{ grnDetails?.cmNumber }}</div>
    </div>
    <div class="col-lg-2 col-2 align-self-center" *ngIf="grnDetails?.cnDocDetails">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.creditNoteNumber' | translate }}
      </div>
      <div class="pw-font-weight-bold" *ngFor="let cnDocNo of grnDetails?.cnDocDetails | keyvalue">
        {{ cnDocNo.value }}
      </div>
    </div>
    <div class="col-lg-2 col-2">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.statusLabel' | translate }}
      </div>
      <div [ngClass]="getRequestStatusColor(grnDetails?.status ? grnDetails?.status : '')"> 
        {{
          grnDetails?.status ? grnDetails?.status : '-'
        }}
      </div>
    </div>
  </div>
  <div class="row pw-detail-card__secondary-section">
    <div class="col-lg-2 col-2">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.cmDate' | translate }}
      </div>
      <div class="pw-font-weight-bold">
        {{ grnDetails?.cmDate | dateFormatter }}
      </div>
    </div>
    <div class="col-lg-2 col-2">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.invoicedGoldRate' | translate }}
      </div>
      <div class="pw-font-weight-bold">
        {{
          (grnDetails?.invoicedGoldRate ? grnDetails?.invoicedGoldRate : 0)
            | currencyFormatter: currencyCode
        }}/
        {{ 'pw.grn.gmLabel' | translate }}
      </div>
    </div>
    <div class="col-lg-2 col-2">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.invoicedPlatinumRate' | translate }}
      </div>
      <div class="pw-font-weight-bold">
        {{
          (grnDetails?.invoicedPlatinumRate
            ? grnDetails?.invoicedPlatinumRate
            : 0
          ) | currencyFormatter: currencyCode
        }}/{{ 'pw.grn.gmLabel' | translate }}
      </div>
    </div>
    <div class="col-lg-2 col-2">
      <div class="pw-detail-card__label">
        {{ 'pw.grnRequestApproval.withCmGoldRate' | translate }}
      </div>
      <div class="pw-font-weight-bold pw-text-center pt-2">
        <mat-checkbox
          [checked]="grnDetails?.isCmGoldRate ? grnDetails?.isCmGoldRate : false"
          [disabled]="true"
        >
        </mat-checkbox>
      </div>
    </div>
    <div class="col-lg-2 col-2">
      <div class="pw-detail-card__label">
        {{ 'pw.grnRequestApproval.currentGoldRate' | translate }}
      </div>
      <div class="pw-font-weight-bold pw-text-center pt-2">
        <mat-checkbox
          [checked]="grnDetails?.isCmGoldRate ? false : true"
          [disabled]="true"
        >
        </mat-checkbox>
      </div>
    </div>
  </div>
</div>

<poss-web-product-view
  [isGRN]="isGRN"
  [productDetails$]="productDetails$.asObservable()"
  [imageUrlData$]="imageUrlData$.asObservable()"
  [pgDesc$]="pgDesc$"
  (loadImageUrl)="loadImageUrl($event)"
  [rsoNames]="rsoDetails$ | async"
  [isLegacy]="isLegacy"
></poss-web-product-view>

<div class="pw-detail-card pw-shadow">
  <div class="pw-detail-card__heading">
    {{ 'pw.grn.grnAndApprovalDetails' | translate }}
  </div>

  <div class="row">
    <div class="col-lg-2 col-2">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.cmNetAmount' | translate }}
      </div>
      <div class="pw-font-weight-bold">
        {{ grnDetails?.cmNetAmount | currencyFormatter: currencyCode }}
      </div>
    </div>
    <div class="col-lg-2 col-2">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.otherCharges' | translate }}
      </div>
      <div class="pw-font-weight-bold">
        {{ grnDetails?.otherCharges | currencyFormatter: currencyCode }}
      </div>
    </div>
    <div class="col-lg-2 col-2" *ngIf="grnDetails?.txnSource === 'LEGACY'; else napCashmemo">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.encirclePoints' | translate }}
      </div>
      <div class="pw-font-weight-bold">
        {{ grnDetails?.encirclePoints }}
      </div>
    </div>
    <ng-template #napCashmemo>
      <div class="col-lg-2 col-2">
        <div class="pw-detail-card__label">
          {{ 'pw.grn.encirclePoints' | translate }}
        </div>
        <div class="pw-font-weight-bold">
          {{ grnDetails?.loyaltyPoints }}
        </div>
      </div>
    </ng-template>
    <div class="col-lg-2 col-2">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.tcsTobeRefund' | translate }}
      </div>
      <div class="pw-font-weight-bold">
        <div class="pw-font-weight-bold">
          {{ tcsCollectedAmount | currencyFormatter: currencyCode }}
        </div>
      </div>
    </div>
    <div class="col-lg-2 col-2">
      <div class="pw-detail-card__label">
        {{ 'pw.grn.focRecoveredValue' | translate }}
      </div>
      <div class="pw-font-weight-bold">
        {{
          (focDeductionValue ? focDeductionValue : 0)
            | currencyFormatter: currencyCode
        }}
      </div>
    </div>
  </div>
  <div class="pw-detail-card__secondary-section" *ngIf="isProcessId">
    <div class="pw-font-weight-bold">
      {{ grnDetails?.grnType }}
      <span *ngIf="grnDetails?.reasonForCancellation" class="pw-tertiary-color"
        >( {{ grnDetails?.reasonForCancellation }})</span
      >
    </div>
    <div class="row pw-detail-card__margin-top">
      <div class="col-lg-3 col-3">
        <div class="pw-detail-card__label">
          {{ 'pw.grn.approver' | translate }}
        </div>
        <div class="pw-font-weight-bold">{{ grnDetails?.approver }}</div>
      </div>
      <div class="col-lg-2 col-2">
        <div class="pw-detail-card__label">
          {{ 'pw.grn.reason' | translate }}
        </div>
        <div class="pw-font-weight-bold">{{ grnDetails?.reason }}</div>
      </div>
      <div class="col-lg-3 col-3">
        <div class="pw-detail-card__label">
          {{ 'pw.grn.time' | translate }}
        </div>
        <div class="pw-font-weight-bold">{{ grnDetails?.time }}</div>
      </div>
      <div class="col-lg-3 col-3">
        <div class="pw-detail-card__label">
          {{ 'pw.grn.approvalStatusLabel' | translate }}
        </div>
        <div
          [ngClass]="
            grnDetails?.approvalStatus === grnEnums.APPROVED
              ? 'pw-success-color'
              : '' || grnDetails?.approvalStatus === grnEnums.PENDING
              ? 'pw-warning-color'
              : '' || grnDetails?.approvalStatus === grnEnums.REJECTED
              ? 'pw-error-color'
              : '' || grnDetails?.approvalStatus === grnEnums.CLOSED
              ? 'pw-error-color'
              : '' || grnDetails?.approvalStatus === grnEnums.CANCELLED
              ? 'pw-error-color'
              : ''
          "
        >
          {{ grnDetails?.approvalStatus }}
        </div>
      </div>
    </div>
  </div>
</div>

<mat-expansion-panel class="pw-expansion-panel mt-2" *ngIf="isProcessId">
  <mat-expansion-panel-header
    class="pw-expansion-panel__header"
    [collapsedHeight]="'40px'"
    [expandedHeight]="'40px'"
  >
    <mat-panel-title class="pw-expansion-panel__heading">
      {{'pw.grn.grnUploadedDocLabel' | translate}}
    </mat-panel-title>
  </mat-expansion-panel-header>
  <div class="pw-white-overlay-box">
    <poss-web-file-upload-list-items
      [fileList]="filesList"
      (view)="loadFileImageUrl($event)"
      [viewMode]="'true'"
    ></poss-web-file-upload-list-items>
  </div>
</mat-expansion-panel>

<ng-template #confirmSuccessNotificationTemplate>
  <div class="pw-text-center">
    <h3 class="pw-success-color">
      {{ 'pw.grn.grnConfirmMesgNew' | translate }}
    </h3>

    <h5>
      <span class="pw-success-color pt-2">
        {{ 'pw.grn.grnConfirmMesgNew2' | translate }}
      </span>
      <span>{{ cnDocNo }} </span>
      <span class="pw-success-color pt-2"
        >{{ 'pw.grn.amtMsg' | translate }}
      </span>
      <span> {{ cnAmt | currencyFormatter: currencyCode }}</span>
    </h5>

    <h5 *ngIf="tcsCnAmt" class="pt-2">
      <span> {{ 'pw.grn.tcsCnAmt' | translate }}</span
      >:
      {{ tcsCnAmt | currencyFormatter: currencyCode }}
    </h5>

    <h4 class="pw-success-color pw-pointer" (click)="print()">
      <span class="pw-i-16 pw-download-icon-16 pw-print"></span>
      {{ 'pw.advanceBooking.print' | translate }}
    </h4>
  </div>
</ng-template>
<poss-web-loader 
  *ngIf="
    (isLoading$ | async) || (isCommonLoading$ | async)
  ">
</poss-web-loader>
