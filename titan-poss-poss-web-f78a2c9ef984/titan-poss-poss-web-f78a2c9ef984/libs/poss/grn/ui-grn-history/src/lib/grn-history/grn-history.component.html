<form [formGroup]="searchForm" class="pw-detail-card">
  <div class="pw-detail-card__heading">
    {{ 'pw.grn.grnDetails' | translate }}
  </div>
  <div class="row pw-detail-card__flex-end">
    <mat-form-field class="col-lg-2 col-3">
      <mat-label> {{ 'pw.grn.grnNo' | translate }} </mat-label>
      <input
        formControlName="grnNumber"
        matInput
        type="text"

        class="pw-single-bordered-input"
      />

      <mat-error
        *ngIf="
          searchForm.get('grnNumber').errors &&
          searchForm.get('grnNumber').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="searchForm.get('grnNumber').errors.errorArray"
        ></poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>

    <mat-form-field class="col-lg-2 col-3">
      <mat-label> {{ 'pw.grn.cmNumber' | translate }} </mat-label>
      <input
        formControlName="cmNumber"
        type="text"
        matInput
        class="pw-single-bordered-input"
      />

      <mat-error
        *ngIf="
          searchForm.get('cmNumber').errors &&
          searchForm.get('cmNumber').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="searchForm.get('cmNumber').errors.errorArray"
        ></poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>

    <poss-web-fiscal-year
      class="col-lg-2 col-3"
      [control]="searchForm.get('fiscalYear')"
      [required]="false"
      [currentFiscalYear]="countryFiscalYear"
      [placeHolder]="'pw.creditNote.searchByFiscalYearLabel' | translate"
      [disabled]="false"
    ></poss-web-fiscal-year>

    <mat-form-field class="col-lg-2 col-3">
      <mat-label> {{ cmLocationLabel }} </mat-label>
      <input
        formControlName="cmLocation"
        type="text"
        matInput
        class="pw-single-bordered-input"
      />

      <mat-error
        *ngIf="
          searchForm.get('cmLocation').errors &&
          searchForm.get('cmLocation').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="searchForm.get('cmLocation').errors.errorArray"
        ></poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>

    <mat-form-field class="col-lg-3 col-2">
      <mat-label> {{ 'pw.grn.docDateRangeabel' | translate }} </mat-label>
      <mat-date-range-input [rangePicker]="picker" [max]="currentDate">
        <input
          matStartDate
          formControlName="fromDocDate"
          placeholder="{{ 'pw.grn.fromDocDate' | translate }}"
        />
        <input
          matEndDate
          formControlName="toDocDate"
          placeholder="{{ 'pw.grn.toDocDate' | translate }}"
        />
      </mat-date-range-input>
      <mat-datepicker-toggle matSuffix [for]="picker">
        <mat-icon matDatepickerToggleIcon>
          <span class="pw-i-12 pw-calender-icon-12"></span>
        </mat-icon>
      </mat-datepicker-toggle>
      <mat-date-range-picker #picker></mat-date-range-picker>
      <mat-icon
        *ngIf="
          searchForm.get('fromDocDate').value !== null &&
          searchForm.get('toDocDate').value !== null
        "
        class="pw-pointer"
        matSuffix
        (click)="clearDocRange()"
      >
        <span class="pw-i-10 pw-close-icon-16"></span
      ></mat-icon>

      <mat-error
        *ngIf="
          searchForm.get('fromDocDate').errors &&
          searchForm.get('fromDocDate').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="searchForm.get('fromDocDate').errors.errorArray"
        ></poss-web-error-info-tooltip>
      </mat-error>
      <mat-error
        *ngIf="
          searchForm.get('toDocDate').errors &&
          searchForm.get('toDocDate').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="searchForm.get('toDocDate').errors.errorArray"
        ></poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>

    <poss-web-select-dropdown
      class="col-lg-2 col-3"
      [placeholder]="'pw.acceptAdvance.searchType' | translate"
      [control]="searchForm.get('searchType')"
      [options]="searchTypes"
      [required]="false"
      (selectionChange)="onSearchTypeChanged($event)"
    ></poss-web-select-dropdown>
    <mat-form-field
      class="col-lg-2 col-3"
      [floatLabel]="'auto'"
      *ngIf="showSearchField"
    >
      <mat-label>{{ searchFieldPlaceholder | translate }}</mat-label>
      <input
        matInput
        class="pw-single-bordered-input"
        formControlName="searchField"
        type="text"
        required
        autocomplete="off"
      />
      <mat-error
        *ngIf="
          searchForm.get('searchField').errors &&
          searchForm.get('searchField').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="searchForm.get('searchField').errors.errorArray"
        >
        </poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>

    <div class="col-auto pw-detail-card__right-container">
      <button
        class="pw-btn pw-accent-btn"
        [disabled]="!searchForm.valid"
        (click)="search()"
      >
        {{ 'pw.grn.searchLabel' | translate }}
      </button>
    </div>
  </div>
</form>
<poss-web-top-info-panel
  *ngIf="isFocusing && focusedHeaderName"
  [isFocusing]="isFocusing"
  [focusedHeaderName]="focusedHeaderName"
  [currentRowData]="currentRowInfo"
>
</poss-web-top-info-panel>
<ag-grid-angular
  class="pw-titan-poss-theme pw-ag-grid-table"
  [columnDefs]="columnDefs"
  [rowHeight]="rowHeight"
  [rowData]="grnHistory"
  [animateRows]="animateRows"
  [domLayout]="domLayout"
  [defaultColDef]="defaultColDef"
  (cellFocused)="onCellFocused($event)"
  (cellClicked)="onCellClicked($event)"
  (focusout)="focusOut($event)"
></ag-grid-angular>

<mat-paginator
  class="pw-paginator"
  *ngIf="
    totalGrnHistoryReq > minPageSize &&
    grnHistory.length > 0 &&
    totalGrnHistoryReq != 1
  "
  [length]="totalGrnHistoryReq"
  [pageSize]="pageEvent.pageSize"
  [pageIndex]="pageEvent.pageIndex"
  showFirstLastButtons
  [pageSizeOptions]="pageSizeOptions"
  (page)="paginator.emit($event)"
>
</mat-paginator>
