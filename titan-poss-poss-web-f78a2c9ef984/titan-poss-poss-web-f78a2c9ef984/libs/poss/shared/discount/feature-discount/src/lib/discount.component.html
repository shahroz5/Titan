<mat-accordion multi>
  <mat-expansion-panel expanded class="pw-expansion-panel">
    <mat-expansion-panel-header
      class="pw-expansion-panel__header"
      [collapsedHeight]="'40px'"
      [expandedHeight]="'40px'"
    >
      <mat-panel-title class="pw-expansion-panel__heading">
        <span
          [matBadgeHidden]="!(transactionType === transactionTypeEnum.CM)"
          [ngClass]="
            transactionType === transactionTypeEnum.CM
              ? 'pw-gold-info-icon'
              : ''
          "
          [matBadge]="getBadgeNumber(subTransactionType)"
          matBadgeOverlap="false"
          [matBadgeColor]="'primary'"
          matBadgePosition="before"
        >
          {{ 'pw.regularCashMemo.discountOfferLabel' | translate }}</span
        >
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="height">
      <div class="row pw-card pw-panel">
        <div class="col-auto pw-card__item ml-auto">
          <button
            [disabled]="!isEnableCalculateDiscount()"
            class="pw-btn pw-primary-btn"
            (click)="calculateDiscount()"
          >
            <span>
              {{
                'pw.discount.calculateGRNDiscount' | translate
              }}</span
            >
          </button>
        </div>
        <div class="col-auto pw-card__item">
          <button
            [disabled]="!enableCalculateRivaahGhsDiscount"
            class="pw-btn pw-primary-btn"
            (click)="calculateRivaahGhsDiscount()"
          >
            <span>
              {{
                'pw.discount.calculateRivaahGhsDiscountLabel' | translate
              }}</span
            >
          </button>
        </div>
        <div class="col-auto pw-card__right-item">
          <button
            #viewButton
            class="pw-btn pw-primary-btn"
            (click)="openViewAllBillLevelDiscountsPopup()"
          >
            <span>
              {{ 'pw.discount.viewBillLevelDiscount' | translate }}</span
            >
          </button>
        </div>

      </div>

      <mat-tab-group
        *ngIf="transactionMode === transactionTypeEnum.CO"
        dynamicHeight
        mat-stretch-tabs
        class="pw-tab pw-discount-tab"
        (selectedTabChange)="onTabChanged($event.index)"
      >
        <mat-tab class="pw-tab__item">
          <ng-template mat-tab-label>
            <span class="pw-tab__label">
              {{ 'pw.discount.coBillLevel' | translate }}
            </span>
          </ng-template>
          <ng-container>
            <poss-web-discount-co-bill-level
              [availableDiscounts]="availabeBillLevelDiscounts$ | async"
              [appliedBillLevelDiscounts]="appliedBillLevelDiscount"
              [cashMemoId]="cashMemoId"
              [resetFormEvent]="resetForm$.asObservable()"
              (applyDiscount)="applyBillLevelDiscount($event)"
            ></poss-web-discount-co-bill-level>
          </ng-container>
        </mat-tab>
      </mat-tab-group>
      <mat-tab-group
        *ngIf="
          transactionMode !== transactionTypeEnum.AB &&
          transactionMode !== transactionTypeEnum.CO
        "
        dynamicHeight
        mat-stretch-tabs
        class="pw-tab pw-discount-tab"
        (selectedTabChange)="onTabChanged($event.index)"
      >
        <mat-tab class="pw-tab__item">
          <ng-template mat-tab-label>
            <span class="pw-tab__label">
              {{ 'pw.discount.billLevel' | translate }}
            </span>
          </ng-template>
          <ng-container>
            <poss-web-discount-bill-level
              [availableDiscounts]="availabeBillLevelDiscounts$ | async"
              [appliedBillLevelDiscounts]="appliedBillLevelDiscount"
              [cashMemoId]="cashMemoId"
              [resetFormEvent]="resetForm$.asObservable()"
              (applyDiscount)="applyBillLevelDiscount($event)"
            ></poss-web-discount-bill-level>
          </ng-container>
        </mat-tab>
        <mat-tab class="pw-tab__item">
          <ng-template mat-tab-label>
            <span class="pw-tab__label">
              {{ 'pw.discount.employee' | translate }}
            </span>
          </ng-template>
          <ng-container>
            <poss-web-discount-employee
              [appliedCouponCode]="appliedEmployeeCouponCode"
              [cashMemoId]="cashMemoId"
              [resetFormEvent]="resetForm$.asObservable()"
              (applyCouponCode)="confirmPopupToApplyEmployeeDiscount($event)"
              (removeCouponCode)="removeAppliedEmployeeDiscount()"
            ></poss-web-discount-employee>
          </ng-container>
        </mat-tab>
        <mat-tab class="pw-tab__item">
          <ng-template mat-tab-label>
            <span class="pw-tab__label">
              {{ 'pw.discount.tataEmployee' | translate }}
            </span>
          </ng-template>
          <ng-container>
            <poss-web-discount-tata-employee
              [tataCompanyList]="tataCompanyList"
              [cashMemoId]="cashMemoId"
              [resetFormEvent]="resetForm$.asObservable()"
              [appliedTataEmployeeDiscountDetails]="
                appliedTataEmployeeDiscountDetails
              "
              (tataEmployeeDiscountPayload)="
                confirmPopupToApplyTataEmployeeDiscount($event)
              "
              (removeTataEmployeeDiscount)="removeAppliedTataEmployeeDiscount()"
            ></poss-web-discount-tata-employee>
          </ng-container>
        </mat-tab>
        <mat-tab class="pw-tab__item">
          <ng-template mat-tab-label>
            <span class="pw-tab__label">
              {{ 'pw.discount.tsss' | translate }}
            </span>
          </ng-template>
          <ng-container>
            <poss-web-discount-tsss
              [appliedCouponCode]="appliedTsssCouponCode"
              [cashMemoId]="cashMemoId"
              (applyCouponCode)="confirmPopupToApplyTsssDiscount($event)"
              (removeCouponCode)="removeAppliedTSSSDiscount()"
              [resetFormEvent]="resetForm$.asObservable()"
            ></poss-web-discount-tsss>
          </ng-container>
        </mat-tab>
        <mat-tab class="pw-tab__item">
          <ng-template mat-tab-label>
            <span class="pw-tab__label">
              {{ 'pw.discount.discountVoucher' | translate }}
            </span>
          </ng-template>
          <poss-web-discount-system-dv
            [cashMemoId]="cashMemoId"
            [availableDvDiscountConfig]="availabeSystemDvDiscounts"
            [appliedDvDiscounts]="appliedSystemDvDiscount$ | async"
            [resetFormEvent]="resetForm$.asObservable()"
            [dateFormat]="dateFormat"
            [isRsoSelected]="isRsoSelected"
            [selectedCustomer]="selectedCustomer"
            (applyDiscount)="loadDiscountVoucherDetails($event)"
            (removeDvDiscount)="removeDvDiscount($event)"
          ></poss-web-discount-system-dv>
        </mat-tab>
        <mat-tab class="pw-tab__item">
          <ng-template mat-tab-label>
            <span class="pw-tab__label">
              {{ 'pw.discount.rivaahCoupon' | translate }}
            </span>
          </ng-template>
          <poss-web-discount-rivaah
            [appliedCouponCode]="appliedRivahCouponCode"
            [cashMemoId]="cashMemoId"
            [resetFormEvent]="resetForm$.asObservable()"
            (applyCouponCode)="applyRivaah($event)"
            (removeCouponCode)="removeAppliedRivaahDiscount()"
          >
          </poss-web-discount-rivaah>
        </mat-tab>
        <mat-tab *ngIf="!isL3Store" class="pw-tab__item">
          <ng-template mat-tab-label>
            <span class="pw-tab__label">
              {{ 'pw.discount.empowerment' | translate }}
            </span>
          </ng-template>
          <ng-container>
            <poss-web-discount-empowerment
              [isEmpowermentDiscountApplied]="appliedEmpowermentDiscountDetails"
              [cashMemoId]="cashMemoId"
              [resetFormEvent]="resetForm$.asObservable()"
              (applyEmpowermentDiscount)="
                confirmPopupToApplyEmpowermentDiscount($event)
              "
              (removeEmpowermentDiscount)="removeAppliedEmpowermentDiscount()"
            ></poss-web-discount-empowerment>
          </ng-container>
        </mat-tab>
      </mat-tab-group>

      <!-- <div *ngIf="transactionMode !== transactionTypeEnum.AB" class="pw-tab">
        <ul #tabRef class="pw-tab__list">
          <li class="pw-tab__list-item">
            <a
              [class.pw-is-active-bar]="discountType === 'BILL_LEVEL'"
              (click)="onTabChanged('BILL_LEVEL')"
            >
              <h5 class="pw-tab__item">
                {{ 'pw.discount.billLevel' | translate }}

                <span
                  class="pw-fourth-color"
                  *ngIf="(appliedBillLevelDiscount$ | async)?.length"
                  >({{ (appliedBillLevelDiscount$ | async)?.length }})</span
                >
              </h5>
            </a>
          </li>
          <li class="pw-tab__list-item">
            <a
              [class.pw-is-active-bar]="discountType === 'EMPLOYEE'"
              (click)="onTabChanged('EMPLOYEE')"
            >
              <h5 class="pw-tab__item">
                {{ 'pw.discount.employee' | translate }}
              </h5>
            </a>
          </li>
          <li class="pw-tab__list-item" *ngIf="!isL3Store">
            <a
              [class.pw-is-active-bar]="discountType === 'EMPOWERMENT'"
              (click)="onTabChanged('EMPOWERMENT')"
            >
              <h5 class="pw-tab__item">
                {{ 'pw.discount.empowerment' | translate }}
              </h5>
            </a>
          </li>
          <li class="pw-tab__list-item">
            <a
              [class.pw-is-active-bar]="discountType === 'TATA_EMPLOYEE'"
              (click)="onTabChanged('TATA_EMPLOYEE')"
            >
              <h5 class="pw-tab__item">
                {{ 'pw.discount.tataEmployee' | translate }}
              </h5>
            </a>
          </li>
          <li class="pw-tab__list-item">
            <a
              [class.pw-is-active-bar]="discountType === 'TSSS'"
              (click)="onTabChanged('TSSS')"
            >
              <h5 class="pw-tab__item">{{ 'pw.discount.tsss' | translate }}</h5>
            </a>
          </li>
          <li class="pw-tab__list-item">
            <a
              [class.pw-is-active-bar]="discountType === 'SYSTEM_DV'"
              (click)="onTabChanged('SYSTEM_DV')"
            >
              <h5 class="pw-tab__item">
                {{ 'pw.discount.discountVoucher' | translate }}
              </h5>
            </a>
          </li>

          <li class="pw-tab__list-item">
            <a
              [class.pw-is-active-bar]="discountType === 'RIVAAH'"
              (click)="onTabChanged('RIVAAH')"
            >
              <h5 class="pw-tab__item">
                {{ 'pw.discount.rivaahCoupon' | translate }}
              </h5>
            </a>
          </li>
        </ul>
        <ng-container>
          <poss-web-discount-bill-level
            [availableDiscounts]="availabeBillLevelDiscounts$ | async"
            [appliedBillLevelDiscounts]="appliedBillLevelDiscount"
            [cashMemoId]="cashMemoId"
            [resetFormEvent]="resetForm$.asObservable()"
            (applyDiscount)="applyBillLevelDiscount($event)"
            *ngIf="discountType === 'BILL_LEVEL'"
          ></poss-web-discount-bill-level>
        </ng-container>

        <ng-container>
          <poss-web-discount-employee
            [appliedCouponCode]="appliedEmployeeCouponCode"
            [cashMemoId]="cashMemoId"
            [resetFormEvent]="resetForm$.asObservable()"
            (applyCouponCode)="confirmPopupToApplyEmployeeDiscount($event)"
            (removeCouponCode)="removeAppliedEmployeeDiscount()"
            *ngIf="discountType === 'EMPLOYEE'"
          ></poss-web-discount-employee>

          <poss-web-discount-rivaah
            [appliedCouponCode]="appliedRivahCouponCode"
            [cashMemoId]="cashMemoId"
            [resetFormEvent]="resetForm$.asObservable()"
            (applyCouponCode)="applyRivaah($event)"
            (removeCouponCode)="removeAppliedRivaahDiscount()"
            *ngIf="discountType === 'RIVAAH'"
          >
          </poss-web-discount-rivaah>
        </ng-container>
        <ng-container>
          <poss-web-discount-empowerment
            *ngIf="discountType === 'EMPOWERMENT'"
            [isEmpowermentDiscountApplied]="appliedEmpowermentDiscountDetails"
            [cashMemoId]="cashMemoId"
            [resetFormEvent]="resetForm$.asObservable()"
            (applyEmpowermentDiscount)="
              confirmPopupToApplyEmpowermentDiscount($event)
            "
            (removeEmpowermentDiscount)="removeAppliedEmpowermentDiscount()"
          ></poss-web-discount-empowerment>
        </ng-container>
        <ng-container>
          <poss-web-discount-tata-employee
            [tataCompanyList]="tataCompanyList"
            [cashMemoId]="cashMemoId"
            [resetFormEvent]="resetForm$.asObservable()"
            [appliedTataEmployeeDiscountDetails]="
              appliedTataEmployeeDiscountDetails
            "
            (tataEmployeeDiscountPayload)="
              confirmPopupToApplyTataEmployeeDiscount($event)
            "
            (removeTataEmployeeDiscount)="removeAppliedTataEmployeeDiscount()"
            *ngIf="discountType === 'TATA_EMPLOYEE'"
          ></poss-web-discount-tata-employee>
        </ng-container>
        <ng-container>
          <poss-web-discount-tsss
            [appliedCouponCode]="appliedTsssCouponCode"
            [cashMemoId]="cashMemoId"
            (applyCouponCode)="confirmPopupToApplyTsssDiscount($event)"
            (removeCouponCode)="removeAppliedTSSSDiscount()"
            [resetFormEvent]="resetForm$.asObservable()"
            *ngIf="discountType === 'TSSS'"
          ></poss-web-discount-tsss>
        </ng-container>
        <poss-web-discount-system-dv
          [cashMemoId]="cashMemoId"
          [availableDvDiscountConfig]="availabeSystemDvDiscounts"
          [appliedDvDiscounts]="appliedSystemDvDiscount$ | async"
          [resetFormEvent]="resetForm$.asObservable()"
          [dateFormat]="dateFormat"
          [isRsoSelected]="isRsoSelected"
          [selectedCustomer]="selectedCustomer"
          (applyDiscount)="loadDiscountVoucherDetails($event)"
          (removeDvDiscount)="removeDvDiscount($event)"
          *ngIf="discountType === 'SYSTEM_DV'"
        ></poss-web-discount-system-dv>
      </div> -->
    </div>
  </mat-expansion-panel>
</mat-accordion>
<poss-web-loader *ngIf="isLoading$ | async"></poss-web-loader>
