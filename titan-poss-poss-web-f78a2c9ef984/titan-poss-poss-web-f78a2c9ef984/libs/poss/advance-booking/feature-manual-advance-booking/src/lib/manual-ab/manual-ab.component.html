<mat-accordion multi>
  <mat-expansion-panel expanded class="pw-expansion-panel">
    <mat-expansion-panel-header
      class="pw-expansion-panel__header"
      [collapsedHeight]="'40px'"
      [expandedHeight]="'40px'"
    >
      <mat-panel-title class="pw-expansion-panel__heading">
        {{ 'pw.advanceBooking.manualAdvanceBooking' | translate }}
      </mat-panel-title>
    </mat-expansion-panel-header>
    <poss-web-manual-form-details
      [txnType]="TransactionTypeEnumRef.AB"
      [detailsFlag$]="detailsFlag$.asObservable()"
      [customerId]="customerId"
      [imageUrl]="imageUrl"
      [manualBillDetails]="manualBillDetails"
      [bussinessDay]="bussinessDay"
      [resetValidationType$]="resetValidationType$.asObservable()"
      (validate)="validateBill($event)"
      (validationType)="validationTypeChange($event)"
      (uploadFileEvent)="uploadFile($event)"
    ></poss-web-manual-form-details>
  </mat-expansion-panel>

  <poss-web-freeze-advance-booking
    aria-disabled="true"
    [advanceBookingDetailsResponse]="manualBillDetails"
    [enableFreeze]="enableFreeze"
    [bgrAllowed]="bgrAllowed"
    [currencyCode]="currencyCode"
    [selectedFOCSchemesCount]="selectedFOCSchemesCount"
    (freeze)="freezeRate($event)"
    (bestRate)="bestRate($event)"
    (prodToBeCollectedByEvent)="prodToBeCollectedBy($event)"
  ></poss-web-freeze-advance-booking>
</mat-accordion>

<poss-web-loader
  *ngIf="
    (isLoading$ | async) ||
    (isLoadingOrder$ | async) ||
    (printingService.getPrinterIsLoading() | async)
  "
>
</poss-web-loader>
<ng-template #confirmSuccessNotificationTemplate>
  <div class="pw-text-center">
    <h3 class="pw-success-color">
      {{ 'pw.advanceBooking.regulariseBillMsg' | translate }}
    </h3>
    <div class="pw-black-popup-box__margin-top-10">
      {{ 'pw.advanceBooking.manualBookingDocNo' | translate }} : {{ docNo }}
    </div>
    <h4 *ngIf="newlyGeneratedCn.length > 0">
      Generated Partial CN Amount of :
      {{ newlyGeneratedCn[0].otherDetails.data.remainingAmount }} ,&nbsp;
      {{ 'pw.regularCashMemo.newCnLabel' | translate }}:
      {{ newlyGeneratedCn[0].otherDetails.data.newCNNumber }}
    </h4>
    <div
      *ngIf="creditnote && creditnote.length > 0"
      class="pw-black-popup-box__margin-top-10"
    >
      {{ 'pw.advanceBooking.CNNO' | translate }} : {{ creditnote }}
    </div>
    <h4 *ngIf="refundAmountAsCash !== 0">
      {{ 'pw.advanceBooking.refundAmountMsg' | translate }} :
      {{ refundAmountAsCash | currencyFormatter: currencyCode }}
    </h4>
    <div class="pw-black-popup-box__margin-top-10">
      <h4 class="pw-success-color pw-pointer" (click)="print()">
        <span class="pw-i-16 pw-download-icon-16 pw-print"></span>
        {{ 'pw.advanceBooking.print' | translate }}
      </h4>
    </div>
  </div>
</ng-template>
<ng-template #confirmApprovalNotificationTemplate>
  <div class="pw-text-center">
    <h3 class="pw-success-color">
      {{ 'pw.manualCashMemo.approvalSuccessMsg' | translate }}
    </h3>
    <h5 class="pw-success-color pt-2">
      {{ 'pw.manualCashMemo.reqNumber' | translate }} {{ reqNo }}
    </h5>
  </div>
</ng-template>
