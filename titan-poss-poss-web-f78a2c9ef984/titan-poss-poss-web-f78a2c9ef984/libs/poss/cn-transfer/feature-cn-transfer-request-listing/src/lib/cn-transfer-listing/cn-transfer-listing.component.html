<div class="row align-items-end" [formGroup]="listingPageFormGroup">
  <mat-form-field
    class="col-lg-3 col-4 ml-auto pw-search-bar"
    floatLabel="never"
  >
    <mat-label>{{ 'pw.creditNote.searchByCNLabel' | translate }}</mat-label>
    <input
      #searchBox
      id="searchBox"
      matInput
      class="pw-input-box"
      formControlName="cnNumber"
    />
    <mat-icon matSuffix>
      <span
        *ngIf="!listingPageFormGroup.get('cnNumber').value"
        class="pw-i-16 pw-search-icon-16"
      ></span
    ></mat-icon>
    <mat-icon matSuffix>
      <span
        *ngIf="!listingPageFormGroup.get('cnNumber').value"
        class="pw-i-16 pw-search-icon-16"
      ></span
    ></mat-icon>
    <mat-icon matSuffix (click)="clearSearch()">
      <span
        *ngIf="listingPageFormGroup.get('cnNumber').value"
        class="pw-i-10 pw-close-icon-16"
      ></span
    ></mat-icon>
    <mat-error
      *ngIf="
        listingPageFormGroup.get('cnNumber').errors &&
        listingPageFormGroup.get('cnNumber').errors.errorArray
      "
    >
      <poss-web-error-info-tooltip
        [errorMessage]="listingPageFormGroup.get('cnNumber').errors.errorArray"
      ></poss-web-error-info-tooltip>
    </mat-error>
  </mat-form-field>

  <div class="col-lg-2 col-3">
    <mat-form-field>
      <mat-label>{{ 'pw.creditNote.fiscalYearLabel' | translate }}</mat-label>
      <input
        #fiscalYearSearchBox
        id="fiscalYearSearchBox"
        matInput
        class="pw-single-bordered-input"
        autocomplete="off"
        formControlName="fiscalYear"
      />
      <mat-error
        *ngIf="
          listingPageFormGroup.get('fiscalYear').errors &&
          listingPageFormGroup.get('fiscalYear').errors.errorArray
        "
      >
        <poss-web-error-info-tooltip
          [errorMessage]="
            listingPageFormGroup.get('fiscalYear').errors.errorArray
          "
        ></poss-web-error-info-tooltip>
      </mat-error>
    </mat-form-field>
  </div>

  <poss-web-select-dropdown
    class="col-lg-2 col-3"
    [control]="listingPageFormGroup.get('status')"
    [placeholder]="'Request Status'"
    [options]="tab === 'received' ? receivedRequestsStatus : sentRequestsStatus"
    [required]="true"
    (selectionChange)="loadRequests(0)"
  >
  </poss-web-select-dropdown>
</div>

<div class="mt-3">
  <poss-web-card-list
    *ngIf="sentRequests && !invalidSearch"
    [count]="count"
    [dataList]="sentRequests"
    [pageSize]="pageSize"
    (loadMore)="loadRequests($event)"
    (selected)="onSelected($event)"
  >
    <ng-template let-item="data">
      <poss-web-card-title>
        <div class="row">
          <div class="col-5 pw-grid-card__label">
            <h4>{{ item?.headerData?.data?.docNo }}</h4>
          </div>
          <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">-</p>
          <h4 class="col">{{ item?.fiscalYear }}</h4>
        </div>

        <div class="col-auto ml-auto"></div>
      </poss-web-card-title>

      <poss-web-card-content>
        <div class="row pw-grid-card__content">
          <p class="col-5 pw-grid-card__label">
            {{ 'pw.creditNote.cnTypeLabel' | translate }}
          </p>
          <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">:</p>
          <p class="col">{{ item?.headerData?.data?.creditNoteType }}</p>
        </div>
        <div class="row pw-grid-card__content">
          <p class="col-5 pw-grid-card__label">
            {{ 'pw.creditNote.cnAmountLabel' | translate }}
          </p>
          <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">:</p>
          <p class="col">
            {{ item?.headerData?.data?.amount | currencyFormatter }}
          </p>
        </div>
        <div class="row pw-grid-card__content">
          <p class="col-5 pw-grid-card__label">
            {{ 'pw.creditNote.customerNameLabel' | translate }}
          </p>
          <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">:</p>
          <p class="col">{{ item?.headerData?.data?.customerName }}</p>
        </div>
        <div class="row pw-grid-card__content">
          <p class="col-5 pw-grid-card__label">
            {{ 'pw.creditNote.CNLocationCodeLabel' | translate }}
          </p>
          <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">:</p>
          <p class="col">
            {{ item?.headerData?.data?.approverLocationCode }}
          </p>
        </div>
        <div class="row pw-grid-card__content">
          <p class="col-5 pw-grid-card__label">
            {{ 'pw.creditNote.reqNoText' | translate }}
          </p>
          <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">:</p>
          <p class="col">{{ item.docNo }}</p>
        </div>
        <div class="row pw-grid-card__content">
          <p class="col-5 pw-grid-card__label">
            {{ 'pw.creditNote.statusLabel' | translate }}
          </p>
          <p class="col-auto pw-grid-card__label pw-grid-card__padding-5">:</p>
          <p
            class="col"
            [ngClass]="
              getStatusColor(item?.approvalStatus ? item?.approvalStatus : '')
            "
          >
            {{ item?.approvalStatus }}
          </p>
        </div>
      </poss-web-card-content>
    </ng-template>
  </poss-web-card-list>
</div>
<div
  *ngIf="
    ((isLoading$ | async) === false && sentRequests.length == 0) ||
    invalidSearch
  "
  class="pw-message pw-text-center mg-t-100"
>
  <h3 class="m-auto">{{ 'pw.creditNote.noRecordsFoundLabel' | translate }}</h3>
</div>
<poss-web-loader *ngIf="isLoading$ | async"></poss-web-loader>
