<mat-accordion multi>
  <mat-expansion-panel expanded class="pw-expansion-panel">
    <mat-expansion-panel-header
      class="pw-expansion-panel__header"
      [collapsedHeight]="'40px'"
      [expandedHeight]="'40px'"
    >
      <mat-panel-title class="pw-expansion-panel__heading">
        {{ 'pw.grf.manualGrfDetailsLabel' | translate }}
      </mat-panel-title>
    </mat-expansion-panel-header>
    <poss-web-manual-form-details
      [txnType]="TransactionTypeEnumRef.GRF"
      [detailsFlag$]="detailsFlag$.asObservable()"
      [customerId]="customerId"
      [manualBillDetails]="manualBillDetails"
      [bussinessDay]="businessDay"
      [imageUrl]="imageUrl"
      (validate)="validateBill($event)"
      (validationType)="validationTypeChange($event)"
      (uploadFileEvent)="uploadFile($event)"
    ></poss-web-manual-form-details>
  </mat-expansion-panel>
</mat-accordion>

<div class="pw-detail-card pw-card pw-panel" *ngIf="isGrfAllowed">
  <div class="row pw-card__flex-end">
    <div class="col-auto">
      <mat-form-field [floatLabel]="'auto'" [formGroup]="ctGrfFormGroup">
        <mat-label
          >{{ 'pw.grf.enterAmount' | translate }}({{
            currencySymbolService.get(baseCurrencyCode)
          }})
        </mat-label>
        <input
          type="text"
          (focusout)="onFocusOut()"
          matInput
          autoComplete="off"
          formControlName="amount"
          required
          possWebAmountInput
        />
        <mat-error
          *ngIf="
            ctGrfFormGroup.get('amount').errors &&
            ctGrfFormGroup.get('amount').errors.errorArray
          "
        >
          <poss-web-error-info-tooltip
            [errorMessage]="ctGrfFormGroup.get('amount').errors.errorArray"
          >
          </poss-web-error-info-tooltip>
        </mat-error>
      </mat-form-field>
    </div>
    <div class="col-auto">
      <poss-web-rso-names-list
        [rsoNamesList]="rsoNamesList"
        [selectedRso]="selectedRso"
        (selectedRSOName)="setSelectedRSOName($event)"
        [clearSelectedRsoName]="clearSelectedRsoName"
      >
      </poss-web-rso-names-list>
    </div>
  </div>
</div>

<ng-template #grfSuccessNotificationTemplate>
  <div class="pw-text-center">
    <h3
      class="pw-success-color"
      *ngIf="actionType === validationTypesEnum.REGULARIZE"
    >
      {{ 'pw.grf.manualGrfSuccessMessage' | translate }}
    </h3>
    <h3
      class="pw-success-color"
      *ngIf="actionType === validationTypesEnum.SENDAPPROVAL"
    >
      {{ 'pw.grf.manualGrfRequestSendSuccessMsg' | translate }}
    </h3>
    <br />
    <div class="pw-black-popup-box__margin-top-10">
      {{ 'pw.grf.grfDocNo' | translate }}: {{ grfDocNo }}
    </div>
    <br />
    <div
      class="pw-black-popup-box__margin-top-10"
      *ngIf="actionType === validationTypesEnum.REGULARIZE"
    >
      {{ 'pw.grf.cnNo' | translate }}: {{ creditNoteNumber }}
    </div>
    <br *ngIf="actionType === validationTypesEnum.REGULARIZE" />
    <div class="pw-black-popup-box__margin-top-10">
      <button
        matButton
        class="pw-white-btn"
        (click)="
          printGrfConfirmedTransaction(
            transactionId,
            transactionTypeEnum?.ADV,
            subTransactionTypeEnum?.FROZEN_RATES
          )
        "
      >
        {{ 'pw.grf.print' | translate }}
      </button>
    </div>
  </div>
</ng-template>

<poss-web-loader
  *ngIf="
    (isLoading$ | async) ||
    (isOrderConfirmationLoading$ | async) ||
    (printingService.getPrinterIsLoading() | async)
  "
></poss-web-loader>
