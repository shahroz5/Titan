<div class="pw-location-mapping pw-location-mapping__fixed-width">
  <div
    class="row pw-location-mapping__header pw-cursor-grab"
    cdkDragBoundary=".cdk-overlay-container"
    cdkDragRootElement=".cdk-overlay-pane"
    cdkDrag
    cdkDragHandle
  >
    <h3 class="pw-message col-auto">
      {{ config.headerLabel | translate }}
    </h3>

    <div class="col pw-text-right">
      <button
        class="pw-location-mapping__icon-btn"
        mat-icon-button
        (click)="close()"
      >
        <mat-icon>
          <span class="pw-i-24 pw-close-no-border-icon-24"></span>
        </mat-icon>
      </button>
    </div>
  </div>
  <div class="pw-location-mapping__body">
    <mat-divider></mat-divider>

    <div class="pw-dialog-container__tab pw-location-mapping__tab-height">
      <div class="row no-gutters pw-location-mapping__config-tab">
        <div class="col-12 pw-tab__content">
          <div class="row pw-location-mapping__row">
            <div  *ngIf="!isViewMode" class="col-6 pw-location-mapping__padding-5">
              <mat-card class="pw-location-mapping__columns">
                <div class="pw-location-mapping__column-body">
                  <div class="row align-items-center no-gutters">
                    <mat-form-field
                      appearance="outline"
                      floatLabel="none"
                      class="col-8"
                    >
                      <input
                        class="pw-input-box"
                        #searchInput
                        matInput
                        placeholder="{{ config.searchLabel | translate }}"
                        (keyup)="scrollToTop('new')"
                      />
                      <mat-icon matPrefix>
                        <span class="pw-i-16 pw-search-icon-16"></span
                      ></mat-icon>
                      <mat-icon matSuffix (click)="searchInput.value = null">
                        <span
                          *ngIf="searchInput.value"
                          class="pw-i-10 pw-close-icon-16"
                        ></span
                      ></mat-icon>
                    </mat-form-field>

                    <div class="ml-auto">
                      <mat-checkbox
                        (click)="$event.stopPropagation()"
                        [(ngModel)]="selectAllOfAddNewTab"
                        (change)="selectAll('new', $event.checked)"
                        [disabled]="!allAbFoc.length"
                      >
                      </mat-checkbox>

                      <span>
                        {{
                          'pw.prooductGroupMapping.selectAllLabel' | translate
                        }}
                      </span>
                    </div>
                  </div>

                  <div class="pw-selection-list_header">
                    <div>
                      {{ config.schemeNameLabel | translate }}
                    </div>

                    <div>
                      {{ config.eligibleWeightLabel | translate }}
                    </div>
                  </div>

                  <cdk-virtual-scroll-viewport
                    [itemSize]="itemSize"
                    [minBufferPx]="minBufferPx"
                    [maxBufferPx]="maxBufferPx"
                    class="pw-selection-list-left"
                    #virtualScrollNewList
                  >
                    <ng-container
                      *ngIf="
                        allAbFoc.length === 0 ||
                        (allAbFoc | focSearch: searchInput.value:'weight')
                          .length === 0
                      "
                    >
                      <div
                        class="pw-selection-list_item pw-font-weight-bold pw-text-center pw-fourth-color"
                      >
                        {{ config.emptySchemeNameMessage | translate }}
                        !
                      </div>
                    </ng-container>
                    <div
                      *cdkVirtualFor="
                        let AbFoc of allAbFoc
                          | focSearch: searchInput.value:'weight';
                        templateCacheSize: 0;
                        trackBy: trackByAbFoc
                      "
                      (click)="
                        selectionChange(
                          AbFoc,
                          !AbFoc.isSelected,
                          'new'
                        )
                      "
                      class="pw-selection-list_item d-flex justify-content-between pw-font-weight-bold"
                    >
                      <div class="pw-text-ellipsis">
                        <mat-checkbox
                          class="pw-mat-checkbox"
                          (click)="$event.stopPropagation()"
                          [(ngModel)]="AbFoc.isSelected"
                          (change)="
                            selectionChange(AbFoc, AbFoc.isSelected, 'new')
                          "
                        ></mat-checkbox>
                        <span [matTooltip]="AbFoc.schemeName">
                          {{ AbFoc.schemeName }}
                        </span>
                      </div>

                      <div class="mr-3">
                        {{ AbFoc.weight }}
                      </div>
                    </div>
                  </cdk-virtual-scroll-viewport>
                  <button
                    [disabled]="!allAbFoc.length"
                    mat-flat-button
                    class="pw-btn pw-primary-btn pw-width-100 mt-3"
                    (click)="updateSelectedAbFoc('new')"
                  >
                    {{ 'pw.prooductGroupMapping.addButtonText' | translate }}
                  </button>
                </div>
              </mat-card>
            </div>
            <div   *ngIf="!isViewMode" class="col-6 pw-location-mapping__padding-5">
              <mat-card class="pw-location-mapping__columns">
                <div class="pw-location-mapping__column-body">
                  <div class="row align-items-center no-gutters">
                    <mat-form-field
                      appearance="outline"
                      floatLabel="none"
                      class="col-8"
                    >
                      <input
                        class="pw-input-box"
                        #searchSelectedDataInput
                        matInput
                        placeholder="{{ config.searchLabel | translate }}"
                        (keyup)="scrollToTop('selected')"
                      />
                      <mat-icon matPrefix>
                        <span class="pw-i-16 pw-search-icon-16"></span
                      ></mat-icon>
                      <mat-icon
                        matSuffix
                        (click)="searchSelectedDataInput.value = null"
                      >
                        <span
                          *ngIf="searchSelectedDataInput.value"
                          class="pw-i-10 pw-close-icon-16"
                        ></span
                      ></mat-icon>
                    </mat-form-field>

                    <div class="ml-auto">
                      <mat-checkbox
                        (click)="$event.stopPropagation()"
                        [(ngModel)]="selectAllOfSelectedTab"
                        (change)="selectAll('selected', $event.checked)"
                        [disabled]="!selectedAbFocs.length"
                      >
                      </mat-checkbox>
                      <span>
                        {{
                          'pw.prooductGroupMapping.selectAllLabel' | translate
                        }}
                      </span>
                    </div>
                  </div>

                  <div class="pw-selection-list_header">
                    <div>
                      {{ config.schemeNameLabel | translate }}
                    </div>

                    <div>
                      {{ config.eligibleWeightLabel | translate }}
                    </div>
                  </div>
                  <cdk-virtual-scroll-viewport
                    [itemSize]="itemSize"
                    [minBufferPx]="minBufferPx"
                    [maxBufferPx]="maxBufferPx"
                    class="pw-selection-list-left"
                    #virtualScrollSelectedData
                  >
                    <div
                      class="pw-selection-list_item pw-font-weight-bold pw-text-center pw-fourth-color"
                      *ngIf="
                        selectedAbFocs.length === 0 ||
                        (
                          selectedAbFocs
                          | focSearch: searchSelectedDataInput.value:'weight'
                        ).length === 0
                      "
                    >
                      {{ config.emptySchemeNameMessage | translate }}!
                    </div>
                    <div
                      *cdkVirtualFor="
                        let AbFoc of selectedAbFocs
                          | focSearch: searchSelectedDataInput.value:'weight';
                        templateCacheSize: 0;
                        trackBy: trackByAbFoc
                      "
                      (click)="
                      selectionChange(
                        AbFoc,
                        !AbFoc.isSelected,
                        'selected'
                      )
                    "
                      class="pw-selection-list_item d-flex justify-content-between pw-font-weight-bold"
                    >
                      <div class="pw-text-ellipsis">
                        <mat-checkbox
                          class="pw-mat-checkbox"
                          (click)="$event.stopPropagation()"
                          [(ngModel)]="AbFoc.isSelected"
                          (change)="
                            selectionChange(AbFoc, AbFoc.isSelected, 'selected')
                          "
                        ></mat-checkbox>
                        <span [matTooltip]="AbFoc.schemeName">
                          {{ AbFoc.schemeName }}
                        </span>
                      </div>

                      <div class="mr-3">
                        {{ AbFoc.weight }}
                      </div>
                    </div>
                  </cdk-virtual-scroll-viewport>
                  <button
                    mat-flat-button
                    class="pw-btn pw-primary-btn mt-3"
                    (click)="updateSelectedAbFoc('selected')"
                    [disabled]="!selectedAbFocs.length"
                  >
                    {{ 'pw.prooductGroupMapping.removeButtonText' | translate }}
                  </button>
                </div>
              </mat-card>
            </div>

            <div
            class="col-12 pw-location-mapping__padding-5"
            *ngIf="isViewMode"
          >
            <mat-card class="pw-location-mapping__columns">
              <div class="pw-location-mapping__column-body">
                <mat-form-field appearance="outline" floatLabel="none">
                  <input
                    class="pw-input-box"
                    #searchSelectedDataInput
                    matInput
                    placeholder="{{ config.searchLabel | translate }}"
                    (keyup)="scrollToTop('selected')"
                  />
                  <mat-icon matPrefix>
                    <span class="pw-i-16 pw-search-icon-16"></span
                  ></mat-icon>
                  <mat-icon
                    matSuffix
                    (click)="searchSelectedDataInput.value = null"
                  >
                    <span
                      *ngIf="searchSelectedDataInput.value"
                      class="pw-i-10 pw-close-icon-16"
                    ></span
                  ></mat-icon>
                </mat-form-field>
                <div class="pw-selection-list_header">
                  <div>
                    {{ config.schemeNameLabel | translate }}
                  </div>

                  <div>
                    {{ config.eligibleWeightLabel | translate }}
                  </div>
                </div>
                <cdk-virtual-scroll-viewport
                  [itemSize]="itemSize"
                  [minBufferPx]="minBufferPx"
                  [maxBufferPx]="maxBufferPx"
                  class="pw-selection-list-full"
                  #virtualScrollSelectedData
                >
                  <div
                    class="pw-selection-list_item pw-font-weight-bold pw-text-center pw-fourth-color"
                    *ngIf="
                    selectedAbFocs.length === 0 ||
                      (
                        selectedAbFocs
                        | focSearch: searchSelectedDataInput.value:'weight'
                      ).length === 0
                    "
                  >
                  {{ config.emptySchemeNameMessage | translate }}!
                  </div>
                  <div
                    *cdkVirtualFor="
                      let AbFoc of selectedAbFocs
                        | focSearch
                          : searchSelectedDataInput.value
                          : 'weight';
                      templateCacheSize: 0;
                      trackBy: trackByAbFoc
                    "
                    (click)="
                      selectionChange(
                        AbFoc,
                        !AbFoc.isSelected,
                        'selected'
                      )
                    "
                    class="pw-selection-list_item d-flex justify-content-between pw-font-weight-bold"
                  >
                    <div class="pw-text-ellipsis">
                      <span [matTooltip]="AbFoc.schemeName">
                        {{ AbFoc.schemeName }}
                      </span>
                    </div>

                    <div class="mr-3">
                      {{ AbFoc.weight }}
                    </div>
                  </div>
                </cdk-virtual-scroll-viewport>
              </div>
            </mat-card>
          </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="pw-location-mapping__footer pw-text-right">
    <div class="row justify-content-end">
      <div class="col-auto">
        <button
          *ngIf="!isViewMode"
          mat-flat-button
          class="pw-btn pw-accent-btn pw-width-100"
          (click)="applyAbFocs()"
          [disabled]="!hasChange"
        >
          {{ 'pw.prooductGroupMapping.applyButtonText' | translate }}
        </button>

        <button
        *ngIf="isViewMode"
        mat-flat-button
        [disabled]="!selectedAbFocs.length"
        class="pw-btn pw-accent-btn pw-width-100"
        (click)="close()"
      >
        {{ 'pw.prooductGroupMapping.okButtonText' | translate }}
      </button>
      </div>
    </div>
  </div>
</div>
