<div class="pw-detail-card" [formGroup]="pendingCmFormGroup">
  <div class="row">
    <div class="col-auto pw-expasion-panel-heading">
      {{ 'pw.foc.cmDetails' | translate }}
    </div>
  </div>
  <div class="row">
    <poss-web-fiscal-year
      class="col-lg-2 col-2"
      [control]="pendingCmFormGroup.get('fiscalYear')"
      [required]="true"
      [currentFiscalYear]="currentFiscalYear"
      (fiscalYear)="fiscalYearEmit($event)"
      [placeHolder]="'pw.creditNote.searchByFiscalYearLabel' | translate"
      [disabled]="false"
    ></poss-web-fiscal-year>
    <poss-web-select-dropdown
      class="col-lg-2 col-2"
      [placeholder]="'Select CM No.'"
      [control]="pendingCmFormGroup.get('pendingCM')"
      [options]="pendingCmArray"
      [required]="false"
      (selectionChange)="selectCM($event.value)"
    >
    </poss-web-select-dropdown>

    <div class="col-lg-2 col-2" *ngIf="selectedCM">
      <div class="pw-tertiary-color">
        {{ 'pw.foc.cmAmount' | translate }}
      </div>
      {{ selectedCM?.finalValue | currencyFormatter }}
    </div>
    <div class="col-lg-2 col-3" *ngIf="selectedCM">
      <div class="pw-tertiary-color">
        {{ 'pw.foc.cmDate' | translate }}
      </div>
      {{ selectedCM?.docDate | dateFormatter }}
    </div>
    <div class="col-auto ml-auto">
      <!-- <button
        class="pw-btn pw-accent-btn"
        [disabled]="pendingCmFormGroup.invalid"
        (click)="search()"
      >
        {{ 'pw.foc.search' | translate }}
      </button> -->
    </div>
  </div>
</div>
<mat-accordion>
  <mat-expansion-panel class="pw-expansion-panel" expanded>
    <mat-expansion-panel-header
      class="pw-expansion-panel__header"
      [collapsedHeight]="'40px'"
      [expandedHeight]="'40px'"
    >
      <mat-panel-title class="pw-expansion-panel__heading">
        {{ 'pw.foc.focProductDetails' | translate }}
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="row">
      <div class="col-auto ml-auto" *ngIf="selectedFocItems.length <= 0">
        <button
          class="pw-btn pw-primary-btn"
          (click)="loadFOCPopupData()"
          [disabled]="!isCustomerSelected"
        >
          {{ 'pw.foc.addFoc' | translate }}
        </button>
      </div>
      <div class="col-auto ml-auto" *ngIf="selectedFocItems.length > 0">
        <button class="pw-btn pw-warn-btn" (click)="clearFocGrid()">
          {{ 'pw.foc.removeFOC' | translate }}
        </button>
      </div>
    </div>

    <div class="mt-3">
      <!-- <poss-web-product-grid
        [productEvent]="product"
        [clearAllEvent]="clearAllData$.asObservable()"
        [enableProductGridUpdate]="true"
        [productGridProperties]="productGridProperties"
        [imageUrlData$]="imageUrlData$"
        (loadImageUrl)="loadImageUrl($event)"
        (cellFocusEvent)="cellFocus($event)"
      ></poss-web-product-grid> -->
      <poss-web-foc-product-grid
        [productDetails$]="productDetails$"
        (loadImageUrl)="loadImageUrl($event)"
        [imageUrlData$]="imageUrlData$.asObservable()"
        [pgDesc$]="pgDesc$"
        [rsoNames]="rsoDetails"
      >
      </poss-web-foc-product-grid>
    </div>
  </mat-expansion-panel>
</mat-accordion>
<div class="mg-t-100"></div>
<ng-template #confirmSuccessNotificationTemplate>
  <div class="pw-text-center">
    <h3 class="pw-success-color">
      {{ 'pw.foc.pendingFocIssueSuccessMsg' | translate }}
    </h3>
    <h5 class="pt-2">
      {{ 'pw.foc.docNo' | translate }} {{ confirmationResponse.docNo }}
    </h5>
  </div>
</ng-template>
<poss-web-loader
  *ngIf="
    (isLoadingPendingCM$ | async) ||
    (isLoadingPendingFocSchemes$ | async) ||
    (isLoadingFocItemDetails$ | async) ||
    (isIssuingPendingFOC$ | async) ||
    (isCommonLoading$ | async)
  "
></poss-web-loader>
